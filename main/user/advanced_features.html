

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88158104-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-88158104-1');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Features &mdash; WEC-Sim  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=5ea88473" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WEC-Sim Applications" href="applications.html" />
    <link rel="prev" title="Code Structure" href="code_structure.html" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BSPTGP3DXP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BSPTGP3DXP');
    </script>
    <jinja2.runtime.BlockReference object at 0x7f6b2a2af700>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            WEC-Sim
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/index.html">Theory Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="workflow.html">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_structure.html">Code Structure</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bemio">BEMIO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bemio-functions">BEMIO Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bemio-hydro-data-structure">BEMIO <em>hydro</em> Data Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-your-own-h5-file">Writing Your Own h5 File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-features">Simulation Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-wec-sim">Running WEC-Sim</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-condition-runs-mcr">Multiple Condition Runs (MCR)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-computing-toolbox-pct">Parallel Computing Toolbox (PCT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#radiation-force-calculation">Radiation Force calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-step-features">Time-Step Features</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wave-features">Wave Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#irregular-wave-binning">Irregular Wave Binning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wave-directionality">Wave Directionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wave-directional-spreading">Wave Directional Spreading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-wave-spectra">Multiple Wave-Spectra</a></li>
<li class="toctree-l4"><a class="reference internal" href="#irregular-waves-with-seeded-phase">Irregular Waves with Seeded Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wave-gauge-placement">Wave Gauge Placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ocean-current">Ocean Current</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#body-features">Body Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#body-mass-and-geometry-features">Body Mass and Geometry Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonlinear-buoyancy-and-froude-krylov-excitation">Nonlinear Buoyancy and Froude-Krylov Excitation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#viscous-damping-and-morison-elements">Viscous Damping and Morison Elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#second-order-excitation-forces-and-quadratic-transfer-functions-qtfs">Second-Order Excitation Forces and Quadratic Transfer Functions (QTFs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#drag-bodies">Drag Bodies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#body-to-body-interactions">Body-To-Body Interactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generalized-body-modes">Generalized Body Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#passive-yaw-implementation">Passive Yaw Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#large-x-y-displacements">Large X-Y Displacements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variable-hydrodynamics">Variable Hydrodynamics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#body-initialization">Body Initialization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#constraint-and-pto-features">Constraint and PTO Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#modifying-constraints-and-ptos">Modifying Constraints and PTOs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-pto-or-constraint-extension">Setting PTO or Constraint Extension</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pto-sim">PTO-Sim</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#controller-features">Controller Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples-sphere-float-with-various-controllers">Examples: Sphere Float with Various Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#passive-control-proportional">Passive Control (Proportional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reactive-control-proportional-integral">Reactive Control (Proportional-Integral)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#latching-control">Latching Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#declutching-control">Declutching Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-predictive-control-mpc">Model Predictive Control (MPC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reactive-control-with-direct-drive-power-take-off">Reactive Control with Direct Drive Power Take-Off</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cable-features">Cable Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mooring-features">Mooring Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mooring-matrix">Mooring Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mooring-lookup-table">Mooring Lookup Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moordyn">MoorDyn</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wec-sim-post-processing">WEC-Sim Post-Processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plot-forces">Plot Forces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-response">Plot Response</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-elevation">Plot Elevation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-spectrum">Plot Spectrum</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wec-sim-visualization">WEC-Sim Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wave-markers">Wave Markers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-visualization">Save Visualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#paraview-visualization">Paraview Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-paraview-and-wec-sim-macros">Install ParaView and WEC-Sim Macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wec-sim-visualization-in-paraview">WEC-Sim Visualization in ParaView</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-a-paraview-state-file">Loading a ParaView State File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#paraview-visualization-parameters">ParaView Visualization Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decay-tests">Decay Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-features">Other Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="applications.html">WEC-Sim Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="webinars.html">Training Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../most/index.html">MOST Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WEC-Sim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Manual</a></li>
      <li class="breadcrumb-item active">Advanced Features</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/advanced_features.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             


  <section id="advanced-features">
<span id="user-advanced-features"></span><h1>Advanced Features<a class="headerlink" href="#advanced-features" title="Link to this heading"></a></h1>
<p>The advanced features documentation provides an overview of WEC-Sim features
and applications that were not covered in the WEC-Sim <a class="reference internal" href="tutorials.html#user-tutorials"><span class="std std-ref">Tutorials</span></a>.
The diagram below highlights some of WEC-Sim’s advanced features, details of
which will be described in the following sections. Most advanced features have
a corresponding example case within the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim_Applications repository</a> or the <code class="docutils literal notranslate"><span class="pre">WEC-Sim/Examples</span></code>
directory in the WEC-Sim source code. For those topics of interest, it is
recommended that users run and understand the output of an application while
reading the documentation on the feature.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/codeFeatures.png"><img alt="../_images/codeFeatures.png" src="../_images/codeFeatures.png" style="width: 400pt;" />
</a>
</figure>
<section id="bemio">
<span id="user-advanced-features-bemio"></span><h2>BEMIO<a class="headerlink" href="#bemio" title="Link to this heading"></a></h2>
<p>The Boundary Element Method Input/Output (BEMIO) functions are used to
pre-process the BEM hydrodynamic data prior to running WEC-Sim. For more
information about the WEC-Sim workflow, refer to
<a class="reference internal" href="workflow.html#user-workflow-running-wec-sim"><span class="std std-ref">Running WEC-Sim</span></a>. The following section can also be
followed in conjunction with the cases in the WEC-Sim/Examples directory in the
WEC-Sim source code. This includes several cases with WAMIT, NEMOH, Aqwa, and Capytaine.
For more information, refer to <a class="reference internal" href="webinars.html#webinar1"><span class="std std-ref">Series 1 - Multiple Condition Runs (MCR)</span></a>. BEMIO functions perform the
following tasks:</p>
<ul class="simple">
<li><p>Read BEM results from <strong>WAMIT</strong>, <strong>NEMOH</strong>, <strong>Aqwa</strong>, or <strong>Capytaine</strong>.</p></li>
<li><p>Calculate the radiation and excitation impulse response functions (IRFs).</p></li>
<li><p>Calculate the state space realization for the radiation IRF.</p></li>
<li><p>Save the resulting data in Hierarchical Data Format 5 (HDF5).</p></li>
<li><p>Plot typical hydrodynamic data for user verification.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previously the <a class="reference external" href="http://wec-sim.github.io/bemio/installing.html">python based BEMIO code</a> was used for this purpose. The python BEMIO functions have been converted to MATLAB and are included in the WEC-Sim source code. The python based BEMIO code will remain available but will no longer be  supported.</p>
</div>
<section id="bemio-functions">
<h3>BEMIO Functions<a class="headerlink" href="#bemio-functions" title="Link to this heading"></a></h3>
<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.readWAMIT">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">readWAMIT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">exCoeff</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.readWAMIT" title="Link to this definition"></a></dt>
<dd><p>Reads data from a WAMIT output file.</p>
<p>If generalized body modes are used, the output directory must also
include the <cite>*.cfg</cite>, <cite>*.mmx</cite>, and <cite>*.hst</cite> files.
If simu.nonlinearHydro = 3 will be used, the output directory must also
include the <cite>*.3fk</cite> and <cite>*.3sc</cite> files.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim/examples/BEMIO/WAMIT</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data that WAMIT input data will be appended to</p></li>
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Path to the WAMIT output file</p></li>
<li><p><strong>exCoeff</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Flag indicating the type of excitation force coefficients to
read, ‘diffraction’ (default), ‘haskind’, or ‘rao’</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with WAMIT data appended</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.readNEMOH">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">readNEMOH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">filedir</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.readNEMOH" title="Link to this definition"></a></dt>
<dd><p>Reads data from a NEMOH working folder.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO\NEMOH</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data that NEMOH input data will be appended to</p></li>
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – <p>Path to the NEMOH working folder, must include:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Nemoh.cal</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mesh/Hydrostatics.dat</span></code> (or <code class="docutils literal notranslate"><span class="pre">Hydrostatiscs_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">Hydrostatics_1.dat</span></code>, etc. for multiple bodies)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mesh/KH.dat</span> <span class="pre">(or</span> <span class="pre">``KH_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">KH_1.dat</span></code>, etc. for multiple bodies)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Results/RadiationCoefficients.tec</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Results/ExcitationForce.tec</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Results/DiffractionForce.tec</span></code> - If simu.nonlinearHydro = 3 will be used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Results/FKForce.tec</span></code> - If simu.nonlinearHydro = 3 will be used</p></li>
</ul>
</div></blockquote>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with NEMOH data appended</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Instructions on how to download and use the open source BEM code NEMOH are provided on the <a class="reference external" href="https://lheea.ec-nantes.fr/logiciels-et-brevets/nemoh-presentation-192863.kjsp">NEMOH website</a>.</p></li>
<li><p>The NEMOH Mesh.exe code creates the <code class="docutils literal notranslate"><span class="pre">Hydrostatics.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">KH.dat</span></code> files (among other files) for one input body at a time. For the readNEMOH function to work correctly in the case of a multiple body system, the user must manually rename <code class="docutils literal notranslate"><span class="pre">Hydrostatics.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">KH.dat</span></code> files to <code class="docutils literal notranslate"><span class="pre">Hydrostatics_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">Hydrostatics_1.dat</span></code>, …, and <code class="docutils literal notranslate"><span class="pre">KH_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">KH_1.dat</span></code>,…, corresponding to the body order specified in the <code class="docutils literal notranslate"><span class="pre">Nemoh.cal</span></code> file.</p></li>
</ul>
</div>
<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.readAQWA">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">readAQWA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">ah1Filename</span></em>, <em class="sig-param"><span class="pre">lisFilename</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.readAQWA" title="Link to this definition"></a></dt>
<dd><p>Reads data from AQWA output files.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO\AQWA</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data that Aqwa input data will be appended to</p></li>
<li><p><strong>ah1Filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – .AH1 AQWA output file</p></li>
<li><p><strong>lisFilename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – .LIS AQWA output file</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with Aqwa data appended</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.readCAPYTAINE">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">readCAPYTAINE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">hydrostatics_sub_dir</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.readCAPYTAINE" title="Link to this definition"></a></dt>
<dd><p>Reads data from a Capytaine netcdf file</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO\CAPYTAINE</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data that Capytaine input data will be appended to</p></li>
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Capytaine .nc output file</p></li>
<li><p><strong>hydrostatics_sub_dir</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Path to directory where Hydrostatics.dat and KH.dat files are saved</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with Capytaine data appended</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.normalizeBEM">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">normalizeBEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.normalizeBEM" title="Link to this definition"></a></dt>
<dd><p>Normalizes BEM hydrodynamic coefficients in the same manner
that WAMIT outputs are normalized. Specifically, the linear restoring
stiffness is normalized as <span class="math notranslate nohighlight">\(C_{i,j}/(\rho g)\)</span>; added mass is normalized as
<span class="math notranslate nohighlight">\(A_{i,j}/\rho\)</span>; radiation damping is normalized as <span class="math notranslate nohighlight">\(B_{i,j}/(\rho \omega)\)</span>; and,
exciting forces are normalized as <span class="math notranslate nohighlight">\(X_i/(\rho g)\)</span>. And, if necessary, sort
data according to ascending frequency.</p>
<p>This function is not called directly by the user; it is automatically
implemented within the readWAMIT, readCAPYTAINE, readNEMOH, and readAQWA
functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">[1</span> <span class="pre">x</span> <span class="pre">1]</span> <span class="pre">struct</span></code></span>) – Structure of hydro data that will be  normalized and sorted
depending on the value of hydro.code</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Normalized hydro data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[1 x 1] struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.combineBEM">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">combineBEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.combineBEM" title="Link to this definition"></a></dt>
<dd><p>Combines multiple BEM outputs into one hydrodynamic ‘system.’ This function
requires that all BEM outputs have the same water depth, wave frequencies,
and wave headings. This function would be implemented following multiple
readWAMIT, readNEMOH, readCAPYTAINE, or readAQWA and before radiationIRF,
radiationIRFSS, excitationIRF, writeBEMIOH5, or plotBEMIO function calls.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO\NEMOH</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">[1</span> <span class="pre">x</span> <span class="pre">n]</span> <span class="pre">struct</span></code></span>) – Structures of hydro data that will be combined into a single
structure</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Combined structure.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[1 x 1] struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.radiationIRF">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">radiationIRF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">tEnd</span></em>, <em class="sig-param"><span class="pre">nDt</span></em>, <em class="sig-param"><span class="pre">nDw</span></em>, <em class="sig-param"><span class="pre">wMin</span></em>, <em class="sig-param"><span class="pre">wMax</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.radiationIRF" title="Link to this definition"></a></dt>
<dd><p>Calculates the normalized radiation impulse response function. This is
equivalent to the radiation IRF in the theory section normalized by
<span class="math notranslate nohighlight">\(\rho\)</span>:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\overline{K}_{r,i,j}(t) = {\frac{2}{\pi}}\intop_0^{\infty}{\frac{B_{i,j}(\omega)}{\rho}}\cos({\omega}t)d\omega\)</span></p>
</div></blockquote>
<p>Default parameters can be used by inputting [].
See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data</p></li>
<li><p><strong>tEnd</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Calculation range for the IRF, where the IRF is calculated from t
= 0 to tEnd, and the default is 100 s</p></li>
<li><p><strong>nDt</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Number of time steps in the IRF, the default is 1001</p></li>
<li><p><strong>nDw</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Number of frequency steps used in the IRF calculation
(hydrodynamic coefficients are interpolated to correspond), the
default is 1001</p></li>
<li><p><strong>wMin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Minimum frequency to use in the IRF calculation, the default is
the minimum frequency from the BEM data</p></li>
<li><p><strong>wMax</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Maximum frequency to use in the IRF calculation, the default is
the maximum frequency from the BEM data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with radiation IRF</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.radiationIRFSS">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">radiationIRFSS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">Omax</span></em>, <em class="sig-param"><span class="pre">R2t</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.radiationIRFSS" title="Link to this definition"></a></dt>
<dd><p>Calculates the state space (SS) realization of the normalized radiation IRF.
If this function is used, it must be implemented after the radiationIRF function.</p>
<p>Default parameters can be used by inputting [].
See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data</p></li>
<li><p><strong>Omax</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Maximum order of the SS realization, the default is 10</p></li>
<li><p><strong>R2t</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – <span class="math notranslate nohighlight">\(R^2\)</span> threshold (coefficient of determination) for the SS
realization, where <span class="math notranslate nohighlight">\(R^2\)</span> may range from 0 to 1, and the
default is 0.95</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with radiation IRF state space
coefficients</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.excitationIRF">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">excitationIRF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em>, <em class="sig-param"><span class="pre">tEnd</span></em>, <em class="sig-param"><span class="pre">nDt</span></em>, <em class="sig-param"><span class="pre">nDw</span></em>, <em class="sig-param"><span class="pre">wMin</span></em>, <em class="sig-param"><span class="pre">wMax</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.excitationIRF" title="Link to this definition"></a></dt>
<dd><p>Calculates the normalized excitation impulse response function:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\overline{K}_{e,i,\theta}(t) = {\frac{1}{2\pi}}\intop_{-\infty}^{\infty}{\frac{X_i(\omega,\theta)e^{i{\omega}t}}{{\rho}g}}d\omega\)</span></p>
</div></blockquote>
<p>Default parameters can be used by inputting [].
See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct</span></code></span>) – Structure of hydro data</p></li>
<li><p><strong>tEnd</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Calculation range for the IRF, where the IRF is calculated from t
= 0 to tEnd, and the default is 100 s</p></li>
<li><p><strong>nDt</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Number of time steps in the IRF, the default is 1001</p></li>
<li><p><strong>nDw</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Number of frequency steps used in the IRF calculation
(hydrodynamic coefficients are interpolated to correspond), the
default is 1001</p></li>
<li><p><strong>wMin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Minimum frequency to use in the IRF calculation, the default is
the minimum frequency from the BEM data</p></li>
<li><p><strong>wMax</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Maximum frequency to use in the IRF calculation, the default is
the maximum frequency from the BEM data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydro</strong> – Structure of hydro data with excitation IRF</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.readBEMIOH5">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">readBEMIOH5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">filename</span></em>, <em class="sig-param"><span class="pre">number</span></em>, <em class="sig-param"><span class="pre">meanDrift</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.readBEMIOH5" title="Link to this definition"></a></dt>
<dd><p>Function to read BEMIO data from an h5 file into a hydrodata structure
for the bodyClass</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">string</span></code></span>) – Path to the BEMIO .h5 file to read</p></li>
<li><p><strong>number</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Body number to read from the .h5 file. For example, body(2) in
the input file must read body2 from the .h5 file.</p></li>
<li><p><strong>meanDrift</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integer</span></code></span>) – Flag to optionally read mean drift force coefficients</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hydroData</strong> – Struct of hydroData used by the bodyClass. Different format than
the BEMIO hydro struct</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>struct</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.reverseDimensionOrder">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">reverseDimensionOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">inputData</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.reverseDimensionOrder" title="Link to this definition"></a></dt>
<dd><p>This function reverse the order of the dimensions in data.
Called by readBEMIOH5() to permute data into the correct format.</p>
<p>This required permutation is a legacy of the <code class="docutils literal notranslate"><span class="pre">Load_H5</span></code>
function that reordered dimensions of hydroData after reading</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>inputData</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">array</span></code></span>) – Any numeric data array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>outputData</strong> – Input data array with the order of its dimensions reversed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.calcSpectralMoment">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">calcSpectralMoment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">angFreq</span></em>, <em class="sig-param"><span class="pre">S_f</span></em>, <em class="sig-param"><span class="pre">order</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.calcSpectralMoment" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>angFreq</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">[1</span> <span class="pre">n]</span> <span class="pre">float</span> <span class="pre">vector</span></code></span>) – Vector of wave angular frequencies</p></li>
<li><p><strong>S_f</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">[1</span> <span class="pre">n]</span> <span class="pre">float</span> <span class="pre">vector</span></code></span>) – Vector of wave spectra</p></li>
<li><p><strong>order</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Order of the spectral moment</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>mn</strong> – Spectral moment of the nth order</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float vector</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.calcWaveNumber">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">calcWaveNumber</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">omega</span></em>, <em class="sig-param"><span class="pre">waterDepth</span></em>, <em class="sig-param"><span class="pre">g</span></em>, <em class="sig-param"><span class="pre">deepWater</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.calcWaveNumber" title="Link to this definition"></a></dt>
<dd><p>Solves the wave dispersion relation <span class="math notranslate nohighlight">\(\omega^2 = g k*tanh(k h)\)</span> for
the wave number</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>omega</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Wave frequency [rad/s]</p></li>
<li><p><strong>waterDepth</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Water depth [m]</p></li>
<li><p><strong>g</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">float</span></code></span>) – Gravitational acceleration [m/s^2]</p></li>
<li><p><strong>deepWater</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">integar</span></code></span>) – waveClass flag inidicating a deep water wave [-]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>k</strong> – Wave number [m]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.writeBEMIOH5">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">writeBEMIOH5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hydro</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.writeBEMIOH5" title="Link to this definition"></a></dt>
<dd><p>Writes the hydro data structure to a .h5 file.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\tutorials\BEMIO</span></code> for examples of usage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hydro</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">[1</span> <span class="pre">x</span> <span class="pre">1]</span> <span class="pre">struct</span></code></span>) – Structure of hydro data that is written to <code class="docutils literal notranslate"><span class="pre">hydro.file</span></code></p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Technically, this step should not be necessary - the MATLAB data structure <em>hydro</em> is written to a <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file by BEMIO and then read back into a new MATLAB data structure <em>hydroData</em> for each body by WEC-Sim. The reasons this step was retained were, first, to remain compatible with the python based BEMIO output and, second, for the simpler data visualization and verification capabilities offered by the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file viewer.</p>
</div>
<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotBEMIO">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotBEMIO</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotBEMIO" title="Link to this definition"></a></dt>
<dd><p>Plots the added mass, radiation damping, radiation IRF, excitation force
magnitude, excitation force phase, and excitation IRF for each body in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotBEMIO(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<p>See <code class="docutils literal notranslate"><span class="pre">WEC-Sim\examples\BEMIO</span></code> for additional examples.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotAddedMass">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotAddedMass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotAddedMass" title="Link to this definition"></a></dt>
<dd><p>Plots the added mass for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotAddedMass(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotRadiationDamping">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotRadiationDamping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotRadiationDamping" title="Link to this definition"></a></dt>
<dd><p>Plots the radiation damping for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotRadiationDamping(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotRadiationIRF">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotRadiationIRF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotRadiationIRF" title="Link to this definition"></a></dt>
<dd><p>Plots the radiation IRF for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotRadiationIRF(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotExcitationMagnitude">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotExcitationMagnitude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotExcitationMagnitude" title="Link to this definition"></a></dt>
<dd><p>Plots the excitation force magnitude for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotExcitationMagnitude(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotExcitationPhase">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotExcitationPhase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotExcitationPhase" title="Link to this definition"></a></dt>
<dd><p>Plots the excitation force phase for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotExcitationPhase(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="functions.BEMIO.plotExcitationIRF">
<span class="sig-prename descclassname"><span class="pre">functions.BEMIO.</span></span><span class="sig-name descname"><span class="pre">plotExcitationIRF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#functions.BEMIO.plotExcitationIRF" title="Link to this definition"></a></dt>
<dd><p>Plots the excitation IRF for each hydro structure’s bodies in
the given degrees of freedom.</p>
<p>Usage:
<code class="docutils literal notranslate"><span class="pre">plotExcitationIRF(hydro,</span> <span class="pre">hydro2,</span> <span class="pre">hydro3,</span> <span class="pre">...)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>varargin</strong> (<span><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">struct(s)</span></code></span>) – The hydroData structure(s) created by the other BEMIO functions.
One or more may be input.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="bemio-hydro-data-structure">
<span id="user-advanced-features-bemio-h5"></span><h3>BEMIO <em>hydro</em> Data Structure<a class="headerlink" href="#bemio-hydro-data-structure" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Variable</strong></p></td>
<td><p><strong>Format</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>A</p></td>
<td><p>[nDOF,nDOF,Nf]</p></td>
<td><p>radiation added mass</p></td>
</tr>
<tr class="row-odd"><td><p>Ainf</p></td>
<td><p>[nDOF,nDOF]</p></td>
<td><p>infinite frequency added mass</p></td>
</tr>
<tr class="row-even"><td><p>B</p></td>
<td><p>[nDOF,nDOF,Nf]</p></td>
<td><p>radiation wave damping</p></td>
</tr>
<tr class="row-odd"><td><p>theta</p></td>
<td><p>[1,Nh]</p></td>
<td><p>wave headings (deg)</p></td>
</tr>
<tr class="row-even"><td><p>body</p></td>
<td><p>{1,Nb}</p></td>
<td><p>body names</p></td>
</tr>
<tr class="row-odd"><td><p>cb</p></td>
<td><p>[3,Nb]</p></td>
<td><p>center of buoyancy</p></td>
</tr>
<tr class="row-even"><td><p>cg</p></td>
<td><p>[3,Nb]</p></td>
<td><p>center of gravity</p></td>
</tr>
<tr class="row-odd"><td><p>code</p></td>
<td><p>string</p></td>
<td><p>BEM code (WAMIT, NEMOH, AQWA, or CAPYTAINE)</p></td>
</tr>
<tr class="row-even"><td><p>K_hs</p></td>
<td><p>[6,6,Nb]</p></td>
<td><p>hydrostatic restoring stiffness</p></td>
</tr>
<tr class="row-odd"><td><p>dof</p></td>
<td><p>[1, Nb]</p></td>
<td><p>Degrees of freedom (DOF) for each body. Default DOF for each body is 6 plus number of possible generalized body modes (GBM).</p></td>
</tr>
<tr class="row-even"><td><p>ex_im</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>imaginary component of excitation force or torque</p></td>
</tr>
<tr class="row-odd"><td><p>ex_K</p></td>
<td><p>[nDOF,Nh,length(ex_t)]</p></td>
<td><p>excitation IRF</p></td>
</tr>
<tr class="row-even"><td><p>ex_ma</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>magnitude of excitation force or torque</p></td>
</tr>
<tr class="row-odd"><td><p>ex_ph</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>phase of excitation force or torque</p></td>
</tr>
<tr class="row-even"><td><p>ex_re</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>real component of excitation force or torque</p></td>
</tr>
<tr class="row-odd"><td><p>ex_t</p></td>
<td><p>[1,length(ex_t)]</p></td>
<td><p>time steps in the excitation IRF</p></td>
</tr>
<tr class="row-even"><td><p>ex_w</p></td>
<td><p>[1,length(ex_w)]</p></td>
<td><p>frequency step in the excitation IRF</p></td>
</tr>
<tr class="row-odd"><td><p>file</p></td>
<td><p>string</p></td>
<td><p>BEM output filename</p></td>
</tr>
<tr class="row-even"><td><p>fk_im</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>imaginary component of Froude-Krylov contribution to the excitation force or torque</p></td>
</tr>
<tr class="row-odd"><td><p>fk_ma</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>magnitude of Froude-Krylov excitation component</p></td>
</tr>
<tr class="row-even"><td><p>fk_ph</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>phase of Froude-Krylov excitation component</p></td>
</tr>
<tr class="row-odd"><td><p>fk_re</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>real component of Froude-Krylov contribution to the excitation force or torque</p></td>
</tr>
<tr class="row-even"><td><p>g</p></td>
<td><p>[1,1]</p></td>
<td><p>gravity</p></td>
</tr>
<tr class="row-odd"><td><p>h</p></td>
<td><p>[1,1]</p></td>
<td><p>water depth</p></td>
</tr>
<tr class="row-even"><td><p>Nb</p></td>
<td><p>[1,1]</p></td>
<td><p>number of bodies</p></td>
</tr>
<tr class="row-odd"><td><p>Nf</p></td>
<td><p>[1,1]</p></td>
<td><p>number of wave frequencies</p></td>
</tr>
<tr class="row-even"><td><p>Nh</p></td>
<td><p>[1,1]</p></td>
<td><p>number of wave headings</p></td>
</tr>
<tr class="row-odd"><td><p>plotDofs</p></td>
<td><p>[length(plotDofs),2]</p></td>
<td><p>degrees of freedom to be plotted (default: [1,1;3,3;5,5])</p></td>
</tr>
<tr class="row-even"><td><p>plotBodies</p></td>
<td><p>[1,length(plotBodies)]</p></td>
<td><p>BEM bodies to be plotted (default: [1:Nb])</p></td>
</tr>
<tr class="row-odd"><td><p>plotDirections</p></td>
<td><p>[1,length(plotDirections)]</p></td>
<td><p>indices indicating wave directions to plot from list of headings (default: [1])</p></td>
</tr>
<tr class="row-even"><td><p>ra_K</p></td>
<td><p>[nDOF,nDOF,length(ra_t)]</p></td>
<td><p>radiation IRF</p></td>
</tr>
<tr class="row-odd"><td><p>ra_t</p></td>
<td><p>[1,length(ra_t)]</p></td>
<td><p>time steps in the radiation IRF</p></td>
</tr>
<tr class="row-even"><td><p>ra_w</p></td>
<td><p>[1,length(ra_w)]</p></td>
<td><p>frequency steps in the radiation IRF</p></td>
</tr>
<tr class="row-odd"><td><p>rho</p></td>
<td><p>[1,1]</p></td>
<td><p>density</p></td>
</tr>
<tr class="row-even"><td><p>sc_im</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>imaginary component of scattering contribution to the excitation force or torque</p></td>
</tr>
<tr class="row-odd"><td><p>sc_ma</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>magnitude of scattering excitation component</p></td>
</tr>
<tr class="row-even"><td><p>sc_ph</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>phase of scattering excitation component</p></td>
</tr>
<tr class="row-odd"><td><p>sc_re</p></td>
<td><p>[nDOF,Nh,Nf]</p></td>
<td><p>real component of scattering contribution to the excitation force or torque</p></td>
</tr>
<tr class="row-even"><td><p>ss_A</p></td>
<td><p>[nDOF,nDOF,ss_O,ss_O]</p></td>
<td><p>state space A matrix</p></td>
</tr>
<tr class="row-odd"><td><p>ss_B</p></td>
<td><p>[nDOF,nDOF,ss_O,1]</p></td>
<td><p>state space B matrix</p></td>
</tr>
<tr class="row-even"><td><p>ss_C</p></td>
<td><p>[nDOF,nDOF,1,ss_O]</p></td>
<td><p>state space C matrix</p></td>
</tr>
<tr class="row-odd"><td><p>ss_conv</p></td>
<td><p>[nDOF,nDOF]</p></td>
<td><p>state space convergence flag</p></td>
</tr>
<tr class="row-even"><td><p>ss_D</p></td>
<td><p>[nDOF,nDOF,1]</p></td>
<td><p>state space D matrix</p></td>
</tr>
<tr class="row-odd"><td><p>ss_K</p></td>
<td><p>[nDOF,nDOF,length(ra_t)]</p></td>
<td><p>state space radiation IRF</p></td>
</tr>
<tr class="row-even"><td><p>ss_O</p></td>
<td><p>[nDOF,nDOF]</p></td>
<td><p>state space order</p></td>
</tr>
<tr class="row-odd"><td><p>ss_R2</p></td>
<td><p>[nDOF,nDOF]</p></td>
<td><p>state space R2 fit</p></td>
</tr>
<tr class="row-even"><td><p>T</p></td>
<td><p>[1,Nf]</p></td>
<td><p>wave periods</p></td>
</tr>
<tr class="row-odd"><td><p>Vo</p></td>
<td><p>[1,Nb]</p></td>
<td><p>displaced volume</p></td>
</tr>
<tr class="row-even"><td><p>w</p></td>
<td><p>[1,Nf]</p></td>
<td><p>wave frequencies</p></td>
</tr>
</tbody>
</table>
</section>
<section id="writing-your-own-h5-file">
<h3>Writing Your Own h5 File<a class="headerlink" href="#writing-your-own-h5-file" title="Link to this heading"></a></h3>
<p>The most common way of creating a <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file is using BEMIO to post-process the outputs of a BEM code.
This requires a single BEM solution that contains all hydrodynamic bodies and accounts for body-to-body interactions.
Some cases in which you might want to create your own h5 file are:</p>
<ul class="simple">
<li><p>Use experimentally determined coefficients or a mix of BEM and experimental coefficients.</p></li>
<li><p>Combine results from different BEM files and have the coefficient matrices be the correct size for the new total number of bodies.</p></li>
<li><p>Modify the BEM results for any other reason.</p></li>
</ul>
<p>MATLAB and Python have functions to read and write <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> files easily.
WEC-Sim includes one function <code class="docutils literal notranslate"><span class="pre">writeBEMIOH5</span></code> to help you create your own <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.
The first step is to have all the required coefficients and properties in Matlab in the correct hydroData format.
Then <code class="docutils literal notranslate"><span class="pre">writeBEMIOH5</span></code> is used to create and populate the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.</p>
</section>
</section>
<section id="simulation-features">
<span id="user-advanced-features-simulation"></span><h2>Simulation Features<a class="headerlink" href="#simulation-features" title="Link to this heading"></a></h2>
<p>This section provides an overview of WEC-Sim’s simulation class features; for
more information about the simulation class code structure, refer to
<a class="reference internal" href="code_structure.html#user-code-structure-simulation-class"><span class="std std-ref">Simulation Class</span></a>.</p>
<section id="running-wec-sim">
<h3>Running WEC-Sim<a class="headerlink" href="#running-wec-sim" title="Link to this heading"></a></h3>
<p>The subsection describes the various ways to run WEC-Sim. The standard method is
to type the command <code class="docutils literal notranslate"><span class="pre">wecSim</span></code> in the MATLAB command window when in a <code class="docutils literal notranslate"><span class="pre">$CASE</span></code>
directory. This is the same method described in the <a class="reference internal" href="workflow.html#user-workflow"><span class="std std-ref">Workflow</span></a> and
<a class="reference internal" href="tutorials.html#user-tutorials"><span class="std std-ref">Tutorials</span></a> sections.</p>
<section id="running-as-function">
<span id="user-advanced-features-fcn"></span><h4>Running as Function<a class="headerlink" href="#running-as-function" title="Link to this heading"></a></h4>
<p>WEC-Sim allows users to execute WEC-Sim as a function by using <code class="docutils literal notranslate"><span class="pre">wecSimFcn</span></code>.
This option may be useful for users who wish to devise their own batch runs,
isolate the WEC-Sim workspace, create a special set-up before running WEC-Sim,
or link to another software.</p>
</section>
<section id="running-from-simulink">
<span id="user-advanced-features-simulink"></span><h4>Running from Simulink<a class="headerlink" href="#running-from-simulink" title="Link to this heading"></a></h4>
<p>WEC-Sim can also be run directly from Simulink with the following steps:</p>
<ul class="simple">
<li><p>Type <code class="docutils literal notranslate"><span class="pre">initializeWecSim</span></code> in the Command Window</p></li>
<li><p>Run the model from Simulink and wait for the simulation to complete</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">stopWecSim</span></code> in the Command Window</p></li>
</ul>
<p>This allows users to initialize WEC-Sim from the command window and then start the simulation from Simulink,
allowing for greater compatibility with other models or hardware-in-the-loop simulations.</p>
</section>
</section>
<section id="multiple-condition-runs-mcr">
<span id="user-advanced-features-mcr"></span><h3>Multiple Condition Runs (MCR)<a class="headerlink" href="#multiple-condition-runs-mcr" title="Link to this heading"></a></h3>
<p>WEC-Sim allows users to easily perform batch runs by typing <code class="docutils literal notranslate"><span class="pre">wecSimMCR</span></code> into
the MATLAB Command Window. This command executes the Multiple Condition Run
(MCR) option, which can be initiated three different ways:</p>
<blockquote>
<div><p><strong>Option 1.</strong> Specify a range of sea states and PTO damping coefficients in
the WEC-Sim input file, example:
<code class="docutils literal notranslate"><span class="pre">waves.height</span> <span class="pre">=</span> <span class="pre">1:0.5:5;</span> <span class="pre">waves.period</span> <span class="pre">=</span> <span class="pre">5:1:15;</span></code>
<code class="docutils literal notranslate"><span class="pre">pto(1).stiffness=1000:1000:10000;</span> <span class="pre">pto(1).damping=1200000:1200000:3600000;</span></code></p>
<p><strong>Option 2.</strong>  Specify the excel filename that contains a set of wave
statistic data in the WEC-Sim input file. This option is generally useful
for power matrix generation, example:
<code class="docutils literal notranslate"><span class="pre">simu.mcrExcelFile</span> <span class="pre">=</span> <span class="pre">&quot;&lt;Excel</span> <span class="pre">file</span> <span class="pre">name&gt;.xls&quot;</span></code></p>
<p><strong>Option 3.</strong>  Provide a MCR case <em>.mat</em> file, and specify the filename in
the WEC-Sim input file, example:
<code class="docutils literal notranslate"><span class="pre">simu.mcrMatFile</span> <span class="pre">=</span> <span class="pre">&quot;&lt;File</span> <span class="pre">name&gt;.mat&quot;</span></code></p>
</div></blockquote>
<p>For Multiple Condition Runs, the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> hydrodynamic data is only loaded
once. To reload the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> data between runs, set <code class="docutils literal notranslate"><span class="pre">simu.reloadH5Data</span> <span class="pre">=1</span></code> in
the WEC-Sim input file.</p>
<p>If the Simulink model relies upon <code class="docutils literal notranslate"><span class="pre">From</span> <span class="pre">Workspace</span></code> input blocks other than those utilized by the WEC-Sim library blocks (e.g. <code class="docutils literal notranslate"><span class="pre">waves.elevationFile</span></code>), these can be iterated through using Option 3. The MCR file header MUST be a cell containing the exact string <code class="docutils literal notranslate"><span class="pre">'LoadFile'</span></code>. The pathways of the files to be loaded to the workspace must be given in the <code class="docutils literal notranslate"><span class="pre">cases</span></code> field of the MCR <em>.mat</em> file. WEC-Sim MCR will then run WEC-Sim in sequence, once for each file to be loaded. The variable name of each loaded file should be consistent, and specified by the <code class="docutils literal notranslate"><span class="pre">From</span> <span class="pre">Workspace</span></code> block.</p>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar1"><span class="std std-ref">Series 1 - Multiple Condition Runs (MCR)</span></a>, and the <strong>RM3_MCR</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<p>The <strong>RM3_MCR</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository demonstrate the
use of WEC-Sim MCR for each option above (arrays, .xls, .mat). The fourth case
demonstrates how to vary the wave spectrum input file in each case run by
WEC-Sim MCR.</p>
<p>The directory of an MCR case can contain a <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code>
file that will function as the standard <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctions.m</span></code> file.
Within the MCR application, the <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code> script
creates a power matrix from the PTO damping coefficient after all cases have
been run.</p>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar1"><span class="std std-ref">Series 1 - Multiple Condition Runs (MCR)</span></a>.</p>
</section>
<section id="parallel-computing-toolbox-pct">
<span id="user-advanced-features-pct"></span><h3>Parallel Computing Toolbox (PCT)<a class="headerlink" href="#parallel-computing-toolbox-pct" title="Link to this heading"></a></h3>
<p>WEC-Sim allows users to execute batch runs by typing <code class="docutils literal notranslate"><span class="pre">wecSimPCT</span></code> into the
MATLAB Command Window. This command executes the MATLAB <a class="reference external" href="https://www.mathworks.com/products/parallel-computing.html">Parallel Computing
Toolbox</a> (PCT),
which allows parallel capability for <a class="reference internal" href="#user-advanced-features-mcr"><span class="std std-ref">Multiple Condition Runs (MCR)</span></a> but adds
an additional MATLAB dependency to use this feature. Similar to MCR, this
feature can be executed in three ways (Options 1~3).</p>
<p>For PCT runs, the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> hydrodynamic data must be reloaded, regardless the
setting for <code class="docutils literal notranslate"><span class="pre">simu.reloadH5Data</span></code> in the WEC-Sim input file.</p>
<p>The option <code class="docutils literal notranslate"><span class="pre">simu.keepPool=1</span></code> will retain the parallel pool after simulations have finished to facilitate
parallel post-processing. If the pool is no longer needed or needs reinitialization, <code class="docutils literal notranslate"><span class="pre">simu.keepPool=0</span></code> will close the parallel pool after simulations have completed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code> is not compatible with <code class="docutils literal notranslate"><span class="pre">wecSimPCT</span></code>.
Please use <code class="docutils literal notranslate"><span class="pre">userDefinedFunctions.m</span></code> instead.</p>
</div>
</section>
<section id="radiation-force-calculation">
<h3>Radiation Force calculation<a class="headerlink" href="#radiation-force-calculation" title="Link to this heading"></a></h3>
<p>The radiation forces are calculated at each time-step by the convolution of the body velocity and the
radiation Impulse Response Function – which is calculated using the cosine transform of the radiation-damping.
Speed-gains to the simulation can be made by using alternatives to the convolution operation, namely,</p>
<ol class="arabic simple">
<li><p>The State-Space Representation,</p></li>
<li><p>The Finite Impulse Response (FIR) Filters.</p></li>
</ol>
<p>Simulation run-times were benchmarked using the RM3 example simulated for 1000 s. Here is a summary of normalized
run-times when the radiation forces are calculated using different routes. The run-times are normalized by the
run-time for a simulation where the radiation forces are calculated using “Constant Coefficients” ( <span class="math notranslate nohighlight">\(T_0\)</span> ):</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><em>Radiation Force Calculation Approach</em></p></td>
<td><p><em>Normalized Run Time</em></p></td>
</tr>
<tr class="row-even"><td><p>Constant Coefficients</p></td>
<td><p><span class="math notranslate nohighlight">\(T_0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Convolution</p></td>
<td><p><span class="math notranslate nohighlight">\(1.57 \times T_0\)</span></p></td>
</tr>
<tr class="row-even"><td><p>State-Space</p></td>
<td><p><span class="math notranslate nohighlight">\(1.14 \times T_0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>FIR Filter</p></td>
<td><p><span class="math notranslate nohighlight">\(1.35 \times T_0\)</span></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<section id="state-space-representation">
<h4>State-Space Representation<a class="headerlink" href="#state-space-representation" title="Link to this heading"></a></h4>
<p>The convolution integral term in the equation of motion can be linearized using
the state-space representation as described in the <a class="reference internal" href="../theory/index.html#theory"><span class="std std-ref">Theory Manual</span></a> section. To
use a state-space representation, the <code class="docutils literal notranslate"><span class="pre">simu.stateSpace</span></code> simulationClass variable
must be defined in the WEC-Sim input file, for example:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">simu.stateSpace</span> <span class="pre">=</span> <span class="pre">1</span></code></p>
</div></blockquote>
</section>
<section id="finite-impulse-response-fir-filters">
<span id="user-advanced-features-time-step"></span><h4>Finite Impulse Response (FIR) Filters<a class="headerlink" href="#finite-impulse-response-fir-filters" title="Link to this heading"></a></h4>
<p>By default, WEC-Sim uses numerical integration to calculate the convolution integral, while
FIR filters implement the same using a <cite>discretized convolution</cite>, by using FIR filters – digital filters
that are inherently stable. Convolution of Impulse Response Functions of <cite>Finite</cite> length, i.e., those
that dissipate and converge to <cite>zero</cite> can be accomplished using FIR filters.
The convolution integral can also be calculated using FIR filters by setting:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">simu.FIR=1</span></code>.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default <code class="code docutils literal notranslate"><span class="pre">simu.FIR=0</span></code>, unless specified otherwise.</p>
</div>
</section>
</section>
<section id="time-step-features">
<h3>Time-Step Features<a class="headerlink" href="#time-step-features" title="Link to this heading"></a></h3>
<p>The default WEC-Sim solver is ‘ode4’. Refer to the <strong>NonlinearHydro</strong> example
on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a>
repository for a comparisons between ‘ode4’ to
<a class="reference external" href="https://www.mathworks.com/help/matlab/ref/ode45.html">‘ode45’</a>. The following
variables may be changed in the simulationClass (where N is number of increment
steps, default: N=1):</p>
<ul class="simple">
<li><p>Fixed time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code></p></li>
<li><p>Output time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dtOut=N*simu.dt</span></code></p></li>
<li><p>Nonlinear Buoyancy and Froude-Krylov Excitation time-step: <code class="code docutils literal notranslate"><span class="pre">simu.nonlinearDt=N*simu.dt</span></code></p></li>
<li><p>Convolution integral time-step: <code class="code docutils literal notranslate"><span class="pre">simu.cicDt=N*simu.dt</span></code></p></li>
<li><p>Morison force time-step: <code class="code docutils literal notranslate"><span class="pre">simu.morisonDt</span> <span class="pre">=</span> <span class="pre">N*simu.dt</span></code></p></li>
</ul>
<section id="fixed-time-step-ode4">
<h4>Fixed Time-Step (ode4)<a class="headerlink" href="#fixed-time-step-ode4" title="Link to this heading"></a></h4>
<p>When running WEC-Sim with a fixed time-step, 100-200 time-steps per wave period
is recommended to provide accurate hydrodynamic force calculations (ex: simu.dt
= T/100, where T is wave period). However, a smaller time-step may be required
(such as when coupling WEC-Sim with MoorDyn or PTO-Sim). To reduce the required
WEC-Sim simulation time, a different time-step may be specified for nonlinear
buoyancy and Froude-Krylov excitation and for convolution integral
calculations. For all simulations, the time-step should be chosen based on
numerical stability and a convergence study should be performed.</p>
</section>
<section id="variable-time-step-ode45">
<h4>Variable Time-Step (ode45)<a class="headerlink" href="#variable-time-step-ode45" title="Link to this heading"></a></h4>
<p>To run WEC-Sim with a variable time-step, the following variables must be
defined in the simulationClass:</p>
<ul class="simple">
<li><p>Numerical solver: <code class="code docutils literal notranslate"><span class="pre">simu.solver='ode45'</span></code></p></li>
<li><p>Max time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code></p></li>
</ul>
<p>This option sets the maximum time step of the simulation (<code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code>) and
automatically adjusts the instantaneous time step to that required by MATLAB’s
differential equation solver.</p>
</section>
</section>
</section>
<section id="wave-features">
<span id="user-advanced-features-wave"></span><h2>Wave Features<a class="headerlink" href="#wave-features" title="Link to this heading"></a></h2>
<p>This section provides an overview of WEC-Sim’s wave class features. For more
information about the wave class code structure, refer to
<a class="reference internal" href="code_structure.html#user-code-structure-wave-class"><span class="std std-ref">Wave Class</span></a>. The various wave features can be
compared by running the cases within <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">WEC-Sim/Examples/RM3</span></code> and <code class="docutils literal notranslate"><span class="pre">the</span>
<span class="pre">WEC-Sim/Examples/OSWEC</span></code> directories.</p>
<section id="irregular-wave-binning">
<span id="user-advanced-features-irregular-wave-binning"></span><h3>Irregular Wave Binning<a class="headerlink" href="#irregular-wave-binning" title="Link to this heading"></a></h3>
<p>WEC-Sim’s default spectral binning method divides the wave spectrum into 499
bins with equal energy content, defined by 500 wave frequencies. As a result,
the wave forces on the WEC using the equal energy method are only computed at
each of the 500 wave frequencies. The equal energy formulation speeds up the
irregular wave simulation time by reducing the number of frequencies the wave
train is defined by, and thus the number of frequencies for which the wave
forces are calculated. It prevents bins with very little energy from being
created and unnecessarily adding to the computational cost. The equal energy
method is specified by defining the following wave class variable in the
WEC-Sim input file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">waves.bem.option</span> <span class="pre">=</span> <span class="pre">'EqualEnergy';</span></code></p>
</div></blockquote>
<p>By comparison, the traditional method divides the wave spectrum into a
sufficiently large number of equally spaced bins to define the wave spectrum.
WEC-Sim’s traditional formulation uses 999 bins, defined by 1000 wave
frequencies of equal frequency distribution. To override WEC-Sim’s default
equal energy method, and instead use the traditional binning method, the
following wave class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">waves.bem.option</span> <span class="pre">=</span> <span class="pre">'Traditional';</span></code></p>
</div></blockquote>
<p>Users may override the default number of wave frequencies by defining
<code class="docutils literal notranslate"><span class="pre">waves.bem.count</span></code>. However, it is on the user to ensure that the wave spectrum
is adequately defined by the number of wave frequencies, and that the wave
forces are not impacted by this change.</p>
</section>
<section id="wave-directionality">
<h3>Wave Directionality<a class="headerlink" href="#wave-directionality" title="Link to this heading"></a></h3>
<p>WEC-Sim has the ability to model waves with various angles of incidence,
<span class="math notranslate nohighlight">\(\theta\)</span>. To define wave directionality in WEC-Sim, the following wave
class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">waves.direction</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">wave</span> <span class="pre">direction(s)&gt;;</span> <span class="pre">%[deg]</span></code></p>
</div></blockquote>
<p>The incident wave direction has a default heading of 0 Degrees (Default = 0),
and should be defined as a column vector for more than one wave direction. For
more information about the wave formulation, refer to
<a class="reference internal" href="../theory/theory.html#theory-wave-spectra"><span class="std std-ref">Wave Spectra</span></a>.</p>
</section>
<section id="wave-directional-spreading">
<h3>Wave Directional Spreading<a class="headerlink" href="#wave-directional-spreading" title="Link to this heading"></a></h3>
<p>WEC-Sim has the ability to model waves with directional spreading,
<span class="math notranslate nohighlight">\(D\left( \theta \right)\)</span>. To define wave directional spreading in
WEC-Sim, the following wave class variable must be defined in the WEC-Sim input
file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">waves.spread</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">directional</span> <span class="pre">spreading&gt;;</span></code></p>
</div></blockquote>
<p>The wave directional spreading has a default value of 1 (Default = 1), and
should be defined as a column vector of directional spreading for each one wave
direction. For more information about the spectral formulation, refer to
<a class="reference internal" href="../theory/theory.html#theory-wave-spectra"><span class="std std-ref">Wave Spectra</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users must define appropriate spreading parameters to ensure energy is
conserved. Recommended directional spreading functions include
Cosine-Squared and Cosine-2s.</p>
</div>
</section>
<section id="multiple-wave-spectra">
<span id="user-advanced-features-seeded-phase"></span><h3>Multiple Wave-Spectra<a class="headerlink" href="#multiple-wave-spectra" title="Link to this heading"></a></h3>
<p>The Wave Directional Spreading feature only allows splitting the same wave-front.
However, quite often mixed-seas are composed of disparate Wave-Spectra with unique
periods, heights, and directions. An example would be a sea-state composed of
swell-waves and chop-waves.</p>
<p>Assuming that the linear potential flow theory holds, the wave inputs to the system can be
super-imposed. This implies, the effects of multiple Wave-Spectra can be simulated, if the
excitation-forces for each Wave-Spectra is calculated, and added to the pertinent
Degree-of-Freedom.</p>
<p>WEC-Sim can simulate the dynamics of a body experiencing multiple Wave-Spectra each with
their unique directions, periods, and heights. In order to calculate the excitation-forces
for multiple Wave-Spectra, WEC-Sim automatically generates multiple instances of
excitation-force sub-systems. The user only needs to create multiple instances of
the <code class="docutils literal notranslate"><span class="pre">waves</span></code> class.</p>
<p>Here is an example for setting up multiple Wave-Spectra in the WEC-Sim input file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">waves</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>           <span class="o">=</span> <span class="n">waveClass</span><span class="p">(</span><span class="s1">&#39;regularCIC&#39;</span><span class="p">);</span>   <span class="o">%</span> <span class="n">Initialize</span> <span class="n">Wave</span> <span class="n">Class</span> <span class="ow">and</span> <span class="n">Specify</span> <span class="n">Type</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">height</span>    <span class="o">=</span> <span class="mf">2.5</span><span class="p">;</span>                       <span class="o">%</span> <span class="n">Wave</span> <span class="n">Height</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">period</span>    <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>                         <span class="o">%</span> <span class="n">Wave</span> <span class="n">Period</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                         <span class="o">%</span> <span class="n">Wave</span> <span class="n">Direction</span> <span class="p">(</span><span class="n">deg</span><span class="o">.</span><span class="p">)</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>           <span class="o">=</span> <span class="n">waveClass</span><span class="p">(</span><span class="s1">&#39;regularCIC&#39;</span><span class="p">);</span>   <span class="o">%</span> <span class="n">Initialize</span> <span class="n">Wave</span> <span class="n">Class</span> <span class="ow">and</span> <span class="n">Specify</span> <span class="n">Type</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">height</span>    <span class="o">=</span> <span class="mf">2.5</span><span class="p">;</span>                       <span class="o">%</span> <span class="n">Wave</span> <span class="n">Height</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">period</span>    <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>                         <span class="o">%</span> <span class="n">Wave</span> <span class="n">Period</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
<span class="n">waves</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span>                        <span class="o">%</span> <span class="n">Wave</span> <span class="n">Direction</span> <span class="p">(</span><span class="n">deg</span><span class="o">.</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>1. If using a wave-spectra with different wave-heading directions, ensure that the BEM data has
the hydrodynamic coefficients corresponding to the desired wave-heading direction,</p>
<p>2. All wave-spectra should be of the same type, i.e., if <code class="code docutils literal notranslate"><span class="pre">waves(1)</span></code> is initialized
as <code class="code docutils literal notranslate"><span class="pre">waves(1)</span> <span class="pre">=</span> <span class="pre">waveClass('regularCIC')</span></code>, the following <code class="code docutils literal notranslate"><span class="pre">waves(#)</span></code> object should
initialized the same way.</p>
</div>
<p>Addtionally, the multiple Wave-Spectra can be visualized as elaborated in <a class="reference internal" href="#user-advanced-features-wave-markers"><span class="std std-ref">Wave Markers</span></a>.
The user needs to define the marker parameters for each Wave-Spectra, as one would for a single Wave-Spectra.</p>
<p>Here is an example of 2 Wave-Spectra being visualized using the wave wave-markers feature:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Nwave.png"><img alt="../_images/Nwave.png" src="../_images/Nwave.png" style="width: 600pt;" />
</a>
</figure>
<p>Here is a visualization of two Wave-Spectra, represented by red markers and blue markers respectively.</p>
</section>
<section id="irregular-waves-with-seeded-phase">
<h3>Irregular Waves with Seeded Phase<a class="headerlink" href="#irregular-waves-with-seeded-phase" title="Link to this heading"></a></h3>
<p>By default, the phase for all irregular wave cases are generated randomly. In
order to reproduce the same time-series every time an irregular wave simulation
is run, the following wave class variable may be defined in the WEC-Sim input
file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">waves.phaseSeed</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">seed&gt;;</span></code></p>
</div></blockquote>
<p>By setting <code class="docutils literal notranslate"><span class="pre">waves.phaseSeed</span></code> equal to 1,2,3,…,etc, the random wave phase
generated by WEC-Sim is seeded, thus producing the same random phase for each
simulation.</p>
</section>
<section id="wave-gauge-placement">
<h3>Wave Gauge Placement<a class="headerlink" href="#wave-gauge-placement" title="Link to this heading"></a></h3>
<p>Wave gauges can be included through the wave class parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">waves</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">location</span>
<span class="n">waves</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">size</span>
<span class="n">waves</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">style</span>
</pre></div>
</div>
<p>By default, the wave surface elevation at the origin is calculated by WEC-Sim.
In past releases, there was the option to define up to three numerical wave gauge
locations where WEC-Sim would also calculate the undisturbed linear incident wave
elevation. WEC-Sim now has the feature to define wave markers that oscillate
vertically with the undistrubed linear wave elevation (see <a class="reference internal" href="#user-advanced-features-wave-markers"><span class="std std-ref">Wave Markers</span></a>).
This feature does not limit the number of point measurements of the undisturbed
free surface elevation and the time history calculation at the marker location
is identical to the previous wave gauge implementation. Users who desire to
continuing using the previous wave gauge feature will only need to update the
variable called within WEC-Sim and an example can be found in the
<a class="reference external" href="https://github.com/WEC-Sim/WECCCOMP">WECCCOMP Repository</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The numerical wave markers (wave gauges) do not handle the incident wave interaction with the radiated or diffracted
waves that are generated because of the presence and motion of any hydrodynamic bodies.</p>
</div>
</section>
<section id="ocean-current">
<span id="user-advanced-features-current"></span><h3>Ocean Current<a class="headerlink" href="#ocean-current" title="Link to this heading"></a></h3>
<p>The speed of an ocean current can be included through the wave class parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">waves</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">option</span>
<span class="n">waves</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">speed</span>
<span class="n">waves</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">direction</span>
<span class="n">waves</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">depth</span>
</pre></div>
</div>
<p>The current option determines the method used to propagate the surface current across the
specified depth. Option 0 is depth independent, option 1 uses a 1/7 power law, option 2
uses linear variation with depth and option 3 specifies no ocean current.
The <code class="docutils literal notranslate"><span class="pre">current.speed</span></code> parameter represents the surface current speed, and <code class="docutils literal notranslate"><span class="pre">current.depth</span></code>
the depth at which the current speed decays to zero (given as a positive number).
See <a class="reference internal" href="../theory/theory.html#theory-current"><span class="std std-ref">Ocean Current</span></a> for more details on each method.
These parameters are used to calculate the fluid velocity in the Morison Element calculation.</p>
</section>
</section>
<section id="body-features">
<span id="user-advanced-features-body"></span><h2>Body Features<a class="headerlink" href="#body-features" title="Link to this heading"></a></h2>
<p>This section provides an overview of WEC-Sim’s body class features; for more
information about the body class code structure, refer to
<a class="reference internal" href="code_structure.html#user-code-structure-body-class"><span class="std std-ref">Body Class</span></a>.</p>
<section id="body-mass-and-geometry-features">
<h3>Body Mass and Geometry Features<a class="headerlink" href="#body-mass-and-geometry-features" title="Link to this heading"></a></h3>
<p>The mass of each body must be specified in the WEC-Sim input file. The
following features are available:</p>
<ul class="simple">
<li><p><strong>Floating Body</strong> - the user may set <code class="code docutils literal notranslate"><span class="pre">body(i).mass</span> <span class="pre">=</span> <span class="pre">'equilibrium'</span></code>
which will calculate the body mass based on displaced volume and water
density. If <code class="code docutils literal notranslate"><span class="pre">simu.nonlinearHydro</span> <span class="pre">=</span> <span class="pre">0</span></code>, then the mass is calculated using the
displaced volume contained in the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file. If <code class="code docutils literal notranslate"><span class="pre">simu.nonlinearHydro</span> <span class="pre">=</span> <span class="pre">1</span></code>
or <code class="code docutils literal notranslate"><span class="pre">simu.nonlinearHydro</span> <span class="pre">=</span> <span class="pre">2</span></code>, then the mass is calculated using the displaced
volume of the provided STL geometry file.</p></li>
<li><p><strong>Fixed Body</strong> - if a body is fixed to the seabed using a fixed constraint, the mass
and moment of inertia may be set to arbitrary values such as 999 kg and [999 999 999]
kg-m^2. If the constraint forces on the fixed body are important, the mass and inertia
should be set to their real values.</p></li>
<li><p><strong>Import STL</strong> - to read in the geometry (<code class="docutils literal notranslate"><span class="pre">*.stl</span></code>) into Matlab use the
<code class="code docutils literal notranslate"><span class="pre">body(i).importBodyGeometry()</span></code> method in the bodyClass. This method will import the
mesh details (vertices, faces, normals, areas, centroids) into the
<code class="code docutils literal notranslate"><span class="pre">body(i).geometry</span></code> property. This method is also used for nonlinear
buoyancy and Froude-Krylov excitation and ParaView visualization files. Users
can then visualize the geometry using the <code class="code docutils literal notranslate"><span class="pre">body(i).plotStl</span></code> method.</p></li>
</ul>
</section>
<section id="nonlinear-buoyancy-and-froude-krylov-excitation">
<span id="user-advanced-features-nonlinear"></span><h3>Nonlinear Buoyancy and Froude-Krylov Excitation<a class="headerlink" href="#nonlinear-buoyancy-and-froude-krylov-excitation" title="Link to this heading"></a></h3>
<p>WEC-Sim has the option to include the nonlinear hydrostatic restoring and
Froude-Krylov forces when solving the system dynamics of WECs, accounting for
the weakly nonlinear effect on the body hydrodynamics. To use nonlinear
buoyancy and Froude-Krylov excitation, the <strong>body(ii).nonlinearHydro</strong> bodyClass
variable must be defined in the WEC-Sim input file, for example:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">body(ii).nonlinearHydro</span> <span class="pre">=</span> <span class="pre">2</span></code></p>
</div></blockquote>
<p>For more information, refer to the <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Series 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation</span></a>, and the <strong>NonlinearHydro</strong>
example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a>
repository.</p>
<section id="nonlinear-settings">
<h4>Nonlinear Settings<a class="headerlink" href="#nonlinear-settings" title="Link to this heading"></a></h4>
<p><strong>body(ii).nonlinearHydro</strong>  -
The nonlinear hydrodynamics option can be used with the parameter:
<code class="code docutils literal notranslate"><span class="pre">body(ii).nonlinearHydro</span></code> in your WEC-Sim input file. When any of the three
nonlinear options (below) are used, WEC-Sim integrates the wave pressure over
the surface of the body, resulting in more accurate buoyancy and Froude-Krylov
force calculations.</p>
<blockquote>
<div><p><strong>Option 1.</strong> <code class="code docutils literal notranslate"><span class="pre">body(ii).nonlinearHydro</span> <span class="pre">=</span> <span class="pre">1</span></code> This option integrates the pressure
due to the mean wave elevation and the instantaneous body position.</p>
<p><strong>Option 2.</strong> <code class="code docutils literal notranslate"><span class="pre">body(ii).nonlinearHydro</span> <span class="pre">=</span> <span class="pre">2</span></code> This option integrates the pressure
due to the instantaneous wave elevation and the instantaneous body position.
This option is recommended if nonlinear effects need to be considered.</p>
</div></blockquote>
<p><strong>simu.nonlinearDt</strong> -
An option available to reduce the nonlinear simulation time is to specify a
nonlinear time step, <code class="code docutils literal notranslate"><span class="pre">simu.nonlinearDt=N*simu.dt</span></code>, where N is number of
increment steps. The nonlinear time step specifies the interval at which the
nonlinear hydrodynamic forces are calculated. As the ratio of the nonlinear to
system time step increases, the computation time is reduced, again, at the
expense of the simulation accuracy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WEC-Sim’s nonlinear buoyancy and Froude-Krylov wave excitation option may
be used for regular or irregular waves but not with user-defined irregular
waves.</p>
</div>
</section>
<section id="stl-file-generation">
<h4>STL File Generation<a class="headerlink" href="#stl-file-generation" title="Link to this heading"></a></h4>
<p>When the nonlinear option is turned on, the geometry file (<code class="docutils literal notranslate"><span class="pre">*.stl</span></code>)
(previously only used for visualization purposes in linear simulations) is used
as the discretized body surface on which the nonlinear pressure forces are
integrated. As in the linear case, the STL mesh origin must be at a body’s center of gravity.</p>
<p>A good STL mesh resolution is required when using the nonlinear buoyancy and Froude-Krylov wave excitation in
WEC-Sim. The simulation accuracy will increase with increased surface
resolution (i.e. the number of discretized surface panels specified in the
<code class="docutils literal notranslate"><span class="pre">*.stl</span></code> file), but the computation time will also increase.
There are many ways to generate an STL file; however, it is important to verify
the quality of the mesh before running WEC-Sim simulations with the nonlinear
hydro flag turned on. An STL file can be exported from most CAD programs, but
few allow adequate mesh refinement. By default, most CAD programs write an STL
file similar to the left figure, with the minimum panels possible.
To accurately model nonlinear hydrodynamics in WEC-Sim, STL files should be refined to
have an aspect ratio close to one, and contain a high resolution in the vertical direction
so that an accurate instantaneous displaced volume can be calculated.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/rectangles.png"><img alt="../_images/rectangles.png" src="../_images/rectangles.png" style="width: 300pt;" />
</a>
</figure>
<p>Many commercial and free software exist to convert between mesh formats and
refine STL files, including:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.freecadweb.org/">Free CAD</a></p></li>
<li><p><a class="reference external" href="https://github.com/BEMRosetta/BEMRosetta">BEM Rosetta</a></p></li>
<li><p><a class="reference external" href="https://lheea.github.io/meshmagick/index.html">Meshmagick</a></p></li>
<li><p><a class="reference external" href="https://coreform.com/products/coreform-cubit/">Coreform CUBIT</a> (commercial)</p></li>
<li><p><a class="reference external" href="https://www.rhino3d.com/">Rhino</a> (commercial)</p></li>
</ul>
</section>
<section id="nonlinear-buoyancy-and-froude-krylov-wave-excitation-tutorial-heaving-ellipsoid">
<span id="user-advanced-features-nonlinear-tutorial-heaving-ellipsoid"></span><h4>Nonlinear Buoyancy and Froude-Krylov Wave Excitation Tutorial - Heaving Ellipsoid<a class="headerlink" href="#nonlinear-buoyancy-and-froude-krylov-wave-excitation-tutorial-heaving-ellipsoid" title="Link to this heading"></a></h4>
<p>The body tested in the study is an ellipsoid with a cross- section
characterized by semi-major and -minor axes of 5.0 m and 2.5 m in the wave
propagation and normal directions, respectively . The ellipsoid is at its
equilibrium position with its origin located at the mean water surface. The
mass of the body is then set to 1.342×105 kg, and the center of gravity is
located 2 m below the origin.</p>
<figure class="align-center" id="user-advanced-features-nonlinearellipsoid">
<a class="reference internal image-reference" href="../_images/nonlinearEllipsoid.png"><img alt="../_images/nonlinearEllipsoid.png" src="../_images/nonlinearEllipsoid.png" style="width: 350pt;" />
</a>
</figure>
<p>STL file with the discretized body surface is shown below (<code class="docutils literal notranslate"><span class="pre">ellipsoid.stl</span></code>)</p>
<figure class="align-center" id="user-advanced-features-nonlinearmesh">
<a class="reference internal image-reference" href="../_images/nonlinearMesh.png"><img alt="../_images/nonlinearMesh.png" src="../_images/nonlinearMesh.png" style="width: 250pt;" />
</a>
</figure>
<p>The single-body heave only WEC model is shown below (<code class="docutils literal notranslate"><span class="pre">nonLinearHydro.slx</span></code>)</p>
<figure class="align-center" id="user-advanced-features-nonlinearwec">
<a class="reference internal image-reference" href="../_images/nonlinearWEC.png"><img alt="../_images/nonlinearWEC.png" src="../_images/nonlinearWEC.png" style="width: 450pt;" />
</a>
</figure>
<p>The WEC-Sim input file used to run the nonlinear hydro WEC-Sim simulation:</p>
<div class="highlight-matlab notranslate" id="user-advanced-features-nonlinearwecsiminputfile"><div class="highlight"><pre><span></span><span class="c">%% Simulation Data</span>
<span class="n">simu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulationClass</span><span class="p">();</span><span class="w">               </span>
<span class="n">simu</span><span class="p">.</span><span class="n">simMechanicsFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ellipsoid.slx&#39;</span><span class="p">;</span><span class="w">   </span>
<span class="n">simu</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;normal&#39;</span><span class="p">;</span><span class="w">                   </span><span class="c">% Specify Simulation Mode (&#39;normal&#39;,&#39;accelerator&#39;,&#39;rapid-accelerator&#39;)</span>
<span class="n">simu</span><span class="p">.</span><span class="n">explorer</span><span class="p">=</span><span class="s">&#39;off&#39;</span><span class="p">;</span><span class="w">                     </span><span class="c">% Turn SimMechanics Explorer (on/off)</span>
<span class="n">simu</span><span class="p">.</span><span class="n">startTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                     </span>
<span class="n">simu</span><span class="p">.</span><span class="n">rampTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w">                        </span>
<span class="n">simu</span><span class="p">.</span><span class="n">endTime</span><span class="p">=</span><span class="mi">150</span><span class="p">;</span><span class="w">                       </span>
<span class="n">simu</span><span class="p">.</span><span class="n">dt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span><span class="w">                         </span>
<span class="n">simu</span><span class="p">.</span><span class="n">rho</span><span class="p">=</span><span class="mi">1025</span><span class="p">;</span><span class="w">                                                                                                           </span>

<span class="c">%% Wave Information</span>
<span class="c">% Regular Waves </span>
<span class="n">waves</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">waveClass</span><span class="p">(</span><span class="s">&#39;regular&#39;</span><span class="p">);</span><span class="w">                 </span>
<span class="n">waves</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">                            </span>
<span class="n">waves</span><span class="p">.</span><span class="n">period</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">   </span>

<span class="c">%% Body Data</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../hydroData/ellipsoid.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">mass</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;equilibrium&#39;</span><span class="p">;</span><span class="w">           </span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">inertia</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span><span class="c">              </span>
<span class="w">    </span><span class="p">[</span><span class="mf">1.375264e6</span><span class="w"> </span><span class="mf">1.375264e6</span><span class="w"> </span><span class="mf">1.341721e6</span><span class="p">];</span><span class="w">      </span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">geometryFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;../../geometry/elipsoid.stl&#39;</span><span class="w"> </span><span class="p">;</span><span class="w">    </span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">quadDrag</span><span class="p">.</span><span class="n">cd</span><span class="p">=[</span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">quadDrag</span><span class="p">.</span><span class="n">area</span><span class="p">=[</span><span class="mi">25</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nb">pi</span><span class="o">*</span><span class="mi">5</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nb">pi</span><span class="o">*</span><span class="mi">5</span><span class="o">^</span><span class="mi">5</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">nonlinearHydro</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                       </span><span class="c">% Non-linear hydro on/off</span>

<span class="c">%% PTO and Constraint Parameters</span>
<span class="c">% Fixed Constraint</span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">constraintClass</span><span class="p">(</span><span class="s">&#39;Constraint1&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mf">12.5</span><span class="p">];</span><span class="w">        </span>

<span class="c">% Translational PTO</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoClass</span><span class="p">(</span><span class="s">&#39;PTO1&#39;</span><span class="p">);</span><span class="w">              </span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">stiffness</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="w">                             </span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">damping</span><span class="p">=</span><span class="mi">1200000</span><span class="p">;</span><span class="w">                      </span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mf">12.5</span><span class="p">];</span>
</pre></div>
</div>
<p>Simulation and post-processing is the same process as described in the
<a class="reference internal" href="tutorials.html#user-tutorials"><span class="std std-ref">Tutorials</span></a> section.</p>
</section>
</section>
<section id="viscous-damping-and-morison-elements">
<h3>Viscous Damping and Morison Elements<a class="headerlink" href="#viscous-damping-and-morison-elements" title="Link to this heading"></a></h3>
<p>WEC-Sim allows for the definition of additional damping and added-mass terms
to allow users to tune their models precisely. Viscous damping and Morison Element
may be defined for hydrodynamic, drag, or flexible bodies. It is highly recommended
that users add viscous or Morison drag to create a realistic model.</p>
<p>When the Morison Element
option is used in combination with a hydrodynamic or flexible body, it serves as a
tuning method. The equation of motion for hydrodynamic and flexible bodies with a
Morison Element is more complex than the traditional Morison Element formulation.
A traditional Morison Element may be created by using a drag body
(<code class="docutils literal notranslate"><span class="pre">body(#).nonHydro=2</span></code>) with <code class="docutils literal notranslate"><span class="pre">body(#).morisonElement.option</span> <span class="pre">=</span> <span class="pre">1</span> <span class="pre">or</span> <span class="pre">2</span></code>.
For more information about the numerical formulation of viscous damping and
Morison Elements, refer to the theory section <a class="reference internal" href="../theory/theory.html#theory-viscous-damping-morison"><span class="std std-ref">Viscous Damping and Morison Elements</span></a>.</p>
<section id="viscous-damping">
<h4>Viscous Damping<a class="headerlink" href="#viscous-damping" title="Link to this heading"></a></h4>
<p>A viscous damping force in the form of a linear damping coefficient
<span class="math notranslate nohighlight">\(C_{v}\)</span> can be applied to each body by defining the following body class
parameter in the WEC-Sim input file (which has a default value of zero):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">linearDamping</span>
</pre></div>
</div>
<p>A quadratic drag force, proportional to the square of the body’s velocity, can
be applied to each body by defining the quadratic drag coefficient
<span class="math notranslate nohighlight">\(C_{d}\)</span>, and the characteristic area <span class="math notranslate nohighlight">\(A_{d}\)</span> for drag calculation.
This is achieved by defining the following body class parameters in the WEC-Sim
input file (each of which have a default value of zero):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">cd</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">area</span>
</pre></div>
</div>
<p>Alternatively, one can define <span class="math notranslate nohighlight">\(C_{D}\)</span> directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">drag</span>
</pre></div>
</div>
</section>
<section id="morison-elements">
<span id="user-advanced-features-morison"></span><h4>Morison Elements<a class="headerlink" href="#morison-elements" title="Link to this heading"></a></h4>
<p>To use Morison Elements, the following body class variable must be
defined in the WEC-Sim input file with <code class="code docutils literal notranslate"><span class="pre">body(ii).morisonElement.option</span></code>.</p>
<p>Implementation Option 0 Morison Elements are not included in the body force and moment calculations.</p>
<p>Implementation Option 1 allows for the Morison Element properties to be defined
independently for the x-, y-, and z-axis while Implementation Option 2 uses a
normal and tangential representation of the Morison Element properties. Note
that the two options allow the user flexibility to implement hydrodynamic
forcing that best suits their modeling needs; however, the two options have
slightly different calculation methods and therefore the outputs will not
necessarily provide the same forcing values. The user is directed to look at
the Simulink Morison Element block within the WEC-Sim library to better
determine which approach better suits their modeling requirements.</p>
<p>Morison Elements must be defined for each body using the
<code class="code docutils literal notranslate"><span class="pre">body(i).morisonElement</span></code> property of the body class. This property
requires definition of the following body class parameters in the WEC-Sim input
file (each of which have a default value of zero(s)).</p>
<p>For <code class="code docutils literal notranslate"><span class="pre">body(ii).morisonElement.option</span>&#160; <span class="pre">=</span> <span class="pre">1</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">dx</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dy</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">ax</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">ay</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">az</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_</span><span class="p">{</span><span class="n">x</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">y</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">z</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span> <span class="o">=</span> <span class="p">[</span><span class="n">V_</span><span class="p">{</span><span class="n">me</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_</span><span class="p">{</span><span class="n">gx</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gy</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Option 1, the unit normal <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.z</span></code> must be
initialized as a [<code class="code docutils literal notranslate"><span class="pre">n</span></code> x3] vector, where <code class="code docutils literal notranslate"><span class="pre">n</span></code> is the number of Morison Elements, although it will not be used in the
hydrodynamic calculation.</p>
</div>
<p>For <code class="code docutils literal notranslate"><span class="pre">body(ii).morisonElement.option</span>&#160; <span class="pre">=</span> <span class="pre">2</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">dn</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dt</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">an</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">at</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">t</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span> <span class="o">=</span> <span class="p">[</span><span class="n">V_</span><span class="p">{</span><span class="n">me</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_</span><span class="p">{</span><span class="n">gx</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gy</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_</span><span class="p">{</span><span class="n">x</span><span class="p">}</span> <span class="n">z_</span><span class="p">{</span><span class="n">y</span><span class="p">}</span> <span class="n">z_</span><span class="p">{</span><span class="n">z</span><span class="p">}]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Option 2, the <code class="code docutils literal notranslate"><span class="pre">body(i).morisonElement.cd</span></code>,
<code class="code docutils literal notranslate"><span class="pre">body(i).morisonElement.ca</span></code>, and
<code class="code docutils literal notranslate"><span class="pre">body(i).morisonElement.area</span></code> variables need to be
initialized as [<code class="code docutils literal notranslate"><span class="pre">n</span></code> x3] vector, where <code class="code docutils literal notranslate"><span class="pre">n</span></code> is the number of Morison Elements, with the third column index set to zero. While
<code class="code docutils literal notranslate"><span class="pre">body(i).morisonElement.z</span></code> is a unit normal vector that defines the
orientation of the Morison Element.</p>
</div>
<p>To better represent certain scenarios, an ocean current speed can be defined to
calculate a more accurate fluid velocity and acceleration on the Morison
Element. These can be defined through the wave class parameters
<code class="docutils literal notranslate"><span class="pre">waves.current.option</span></code>, <code class="docutils literal notranslate"><span class="pre">waves.current.speed</span></code>, <code class="docutils literal notranslate"><span class="pre">waves.current.direction</span></code>,
and <code class="docutils literal notranslate"><span class="pre">waves.current.depth</span></code>. See <a class="reference internal" href="#user-advanced-features-current"><span class="std std-ref">Ocean Current</span></a> for more
detail on using these options.</p>
<p>The Morison Element time-step may also be defined as
<code class="code docutils literal notranslate"><span class="pre">simu.morisonDt</span> <span class="pre">=</span> <span class="pre">N*simu.dt</span></code>, where N is number of increment steps. For an
example application of using Morison Elements in WEC-Sim, refer to the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim
Applications</a> repository
<strong>Free_Decay/1m-ME</strong> example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Morison Elements cannot be used with <code class="code docutils literal notranslate"><span class="pre">elevationImport</span></code>.</p>
</div>
</section>
</section>
<section id="second-order-excitation-forces-and-quadratic-transfer-functions-qtfs">
<span id="user-advanced-features-second-order-excitation-forces"></span><h3>Second-Order Excitation Forces and Quadratic Transfer Functions (QTFs)<a class="headerlink" href="#second-order-excitation-forces-and-quadratic-transfer-functions-qtfs" title="Link to this heading"></a></h3>
<p>For large offshore structures, second-order wave excitation forces can significantly influence system behavior—particularly in surge, pitch, and other low-frequency motions. These forces arise from interactions between pairs of wave frequencies, <span class="math notranslate nohighlight">\(\omega_i\)</span> and <span class="math notranslate nohighlight">\(\omega_j\)</span>, within the wave spectrum.</p>
<p>There are two types of second-order forces:</p>
<ul class="simple">
<li><p><strong>Sum-frequency forces</strong> (<span class="math notranslate nohighlight">\(\omega_i + \omega_j\)</span>): High-frequency components that can excite fast body motions.</p></li>
<li><p><strong>Difference-frequency forces</strong> (<span class="math notranslate nohighlight">\(\omega_i - \omega_j\)</span>): Low-frequency components that can induce slow-drift responses, commonly in surge or pitch.</p></li>
</ul>
<p>WEC-Sim supports <strong>Quadratic Transfer Functions (QTFs)</strong> to model second-order excitation forces. These can be imported from hydrodynamic solvers such as <strong>WAMIT</strong> and <strong>NEMOH</strong>. BEMIO functions will automatically read, process, and write QTF coefficients from WAMIT and NEMOH to the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.</p>
<section id="file-naming-and-conventions">
<h4>File Naming and Conventions<a class="headerlink" href="#file-naming-and-conventions" title="Link to this heading"></a></h4>
<p>The QTF file naming depends on the hydrodynamics solver:</p>
<p><strong>WAMIT</strong></p>
<ul>
<li><p>QTF files should be located in the same folder as the <cite>.out</cite> file.</p></li>
<li><p>File naming format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qtfResults_</span><span class="o">&lt;</span><span class="n">body</span><span class="c1">#&gt;.11s</span>
<span class="n">qtfResults_</span><span class="o">&lt;</span><span class="n">body</span><span class="c1">#&gt;.11d</span>
</pre></div>
</div>
<p>Example: <code class="docutils literal notranslate"><span class="pre">qtfWAMIT_1.11s</span></code></p>
</li>
<li><p>Note: WAMIT uses <strong>1-based indexing</strong> for body numbers.</p></li>
</ul>
<p><strong>NEMOH</strong></p>
<ul>
<li><p>QTF files should follow this naming format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OUT_QTFP_N_</span><span class="o">&lt;</span><span class="n">body</span><span class="c1">#&gt;.dat   (for sum-frequency QTFs)</span>
<span class="n">OUT_QTFM_N_</span><span class="o">&lt;</span><span class="n">body</span><span class="c1">#&gt;.dat   (for difference-frequency QTFs)</span>
</pre></div>
</div>
</li>
<li><p>NEMOH uses <strong>0-based indexing</strong> for body numbers.</p></li>
</ul>
</section>
<section id="activating-qtfs-in-wec-sim">
<h4>Activating QTFs in WEC-Sim<a class="headerlink" href="#activating-qtfs-in-wec-sim" title="Link to this heading"></a></h4>
<p>To enable second-order excitation forces in WEC-Sim, use the following flag in your <cite>body(i)</cite> definition:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">body(i).QTFs</span> <span class="pre">=</span> <span class="pre">1</span></code> — Enables <strong>full QTF-based</strong> second-order excitation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">body(i).QTFs</span> <span class="pre">=</span> <span class="pre">2</span></code> — Enables <strong>Standing approximation</strong> for <strong>difference-frequency</strong> forces.
- In this case, sum-frequency components are still computed using full QTFs.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">body[i].QTFs</span></code> and <code class="docutils literal notranslate"><span class="pre">body[i].meanDrift</span></code> together.
This will result in <strong>double-counting</strong> of mean drift forces — once from the QTFs and once from the linear mean drift formulation.
If both <code class="docutils literal notranslate"><span class="pre">body[i].QTFs</span></code> and <code class="docutils literal notranslate"><span class="pre">body[i].meanDrift</span></code> are enabled, a warning will be issued and the standalone mean drift flag will be disabled. Only the QTFs will be used to compute the mean drift forces.</p>
<p>The <strong>Standing approximation</strong> is a modified form of <strong>Newman’s approximation</strong>. While mathematically equivalent, Standing’s formulation is expressed differently and is designed to support multidirectional wave environments. Unlike Newman’s original version, it does not require high-frequency filtering after application.</p>
</div>
</section>
</section>
<section id="drag-bodies">
<span id="user-advanced-features-non-hydro-body"></span><h3>Drag Bodies<a class="headerlink" href="#drag-bodies" title="Link to this heading"></a></h3>
<p>For some simulations, it might be important to model bodies that do not have
hydrodynamic forces acting on them. This could be bodies that are completely
outside of the water but are still connected through a joint to the WEC bodies,
or it could be bodies deeply submerged to the point where the hydrodynamics may
be neglected. WEC-Sim allows for bodies which have no hydrodynamic forces
acting on them and for which no BEM data is provided.</p>
<p>To do this, use the Drag Body block from the WECSim_Lib_Body_Drag Library and initialize it in the
WEC-Sim input file as any other body but leave the name of the <code class="docutils literal notranslate"><span class="pre">h5</span></code> file as
an empty string. Specify <code class="code docutils literal notranslate"><span class="pre">body(i).nonHydro;</span></code>, body name,
mass, moments of inertia, center of gravity, center of buoyancy, geometry file,
location, and displaced volume. You can also specify visualization options and
initial displacement.</p>
<p>To use drag bodies, the following body class variable must be
defined in the WEC-Sim input file, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">nonHydro</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">%</span> <span class="ow">or</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">nonHydro</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>Drag bodies require the following properties to be defined:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">mass</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">inertia</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">centerGravity</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span>
</pre></div>
</div>
<p>Drag bodies with no additional forces acting on them become non-hydrodynamic, no fluid forces act on them,
but they still couple other bodies together, and influence the multibody simulation.
If a drag body is not subject to wave excitation, but damping, added mass, or viscous drag are still a concern,
viscous drag, linear damping, or Morison element forces may be defined. An example of this body type is a
deeply-submerged heave plate of large surface area tethered to a float. In
these instances, the additional forces can be specified by the parameters:</p>
<blockquote>
<div><p>body(i).quadDrag.drag
body(i).quadDrag.cd
body(i).quadDrag.area
body(i).linearDamping</p>
</div></blockquote>
<p>or if using Morison Elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">area</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span>
</pre></div>
</div>
<p>One can additionally describe initial body
displacement in the manner of a hydrodynamic body.</p>
<p>In the case where only drag bodies are used, WEC-Sim does
not read an <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file. Users must define these additional parameters to
account for certain wave settings as there is no hydrodynamic body present in
the simulation to define them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">waves</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">range</span>
<span class="n">waves</span><span class="o">.</span><span class="n">waterDepth</span>
</pre></div>
</div>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Series 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation</span></a>, and the <strong>Nonhydro_Body</strong>
example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
</section>
<section id="body-to-body-interactions">
<span id="user-advanced-features-b2b"></span><h3>Body-To-Body Interactions<a class="headerlink" href="#body-to-body-interactions" title="Link to this heading"></a></h3>
<p>WEC-Sim allows for body-to-body interactions in the radiation force
calculation, thus allowing the motion of one body to impart a force on all
other bodies. The radiation matrices for each body (radiation wave damping and
added mass) required by WEC-Sim and contained in the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file. <strong>For
body-to-body interactions with N total hydrodynamic bodies, the</strong> <code class="docutils literal notranslate"><span class="pre">*h5</span></code>
<strong>data structure is [(6*N), 6]</strong>.</p>
<p>When body-to-body interactions are used, the augmented [(6*N), 6] matrices are
multiplied by concatenated velocity and acceleration vectors of all
hydrodynamic bodies. For example, the radiation damping force for body(2) in a
3-body system with body-to-body interactions would be calculated as the product
of a [1,18] velocity vector and a [18,6] radiation damping coefficients matrix.</p>
<p>To use body-to-body interactions, the following simulation class variable must
be defined in the WEC-Sim input file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">simu</span><span class="o">.</span><span class="n">b2b</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Series 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation</span></a>, and the <strong>RM3_B2B</strong> example in
the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a>
repository.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, body-to-body interactions  are off (<code class="code docutils literal notranslate"><span class="pre">simu.b2b</span> <span class="pre">=</span> <span class="pre">0</span></code>), and
only the <span class="math notranslate nohighlight">\([1+6(i-1):6i, 1+6(i-1):6i]\)</span> sub-matrices are used for each
body (where <span class="math notranslate nohighlight">\(i\)</span> is the body number).</p>
</div>
</section>
<section id="generalized-body-modes">
<span id="user-advanced-features-generalized-body-modes"></span><h3>Generalized Body Modes<a class="headerlink" href="#generalized-body-modes" title="Link to this heading"></a></h3>
<p>To use this, select a Flex Body Block from the WEC-Sim Library (under Body
Elements) and initialize it in the WEC-Sim input file as any other body.
Calculating dynamic response of WECs considering structural flexibility using
WEC-Sim should consist of multiple steps, including:</p>
<ul class="simple">
<li><p>Modal analysis of the studied WEC to identify a set of system natural
frequencies and corresponding mode shapes</p></li>
<li><p>Construct discretized mass and impedance matrices using these structural
modes</p></li>
<li><p>Include these additional flexible degrees of freedom in the BEM code to
calculate hydrodynamic coefficients for the WEC device</p></li>
<li><p>Import the hydrodynamic coefficients to WEC-Sim and conduct dynamic analysis
of the hybrid rigid and flexible body system</p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a>
contains a working sample of a barge with four additional degrees of freedom to
account for bending and shearing of the body. See this example for details on
how to implement and use generalized body modes in WEC-Sim.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Generalized body modes module has only been tested with WAMIT, where BEMIO
may need to be modified for NEMOH, Aqwa and Capytaine.</p>
</div>
</section>
<section id="passive-yaw-implementation">
<span id="user-advanced-features-passive-yaw"></span><h3>Passive Yaw Implementation<a class="headerlink" href="#passive-yaw-implementation" title="Link to this heading"></a></h3>
<p>For non-axisymmetric bodies with yaw orientation that changes substantially
with time, WEC-Sim allows a correction to excitation forces for large yaw
displacements. To enable this correction, add the following to your
<code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">.</span><span class="n">yaw</span><span class="o">.</span><span class="n">option</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Under the default implementation (<code class="code docutils literal notranslate"><span class="pre">body(ii).yaw.option</span> <span class="pre">=</span> <span class="pre">0</span></code>), WEC-Sim uses the
initial yaw orientation of the device relative to the incident waves to
calculate the wave excitation coefficients that will be used for the duration
of the simulation. When the correction is enabled, excitation coefficients are
interpolated from BEM data based upon the instantaneous relative yaw position.
For this to enhance simulation accuracy, BEM data must be available over the
range of observed yaw positions at a sufficiently dense discretization to
capture the significant variations of excitation coefficients with yaw
position. For robust simulation, BEM data should be available from -180 to 170
degrees of yaw (or equivalent).</p>
<p>This can increase simulation time, especially for irregular waves, due to the
large number of interpolations that must occur. To prevent interpolation at
every time-step, <code class="docutils literal notranslate"><span class="pre">body(ii).yaw.threshold</span></code> (default 1 degree) can be specified in the
<code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code> to specify the minimum yaw displacement (in degrees) that
must occur before another interpolation of excitation coefficients will be
calculated. The minimum threshold for good simulation accuracy will be device
specific: if it is too large, no interpolation will occur and the simulation
will behave as <code class="code docutils literal notranslate"><span class="pre">body(ii).yaw.option</span> <span class="pre">=</span> <span class="pre">0</span></code>, but overly small values may not
significantly enhance simulation accuracy while increasing simulation time.</p>
<p>When <code class="code docutils literal notranslate"><span class="pre">body(ii).yaw.option</span> <span class="pre">=</span> <span class="pre">1</span></code>, hydrostatic and radiation forces are
determined from the local body-fixed coordinate system based upon the
instantaneous relative yaw position of the body, as this may differ
substantially from the global coordinate system for large relative yaw values.</p>
<p>A demonstration case of this feature is included in the <strong>PassiveYaw</strong> example
on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a>
repository.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Caution must be exercised when simultaneously using passive yaw and
body-to-body interactions. Passive yaw relies on interpolated BEM solutions
to determine the cross-coupling coefficients used in body-to-body
calculations. Because these BEM solutions are based upon the assumption of
small displacements, they are unlikely to be accurate if a large relative
yaw displacement occurs between the bodies.</p>
</div>
</section>
<section id="large-x-y-displacements">
<span id="user-advanced-features-large-xy-disp"></span><h3>Large X-Y Displacements<a class="headerlink" href="#large-x-y-displacements" title="Link to this heading"></a></h3>
<p>By default, the excitation force applied to the modeled body is calculated at the body’s CG position as defined in BEM.
If large lateral displacements (i.e., in the x or y direction by the default WEC-Sim coordinate system) are expected for the modeled device, it may be desirable to adjust the excitation force to account for this displacment.</p>
<p>When <code class="code docutils literal notranslate"><span class="pre">body(i).largeXYDisplacement.option</span> <span class="pre">=</span> <span class="pre">1</span></code>, the phase of the excitation force exerted on the body is adjusted based upon its displacement as</p>
<p><span class="math notranslate nohighlight">\(\phi_{displacement} = k \omega x(1)*cos(\frac{\theta \pi}{180}) + x(2).*sin(\frac{\theta \pi}{180})\)</span></p>
<p>where k is waves.wavenumber, x(1,2) is displacement in the (x,y) direction, <span class="math notranslate nohighlight">\(\omega\)</span> is waves.omega, and <span class="math notranslate nohighlight">\(\theta\)</span> is waves.direction (in degrees).
This phase is thus the same size as waves.phase, and is then summed with waves.phase to determine excitation force.</p>
<p>Note that this adjustment only affects the incident exciting waves, not the total wave field that is the superposition of exciting and radiating waves.
This implies that this adjustment is only valid for cases where the lateral velocity of the body is significantly less than the celerity of its radiated waves, and is thus not appropriate for sudden, rapid displacements.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature has not been implemented for a user-defined wave elevation.</p>
</div>
</section>
<section id="variable-hydrodynamics">
<h3>Variable Hydrodynamics<a class="headerlink" href="#variable-hydrodynamics" title="Link to this heading"></a></h3>
<section id="overview">
<span id="user-advanced-features-variable-hydro"></span><h4>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h4>
<p>Variable Hydrodynamics enables users to change the
<em>state</em> of a hydrodyamic body during simulation. A body’s <em>state</em> could reflect
any number of scenarios, such as a variable geometry
changing shape, a flooding body, a change in operational depth, load shedding
capabilities, time-dependent changes to a device, etc. A signal, such as
kinematics, dynamics, or time, is used to alter the state of the device
during simulation. This feature expands WEC-Sim’s simulation capabilities and enables
modeling a new breadth of scenarios in the time domain.</p>
<p>The varying state of a body is represented by changing the hydrodynamic
coefficients used to calculate hydrodyamic forcing during the simulation.
User defined logic and user selected signals determine
when the state changes. The Variable Hydrodynamics feature does not determine
a specific scenario, state, signal, or discretization required.</p>
<p>For a case which varies the mass of the body, the body library link in the Simulink
model will need to be broken and the default File Solid : Body Properties block
replaced with the General Variable Mass block. See the variable hydro WEC-Sim
Application.</p>
</section>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h4>
<p>For example, take the scenario where a device submerges to shed loads. Once the
total force on the device hits some threshold, a tether is reeled into submerge
the device, decreasing its operational depth by three meters. This could be
accomplished by defining a custom force on the body that is applied once the
total force is large enough.</p>
<p>Without variable hydrodynamics, as the device depth gets farther from it’s
initial position, the hydrodynamic loading becomes increasingly inaccurate.
Using variable hydrodynamics, the hydrodynamic loading can remain accurate
by updating force coefficients based on the device’s instantaneous depth.</p>
<p>In this example, the state of the device is its operational depth
(heave position). The total force and heave position are both signals that
dictate the varying hydrodynamics. The total force triggers a custom PTO
force, and the heave position determines what BEM dataset is used as the body
submerges.</p>
<p>User defined logic dictates how quickly the operational depth changes, and
selects the corresponding BEM data at the new state.
In this case, the user could supply BEM datasets of the device at
30 different depths over the 3m range. User defined logic then selects
the BEM dataset most closely corresponding to the instantaneous
heave position of the device. That new BEM dataset is then used to
calculate the hydrodynamic forcing on the device until updated again.</p>
</section>
<section id="implementation">
<h4>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h4>
<p>Variable hydrodynamics is body dependent and does not need to be applied to
every body in a simulation. To implement variable hydrodynamics for a given body:</p>
<ol class="arabic">
<li><dl>
<dt>Initialize the Body</dt><dd><p>Create a body instance in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> with a cell array of H5 files
containing the hydrodyamic datasets:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">body(1)</span> <span class="pre">=</span> <span class="pre">bodyClass({'H5FILE_1.h5','H5FILE_2.h5','H5FILE_3.h5','H5FILE_4.h5','H5FILE_5.h5');</span></code></p>
</div></blockquote>
<p>If only one H5 file is used to initialize a body object, variable hydrodynamics
will not be used, regardless of the <code class="docutils literal notranslate"><span class="pre">option</span></code> flag below.</p>
<p>For variable mass cases, a vector can also be used for the variable hydrodynamics mass,
inertia, and inertia products:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">body(1).variableHydro.mass</span> <span class="pre">=</span> <span class="pre">[mass1,</span> <span class="pre">mass2,</span> <span class="pre">mass3,</span> <span class="pre">mass4,</span> <span class="pre">mass5];</span></code></p>
</div></blockquote>
<p>If no mass vector is specified but <code class="docutils literal notranslate"><span class="pre">body(1).mass</span></code> is set to equilibrium, the data from H5
files will be used to calculate the variable mass based on displaced volume and water density.
However, the full inertia vector (<code class="docutils literal notranslate"><span class="pre">body(1).variableHydro.inertia</span></code>) will still need to be
specified or else it will be assumed to be constant and equal to <code class="docutils literal notranslate"><span class="pre">body(1).inertia</span></code>.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Enable Variable Hydrodynamics</dt><dd><p>Set the <code class="docutils literal notranslate"><span class="pre">body.variableHydro.option</span></code> flag to enable variable hydrodynamics:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">body(1).variableHydro.option</span> <span class="pre">=</span> <span class="pre">1;</span></code></p>
</div></blockquote>
<p>If the <code class="docutils literal notranslate"><span class="pre">option</span></code> flag is not turned on (<code class="docutils literal notranslate"><span class="pre">option==0</span></code>), then extra H5 files are ignored.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Set the Initial Hydrodynamic Index</dt><dd><p>The flag <code class="docutils literal notranslate"><span class="pre">body.variableHydro.hydroForceIndexInitial</span></code> allows the user to set the
default hydrodynamic dataset. The initial set of hydrodynamic coefficients
represents the body at the start of a simulation and likely its equilibrium
position. It is used to define the body’s mass, center of gravity,
and center of buoyancy.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">body(1).variableHydro.hydroForceIndexInitial</span> <span class="pre">=</span> <span class="pre">1;</span></code></p>
</div></blockquote>
<p>This parameter is flexible because an initial index of one is not always convenient
and may complicate indexing logic. For example, consider a flap-based device with
multiple hydrodynamic datasets at various pitch angles (-50:10:50). It is most convenient
and straightforward to treat these angles in numerical order in BEM simulations,
indexing logic, and other data processing. In this case the initial position is at a pitch angle of 0 so
<code class="docutils literal notranslate"><span class="pre">body.variableHydro.hydroForceIndexInitial</span> <span class="pre">=</span> <span class="pre">6;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Control the varying hydrodynamics in Simulink</dt><dd><p>The index <code class="docutils literal notranslate"><span class="pre">body1_hydroForceIndex</span></code> in Simulink
(or <code class="docutils literal notranslate"><span class="pre">body1_hydroForceIndex</span></code> for body 2, etc) controls the hydrodynamic coefficients used
in the hydrodynamic force calculations at a given time.
Users <em>must</em> create their own logic and indexing signal in Simulink. A <code class="docutils literal notranslate"><span class="pre">GoTo</span></code>
block named <code class="docutils literal notranslate"><span class="pre">body1_hydroForceIndex</span></code>, <code class="docutils literal notranslate"><span class="pre">body2_hydroForceIndex</span></code>, etc must take
a signal for each variable hydro body so that the corresponding body block can select the correct
hydrodynamic coefficients during the simulation</p>
<p>This example, from the Varible Hydro Passive Yaw application, takes in position, wave direction, and
BEM directions, calculates the index at a given time, and sends it to a <code class="docutils literal notranslate"><span class="pre">GoTo</span></code> block named
<code class="docutils literal notranslate"><span class="pre">body1_hydroForceIndex</span></code>.</p>
<figure class="align-center" style="width: 500pt">
<a class="reference internal image-reference" href="../_images/variable_hydro_logic_example.png"><img alt="../_images/variable_hydro_logic_example.png" src="../_images/variable_hydro_logic_example.png" style="width: 500pt;" />
</a>
</figure>
</dd>
</dl>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Variable hydrodynamics is not compatible with the following features:</p>
<ul class="simple">
<li><p>State-space radiation calculations</p></li>
<li><p>FIR Filter radiation calculations</p></li>
<li><p>Generalized body modes</p></li>
<li><p>Non-hydrodynamic and drag bodies</p></li>
<li><p>Nonlinear hydrodynamics is not compatible when using a case with variable mass.</p></li>
</ul>
</div>
</section>
<section id="impulse-response-function-with-variable-hydrodynamics">
<h4>Impulse Response Function with Variable Hydrodynamics<a class="headerlink" href="#impulse-response-function-with-variable-hydrodynamics" title="Link to this heading"></a></h4>
<p>The convolution integral formulation of the radiation force is typically defined by</p>
<div class="math notranslate nohighlight">
\[F_{rad}(t)=-A_{\infty}\ddot{X}-\intop_{0}^{t}K_{r}(t-\tau)\dot{X}(\tau)d\tau\]</div>
<p>The <a class="reference internal" href="../theory/theory.html#cic-theory"><span class="std std-ref">Convolution Integral Formulation</span></a> section gives additional details on this representation of the radiation force.
Note that <span class="math notranslate nohighlight">\(K_r\)</span> is a function of time and can change as the state varies when using variable hydrodynamics.
For example, if the state switches from “A” to “B” between times <span class="math notranslate nohighlight">\(t_1, t_2\)</span>, then <span class="math notranslate nohighlight">\(K_r(t-t_1)=K_{r,A}(t-t_1)\)</span> is from a different hydrodynamic dataset
than <span class="math notranslate nohighlight">\(K_{r,B}(t-t_2)\)</span>. To account for this change in the impulse response function history, a surface of IRF coefficients is created and
stored in <code class="docutils literal notranslate"><span class="pre">body.variableHydro.radiationIrfSurface</span></code>.
This 4D surface has dimensionsions of time, influenced degree of freedom, radiating degree of freedom, and varying state.
At each time step, <code class="docutils literal notranslate"><span class="pre">convolutionIntegralSurface</span></code> is called to evaluate the radiation force.
The time history of the varying state’s index is used to select the appropriate <span class="math notranslate nohighlight">\(K_r\)</span> coefficients given the time and state at that time.
The resulting 3D surface is then convolved with the velocity history and summed across the radiating degrees of freedom to give the radiation force at that time.</p>
<p>The two figures below show an example of how the radiation IRF varies across a state for the case of a single heaving cube whose base opens and closes.
The flaps of the base split in half and are fully closed at 0 degrees and fully open at 90 degrees.
The contour of IRF surface in heave illustrates how significantly the IRF coefficients can change with a varying state.</p>
<figure class="align-center" style="width: 500pt">
<a class="reference internal image-reference" href="../_images/variable_hydro_irf.png"><img alt="../_images/variable_hydro_irf.png" src="../_images/variable_hydro_irf.png" style="width: 500pt;" />
</a>
</figure>
<figure class="align-center" style="width: 500pt">
<a class="reference internal image-reference" href="../_images/variable_hydro_irf_surface.png"><img alt="../_images/variable_hydro_irf_surface.png" src="../_images/variable_hydro_irf_surface.png" style="width: 500pt;" />
</a>
</figure>
</section>
<section id="application">
<h4>Application<a class="headerlink" href="#application" title="Link to this heading"></a></h4>
<p>See the <a class="reference internal" href="applications.html#user-applications-variable-hydro"><span class="std std-ref">Variable Hydrodynamics</span></a> WEC-Sim_Application for a demonstration of setting up and using variable hydrodynamics.</p>
</section>
<section id="additional-considerations">
<h4>Additional Considerations<a class="headerlink" href="#additional-considerations" title="Link to this heading"></a></h4>
<p>Variable hydrodynamics is a complex feature that should be used with caution.
Before using variable hydrodynamics, consider the advantages and disadvantages
of other advanced features that can accomplish modeling goals effectively
(passive yaw, large XY displacements, etc).</p>
<p>Thoroughly define the range of the state that is varying.
Input BEM data to cover the entire range of the state. Sufficiently discretize
the state to prevent numerical instabilities when switching occurs while reaching
an acceptable computational expense. The Variable Hydro Passive Yaw application
demonstrates how to process BEM datasets with BEMIO and interpolate between them to increase
state resolution without requiring many BEM simulations. Due to the number of H5 files
required, the hydroData directory may become very large.</p>
<p>All H5 files are loaded into the respective <code class="docutils literal notranslate"><span class="pre">body</span></code> variable, making the size
of these variables very large. Pre-processing remains very fast, so it is not
recommended to save <code class="docutils literal notranslate"><span class="pre">body</span></code> to an output file or the file size may increase drastically.</p>
</section>
</section>
<section id="body-initialization">
<h3>Body Initialization<a class="headerlink" href="#body-initialization" title="Link to this heading"></a></h3>
<p>The bodyClass is typically defined by inputting one or more paths to H5 files in the body constructor.
Alternatively, users may input a <code class="docutils literal notranslate"><span class="pre">hydroData</span></code> structure directly to the body constructor to bypass the
pre-processing steps that require writing the H5 file with BEMIO and then reloading it in the bodyClass.
This workflow may save users time in computationally expensive scenarios.</p>
<p>This alternate workflow is used by defining a body as: <code class="code docutils literal notranslate"><span class="pre">body(i)</span> <span class="pre">=</span> <span class="pre">bodyClass(hydroData)</span></code>.
Users should take care to ensure that the <code class="docutils literal notranslate"><span class="pre">hydroData</span></code> structure passed is identical in form to that
which <code class="docutils literal notranslate"><span class="pre">initializeWecSim</span></code> obtains by calling:</p>
<p><code class="code docutils literal notranslate"><span class="pre">hydroData</span> <span class="pre">=</span> <span class="pre">readBEMIOH5('pathToH5File',</span> <span class="pre">body.number,</span> <span class="pre">body.meanDrift);</span></code></p>
<p>The function <code class="code docutils literal notranslate"><span class="pre">rebuildHydroStruct()</span></code> may be used to convert the BEMIO <code class="code docutils literal notranslate"><span class="pre">hydro</span></code> structure
into the bodyClass <code class="code docutils literal notranslate"><span class="pre">hydroData</span></code> format.</p>
</section>
</section>
<section id="constraint-and-pto-features">
<span id="user-advanced-features-pto"></span><h2>Constraint and PTO Features<a class="headerlink" href="#constraint-and-pto-features" title="Link to this heading"></a></h2>
<p>This section provides an overview of WEC-Sim’s constraint and PTO classes; for
more information about the constraint and PTO classes’ code structure, refer to
<a class="reference internal" href="code_structure.html#user-code-structure-constraint-class"><span class="std std-ref">Constraint Class</span></a> and
<a class="reference internal" href="code_structure.html#user-code-structure-pto-class"><span class="std std-ref">PTO Class</span></a>.</p>
<section id="modifying-constraints-and-ptos">
<h3>Modifying Constraints and PTOs<a class="headerlink" href="#modifying-constraints-and-ptos" title="Link to this heading"></a></h3>
<p>The default linear and rotational constraints and PTOs allow for heave and
pitch motions of the follower relative to the base. To obtain a linear or
rotational constraint in a different direction you must modify the constraint’s
or PTO’s coordinate orientation. The important thing to remember is that a
linear constraint or PTO will always allow motion along the joint’s Z-axis, and
a rotational constraint or PTO will allow rotation about the joint’s Y-axis. To
obtain translation along or rotation about a different direction relative to
the global frame, you must modify the orientation of the joint’s coordinate
frame. This is done by setting the constraint’s or PTO’s <code class="code docutils literal notranslate"><span class="pre">orientation.z</span></code>
and <code class="code docutils literal notranslate"><span class="pre">orientation.y</span></code> properties which specify the new direction of the Z-
and Y- joint coordinates. The Z- and Y- directions must be perpendicular to
each other.</p>
<p>As an example, if you want to constrain body 2 to surge motion relative to body
1 using a linear constraint, you would need the constraint’s Z-axis to point in
the direction of the global surge (X) direction. This would be done by setting
<code class="code docutils literal notranslate"><span class="pre">constraint(i).orientation.z=[1,0,0]</span></code> and the Y-direction to any
perpendicular direction (can be left as the default y=[0 1 0]). In this
example, the Y-direction would only have an effect on the coordinate on which
the constraint forces are reported but not on the dynamics of the system.
Similarly if you want to obtain a yaw constraint you would use a rotational
constraint and align the constraint’s Y-axis with the global Z-axis. This would
be done by setting <code class="code docutils literal notranslate"><span class="pre">constraint(i).orientation.y=[0,0,1]</span></code> and the
z-direction to a perpendicular direction (say [0,-1,0]).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the Actuation Force/Torque PTO or Actuation Motion PTO blocks,
the loads and displacements are specified in the local (not global)
coordinate system. This is true for both the sensed (measured) and actuated
(commanded) loads and displacements.</p>
</div>
<p>Additionally, by combining constraints and PTOs in series you can obtain
different motion constraints. For example, a massless rigid rod between two
bodies, hinged at each body, can be obtained by using a two rotational
constraints in series, both rotating in pitch, but with different locations. A
roll-pitch constraint can also be obtained with two rotational constraints in
series; one rotating in pitch, and the other in roll, and both at the same
location.</p>
<section id="incorporating-joint-actuation-stroke-limits">
<h4>Incorporating Joint/Actuation Stroke Limits<a class="headerlink" href="#incorporating-joint-actuation-stroke-limits" title="Link to this heading"></a></h4>
<p>Beginning in MATLAB 2019a, hard-stops can be specified directly for PTOs and
translational or rotational constraints by specifying joint-primitive dialog
options in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>. Limits are modeled as an opposing spring
damper force applied when a certain extents of motion are exceeded. Note that
in this implementation, it is possible that the constraint/PTO will exceed
these limits if an inadequate spring and/or damping coefficient is specified,
acting instead as a soft motion constraint. More detail on this implementation
can be found in the <a class="reference external" href="https://www.mathworks.com/help/physmod/sm/ref/prismaticjoint.html#mw_316368a1-4b9e-4cfb-86e0-9abdd0c4d7a8">Simscape documentation</a>.
To specify joint or actuation stroke limits for a PTO, the following parameters
must be specified in <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">upperLimitSpecify</span> <span class="o">=</span> <span class="s1">&#39;on&#39;</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">lowerLimitSpecify</span> <span class="o">=</span> <span class="s1">&#39;on&#39;</span>
</pre></div>
</div>
<p>The specifics of the
limit and the acting forces at the upper and lower limits are described in turn
by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">upperLimitBound</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">upperLimitStiffness</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">upperLimitDamping</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">upperLimitTransitionRegionWidth</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">lowerLimitBound</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">lowerLimitStiffness</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">lowerLimitDamping</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hardStops</span><span class="o">.</span><span class="n">lowerLimitTransitionRegionWidth</span>
</pre></div>
</div>
<p>where pto(i) is replaced with constraint(i) on all of the above if the limits
are to be applied to a constraint.</p>
<p>In MATLAB versions prior to 2019a, specifying any of the above parameters will
have no effect on the simulation, and may generate warnings. It is instead
recommended that hard-stops are implemented in a similar fashion using an
Actuation Force/Torque PTO block in which the actuation force is specified in a
custom MATLAB Function block.</p>
</section>
</section>
<section id="setting-pto-or-constraint-extension">
<span id="pto-pto-extension"></span><h3>Setting PTO or Constraint Extension<a class="headerlink" href="#setting-pto-or-constraint-extension" title="Link to this heading"></a></h3>
<p>The PTO and Constraint classes have an Extension value that
can be specified to define the initial displacement of
the PTO or constraint at the beginning of the simulation, allowing the user to set the
ideal position for maximum wave capture and energy generation. This documentation
will use the PTO as an example, but the proces is applicable to both translational,
rotational, or spherical PTOs and constraints.
Whereas the initial displacement feature only defines this updated position for the PTO,
the PTO Extension feature propagates the change in position to all bodies and joints
on the Follower side of the PTO block. This allows for an accurate reflection of the
initial locations of each component without having to calculate and individually
define each initial displacement or rotation. To set the extension of a PTO, the
following parameter must be specified in <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">PositionTargetSpecify</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
</pre></div>
</div>
<p>to enable the joint’s target position value to be defined. The specifics of the
extension are described in turn by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">PositionTargetValue</span>
<span class="n">pto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">PositionTargetPriority</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PositionTargetValue</span></code> defines the extension magnitude and <code class="docutils literal notranslate"><span class="pre">PositionTargetPriority</span></code>
specifies Simulink’s priority in setting the initial target value in regards
to other constraints and PTOs. The priority is automatically set to “High” when
the extension is initialized but can be adjusted to “Low” if required by Simulink.</p>
<p>The figure below shows the PTO extension feature on the WECCCOMP model at 0.1 m.
The left image is at equilibrium (<code class="code docutils literal notranslate"><span class="pre">pto(i).extension.PositionTargetSpecify=0</span></code>),
and the right image set as
<code class="code docutils literal notranslate"><span class="pre">pto(i).extension.PositionTargetSpecify=1</span></code> with the WEC body moving in
accordance with the set PTO Extension value.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/WECCCOMP_PTO_Extension.png"><img alt="../_images/WECCCOMP_PTO_Extension.png" src="../_images/WECCCOMP_PTO_Extension.png" style="width: 500pt;" />
</a>
<figcaption>
<div class="legend">
<p>WECCCOMP Model PTO Extension</p>
</div>
</figcaption>
</figure>
<p>While this method generally fits most WEC models, there are specific
designs such as the RM3 that may have a larger DOF and are dependent on
the particular block orientation in the simulink model in terms of which
body blocks will move in response to a PTO initial extension. These specific
cases require extra setup on the users end if looking to define a
different body’s motion than the one automatically established. For the RM3
model, a set PTO Extension value results in movement in the float body.
However, if the user would like the movement to be within the spar instead,
extra steps are required. To view examples of how to set the PTO Extension
for both the float as well as the spar view the RM3 PTO Extension examples
on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a> .</p>
<p>For the spherical PTO which can rotate about three axes,
<code class="docutils literal notranslate"><span class="pre">pto(i).extension.PositionTargetValue</span></code> must be a 1x3 array that specifying
three consecutive rotations about the Base frame’s axes in the X-Y-Z convention.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PTO extension is not valid for PTO already actuated by user-defined motion
(Translational PTO Actuation Motion, Rotational PTO Actuation Motion).</p>
</div>
</section>
<section id="pto-sim">
<span id="pto-pto-sim"></span><h3>PTO-Sim<a class="headerlink" href="#pto-sim" title="Link to this heading"></a></h3>
<p>PTO-Sim is the WEC-Sim module responsible for accurately modeling a WEC’s
conversion of mechanical power to electrical power. While the PTO blocks native
to WEC-Sim are modeled as a simple linear spring-damper systems, PTO-Sim is
capable of modeling many power conversion chains (PCC) such as mechanical
and hydraulic drivetrains. PTO-Sim is made of native Simulink blocks
coupled with WEC-Sim, using WEC-Sim’s user-defined PTO blocks, where the
WEC-Sim response (relative displacement and velocity for linear motion and
angular position and velocity for rotary motion) is the PTO-Sim input.
Similarly, the PTO force or torque is the WEC-Sim input. For more information
on how PTO-Sim works, refer to [So et al., 2015] and <a class="reference internal" href="webinars.html#webinar3"><span class="std std-ref">Series 3 - Non-hydrodynamic Bodies</span></a>.</p>
<p>The files for the PTO-Sim tutorials described in this section can be found in
the <strong>PTO-Sim</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a> . Four PTO examples are
contained in the PTO-Sim application and can be used as a starting point for
users to develop their own. They cover two WEC types and mechanical, hydraulic,
and electrial PTO’s:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>PTO-Sim Application</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>RM3_cHydraulic_PTO</p></td>
<td><p>RM3 with compressible hydraulic PTO</p></td>
</tr>
<tr class="row-odd"><td><p>RM3_DD_PTO</p></td>
<td><p>RM3 with direct drive linear generator</p></td>
</tr>
<tr class="row-even"><td><p>OSWEC_Hydraulic_PTO</p></td>
<td><p>OSWEC with hydraulic PTO (adjustable rod)</p></td>
</tr>
<tr class="row-odd"><td><p>OSWEC_Hydraulic_Crank_PTO</p></td>
<td><p>OSWEC with hydraulic PTO (crank)</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<section id="tutorial-rm3-with-pto-sim">
<h4>Tutorial: RM3 with PTO-Sim<a class="headerlink" href="#tutorial-rm3-with-pto-sim" title="Link to this heading"></a></h4>
<p>This section describes how to use RM3 with PTO-Sim. Two tutorials will be given
in this section: one for the RM3 with a hydraulic PTO and
another for the RM3 with a direct drive PTO.</p>
<section id="rm3-with-hydraulic-pto">
<span id="pto-rm3-hydraulic"></span><h5>RM3 with Hydraulic PTO<a class="headerlink" href="#rm3-with-hydraulic-pto" title="Link to this heading"></a></h5>
<p>The hydraulic PTO example used in this section consists of a piston, a
rectifying valve, a high pressure accumulator, a hydraulic motor coupled to a
rotary generator, and a low pressure accumulator.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/HYDPHYMODEL.PNG"><img alt="../_images/HYDPHYMODEL.PNG" src="../_images/HYDPHYMODEL.PNG" style="width: 500pt;" />
</a>
</figure>
<p>In this section, a step by step tutorial on how to set up and run the RM3
simulation with PTO-Sim is provided. All the files used in WEC-Sim will remain
the same, but some may need to be added to the working folder. The <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> must
be modified to add the definition of the different PTO-Sim blocks. The files used to run RM3 with
PTO-Sim case are the following:</p>
<ul class="simple">
<li><p>WEC-Sim input file: <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> (make sure to set the PTO linear
damping to zero)</p></li>
<li><p>Simulink model: <code class="docutils literal notranslate"><span class="pre">RM3.slx</span></code></p></li>
<li><p>Geometry file for each body: <code class="docutils literal notranslate"><span class="pre">float.stl</span></code> and <code class="docutils literal notranslate"><span class="pre">plate.stl</span></code></p></li>
<li><p>Hydrodynamic data file(s): <code class="docutils literal notranslate"><span class="pre">rm3.h5</span></code></p></li>
<li><p>Optional user defined post-processing file: <code class="docutils literal notranslate"><span class="pre">userDefinedFunction.m</span></code></p></li>
</ul>
<p><strong>Simulink Model</strong></p>
<p>The Simulink model can be built as follows:</p>
<ul class="simple">
<li><p>Step 1: Navigate to the RM3 example <code class="docutils literal notranslate"><span class="pre">$WECSIM/examples/RM3</span></code>.</p></li>
<li><p>Step 2: Open <code class="docutils literal notranslate"><span class="pre">RM3.slx</span></code> file and replace Translational PTO with
Translational PTO Actuation Force.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/translational_pto.PNG"><img alt="../_images/translational_pto.PNG" src="../_images/translational_pto.PNG" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 3: Create a subsystem and rename it to PTO-Sim where the input is the response and
output is force.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/rm3with_pto_sim.PNG"><img alt="../_images/rm3with_pto_sim.PNG" src="../_images/rm3with_pto_sim.PNG" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 4: Go to Simulink Library Browser to access the PTO-Sim Library.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/pto_sim_lib.png"><img alt="../_images/pto_sim_lib.png" src="../_images/pto_sim_lib.png" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 5: By looking at the physical hydraulic PTO model as shown above, the user
can simply drag and drop PTO-Sim library blocks. Hydraulic cylinder, rectifying valve, and accumulator
blocks are located under the Hydraulic block. The electric generator equivalent circuit is located under the Electric library.</p></li>
<li><p>Step 6: Since multiple PTO-Sim blocks will be used, it is necessary to name each block to identify them
when its variables are defined in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>. To change the name of each block,
double click the block and add the name <code class="docutils literal notranslate"><span class="pre">ptoSim(i)</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code>
must be different for each block used in the simulation. The name of each block
will be used in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> to define its variables.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/PTOSimBlock1.png"><img alt="../_images/PTOSimBlock1.png" src="../_images/PTOSimBlock1.png" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 7: Connect the inputs and outputs of the blocks according to the desired physical layout.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/RM3withPTOSimBlocks.png"><img alt="../_images/RM3withPTOSimBlocks.png" src="../_images/RM3withPTOSimBlocks.png" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 8: Define the input for <code class="docutils literal notranslate"><span class="pre">Rload</span></code> in the Electric Generator block. The input could be a constant
value or it could be used to control the load of the generator to achieve a desired physical behaviour.
In this example, the value of <code class="docutils literal notranslate"><span class="pre">Rload</span></code> is used to control the shaft speed of the generator by using a
simple PI controller. The desired shaft speed in this case is 1000 rpm. The Electric Generator
Equivalent Circuit block has two outputs: the electromagnetic torque and the shaft speed. It is
necessary to use a bus selector to choose the desired output, which in this example is the shaft speed.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/GeneratorSpeedControl.png"><img alt="../_images/GeneratorSpeedControl.png" src="../_images/GeneratorSpeedControl.png" style="width: 500pt;" />
</a>
</figure>
<p><strong>Input File</strong></p>
<p>In this section, the WEC-Sim input file (<code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>) is defined and
categorized into sections such as hydraulic cylinder, rectifying check valve, high pressure
accumulator, low pressure accumulator, hydraulic motor, and generator.</p>
<div class="highlight-matlab notranslate" id="wecsiminput"><div class="highlight"><pre><span></span><span class="c">%% Simulation Data</span>
<span class="n">simu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulationClass</span><span class="p">();</span><span class="w">               </span>
<span class="n">simu</span><span class="p">.</span><span class="n">simMechanicsFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;RM3_cHydraulic_PTO.slx&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">%Location of Simulink Model File with PTO-Sim                 </span>
<span class="n">simu</span><span class="p">.</span><span class="n">startTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                     </span>
<span class="n">simu</span><span class="p">.</span><span class="n">rampTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">                       </span>
<span class="n">simu</span><span class="p">.</span><span class="n">endTime</span><span class="p">=</span><span class="mi">400</span><span class="p">;</span><span class="w">   </span>
<span class="n">simu</span><span class="p">.</span><span class="n">dt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w">                         </span>
<span class="n">simu</span><span class="p">.</span><span class="n">explorer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;off&#39;</span><span class="p">;</span><span class="w">                     </span><span class="c">% Turn SimMechanics Explorer (on/off)</span>

<span class="c">%% Wave Information</span>
<span class="c">%Irregular Waves using PM Spectrum</span>
<span class="n">waves</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">waveClass</span><span class="p">(</span><span class="s">&#39;irregular&#39;</span><span class="p">);</span>
<span class="n">waves</span><span class="p">.</span><span class="n">height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span>
<span class="n">waves</span><span class="p">.</span><span class="n">period</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="n">waves</span><span class="p">.</span><span class="n">spectrumType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;PM&#39;</span><span class="p">;</span>
<span class="n">waves</span><span class="p">.</span><span class="n">phaseSeed</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>

<span class="c">%% Body Data</span>
<span class="c">% Float</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../../_Common_Input_Files/RM3/hydroData/rm3.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">geometryFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;../../../_Common_Input_Files/RM3/geometry/float.stl&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">mass</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">inertia</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">20907301</span><span class="w"> </span><span class="mf">21306090.66</span><span class="w"> </span><span class="mf">37085481.11</span><span class="p">];</span>

<span class="c">% Spar/Plate</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../../_Common_Input_Files/RM3/hydroData/rm3.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">geometryFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;../../../_Common_Input_Files/RM3/geometry/plate.stl&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">mass</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">inertia</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">94419614.57</span><span class="w"> </span><span class="mf">94407091.24</span><span class="w"> </span><span class="mf">28542224.82</span><span class="p">];</span>

<span class="c">%% PTO and Constraint Parameters</span>
<span class="c">% Floating (3DOF) Joint</span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">constraintClass</span><span class="p">(</span><span class="s">&#39;Constraint1&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">                </span>

<span class="c">% Translational PTO</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoClass</span><span class="p">(</span><span class="s">&#39;PTO1&#39;</span><span class="p">);</span><span class="w">           	</span><span class="c">% Initialize PTO Class for PTO1</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">stiffness</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                           </span><span class="c">% PTO Stiffness [N/m]</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">damping</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                           </span><span class="c">% PTO Damping [N/(m/s)]</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">                   </span><span class="c">% PTO Location [m]       </span>

<span class="c">%% PTO new blocks</span>

<span class="c">%Hydraulic Cylinder</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;hydraulicCyl&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">xi_piston</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">35</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">Ap_A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.0378</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">Ap_B</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.0378</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">bulkModulus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.86e9</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">pistonStroke</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">70</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">pAi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.1333e7</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hydPistonCompressible</span><span class="p">.</span><span class="n">pBi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.1333e7</span><span class="p">;</span>

<span class="c">%Rectifying Check Valve</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;rectCheckValve&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Cd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.61</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amax</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.002</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amin</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">pMax</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.5e6</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">pMin</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">rho</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">850</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">k1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">k2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">atanh</span><span class="p">((</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amin</span><span class="o">-</span><span class="p">(</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amax</span><span class="o">-</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="k">...</span>
<span class="w">    </span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">Amin</span><span class="p">))</span><span class="o">*</span><span class="k">...</span>
<span class="w">    </span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">pMin</span><span class="o">-</span><span class="p">(</span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">pMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ptoSim</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">rectifyingCheckValve</span><span class="p">.</span><span class="n">pMin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>

<span class="c">%High Pressure Hydraulic Accumulator</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;hydraulicAcc&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">gasHydAccumulator</span><span class="p">.</span><span class="n">vI0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">8.5</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">gasHydAccumulator</span><span class="p">.</span><span class="n">pIprecharge</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2784.7</span><span class="o">*</span><span class="mf">6894.75</span><span class="p">;</span>

<span class="c">%Low Pressure Hydraulic Accumulator</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;hydraulicAcc&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">gasHydAccumulator</span><span class="p">.</span><span class="n">vI0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">8.5</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">gasHydAccumulator</span><span class="p">.</span><span class="n">pIprecharge</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1392.4</span><span class="o">*</span><span class="mf">6894.75</span><span class="p">;</span>

<span class="c">%Hydraulic Motor</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;hydraulicMotor&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">effModel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">displacement</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">120</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">effTableShaftSpeed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">effTableDeltaP</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="o">*</span><span class="mf">1e5</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">effTableVolEff</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.9</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">hydraulicMotor</span><span class="p">.</span><span class="n">effTableMechEff</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.85</span><span class="p">;</span>

<span class="c">%Electric generator</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoSimClass</span><span class="p">(</span><span class="s">&#39;electricGen&#39;</span><span class="p">);</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">electricGeneratorEC</span><span class="p">.</span><span class="n">Ra</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">electricGeneratorEC</span><span class="p">.</span><span class="n">La</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">electricGeneratorEC</span><span class="p">.</span><span class="n">Ke</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">electricGeneratorEC</span><span class="p">.</span><span class="n">Jem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
<span class="n">ptoSim</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">electricGeneratorEC</span><span class="p">.</span><span class="n">bShaft</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Simulation and Post-processing</strong></p>
<p>Simulation and post-processing are similar process as described in <a class="reference internal" href="tutorials.html#user-tutorials-rm3"><span class="std std-ref">Two-Body Point Absorber (RM3)</span></a>.
There are some specific variable definitions that must be considered when using the output
signals of the PTO-Sim blocks. For example, the hydraulic accumulator has two output signals: flow rate
and pressure, and the time vector. In the RM3 example with hydraulic PTO, the high pressure hydraulic
accumulator was defined as <code class="docutils literal notranslate"><span class="pre">ptoSim(3)</span></code> in the WEC-Sim input file; then, to use the output
flow rate and pressure of this block, the next line of code must be used:</p>
<p><code class="docutils literal notranslate"><span class="pre">FlowRateAccumulator</span> <span class="pre">=</span> <span class="pre">output.ptoSim(3).FlowRate</span></code>
<code class="docutils literal notranslate"><span class="pre">PressureAccumulator</span> <span class="pre">=</span> <span class="pre">output.ptoSim(3).Pressure</span></code></p>
<p>In general, the output signal of any PTO-Sim block can be used with this line of code:  <code class="docutils literal notranslate"><span class="pre">output.ptoSim(i).VariableName</span></code></p>
</section>
<section id="rm3-with-direct-drive-pto">
<h5>RM3 with Direct Drive PTO<a class="headerlink" href="#rm3-with-direct-drive-pto" title="Link to this heading"></a></h5>
<p>A mechanical PTO is used in this example and is modeled as a direct drive
linear generator. The main components of this example consist of magnets and a
coil where the magnet assembly is attached to the heaving float and the coil is
located inside the spar. As the float moves up and down, the magnet assembly
creates a change in the magnetic field surrounding the spar that contains the
coil: therefore, current is induced in the coil and electricity is generated.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/MECHANICALPTO.PNG"><img alt="../_images/MECHANICALPTO.PNG" src="../_images/MECHANICALPTO.PNG" style="width: 500pt;" />
</a>
</figure>
<p><strong>Simulink Model</strong></p>
<p>Steps 1 through 4 are the same as in <a class="reference internal" href="#pto-rm3-hydraulic"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
<ul class="simple">
<li><p>Step 5: Look for the block “Direct Drive Linear Generator” and drag the block into the PTO-Sim subsystem</p></li>
<li><p>Step 6: Connect the input “respose” to the input of the PTO-Sim block and the output “Force” to the output of the subsystem.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/DirectDrivePorts.png"><img alt="../_images/DirectDrivePorts.png" src="../_images/DirectDrivePorts.png" style="width: 500pt;" />
</a>
</figure>
<p><strong>Input File, Simulation, and Post-processing</strong></p>
<p>The same as <a class="reference internal" href="#pto-rm3-hydraulic"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
</section>
</section>
<section id="tutorial-oswec-with-pto-sim">
<h4>Tutorial: OSWEC with PTO-Sim<a class="headerlink" href="#tutorial-oswec-with-pto-sim" title="Link to this heading"></a></h4>
<p>This section describes how to use the OSWEC model with PTO-Sim. The same
process as described in <a class="reference internal" href="#pto-rm3-hydraulic"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>; however, since the OSWEC is a
rotary device, it takes torque as an input and a rotary to linear motion
conversion block is needed. The tutorials can be found on the
<a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a>
repository (both for a crank and for a rod).</p>
<section id="oswec-with-hydraulic-pto">
<h5>OSWEC with Hydraulic PTO<a class="headerlink" href="#oswec-with-hydraulic-pto" title="Link to this heading"></a></h5>
<p>A hydraulic PTO or mechanical PTO can be used with OSWEC but for simplicity a
hydraulic PTO will be used as an example. An schematic representation of the OSWEC device
is shown in the figure below:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/OSWECPHYMODEL.PNG"><img alt="../_images/OSWECPHYMODEL.PNG" src="../_images/OSWECPHYMODEL.PNG" style="width: 500pt;" />
</a>
</figure>
<p>Two blocks were developed in the PTO-Sim library to model a system like the OSWEC.
The blocks can be found under the <code class="docutils literal notranslate"><span class="pre">Motion</span> <span class="pre">Convertion</span></code> library.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/MotionConversionLib.png"><img alt="../_images/MotionConversionLib.png" src="../_images/MotionConversionLib.png" style="width: 500pt;" />
</a>
</figure>
<p>The block “Rotary to Linear Adjustable Rod” is used to model a rod with a variable length. For the OSWEC case,
this block can be use when the cylinder rod of the hydraulic PTO is connected to the adjustable rod,
like in the schematic presented in the figure below:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/AdjustableRodHPTO.png"><img alt="../_images/AdjustableRodHPTO.png" src="../_images/AdjustableRodHPTO.png" style="width: 500pt;" />
</a>
</figure>
<p>On the other hand, the block “Rotary to Linear Crank” is used to model a slider-crank mechanism that is used to convert
the rotational motion of the OSWEC device into linear motion for the hydraulic cylinder in the PTO. In this case, the
cylinder rod of the hydraulic PTO is connected to the slider part of the mechanism, as shown in the figure below:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/SliderandCrankMechanism.png"><img alt="../_images/SliderandCrankMechanism.png" src="../_images/SliderandCrankMechanism.png" style="width: 500pt;" />
</a>
</figure>
<p><strong>Modeling of OSWEC with Hydraulic PTO</strong></p>
<p>The files needed for the OSWEC case are the same as the ones described in <a class="reference internal" href="#pto-rm3-hydraulic"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
<p><strong>Simulink Model</strong></p>
<p>The Simulink model can be built as following:</p>
<ul class="simple">
<li><p>Step 1: Copy the OSWEC example folder to get started  <code class="docutils literal notranslate"><span class="pre">$WECSIM\examples\OSWEC</span></code>.</p></li>
<li><p>Step 2: Open <code class="docutils literal notranslate"><span class="pre">OSWEC.slx</span></code> file and replace Rotational PTO with
Rotational PTO Actuation Torque.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/rotational_pto.PNG"><img alt="../_images/rotational_pto.PNG" src="../_images/rotational_pto.PNG" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 3: Create a subsystem and rename it to PTO-Sim where input is response and
output is torque.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/oswec_pto_sim.PNG"><img alt="../_images/oswec_pto_sim.PNG" src="../_images/oswec_pto_sim.PNG" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 4: Go to Simulink Library Browser to access the PTO-Sim Library.</p></li>
<li><p>Step 5: By looking at the physical hydraulic PTO model as shown above, the user
can simply drag and drop PTO-Sim library blocks. Hydraulic cylinder, rectifying valve, and accumulator
blocks are located under the Hydraulic block. The electric generator equivalent circuit is located under the Electric library.
The “Rotary to Linear Adjustable Rod” is under the Motion Conversion library.</p></li>
<li><p>Step 6: Since multiple PTO-Sim blocks will be used, it is necessary to name each block to identify them
when its variables are defined in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>. To change the name of each block,
double click the block and add the name <code class="docutils literal notranslate"><span class="pre">ptoSim(i)</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code>
must be different for each block used in the simulation. The name of each block
will be used in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> to define its variables. For this example,
the motion conversion block will be called <code class="docutils literal notranslate"><span class="pre">ptoSim(1)</span></code></p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/PTOSimBlock1OSWEC.png"><img alt="../_images/PTOSimBlock1OSWEC.png" src="../_images/PTOSimBlock1OSWEC.png" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 7: Connect the inputs and outputs of the blocks according to the desired physical layout.</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/OSWECPTOSimExample.png"><img alt="../_images/OSWECPTOSimExample.png" src="../_images/OSWECPTOSimExample.png" style="width: 500pt;" />
</a>
</figure>
<ul class="simple">
<li><p>Step 8: Define the input for <code class="docutils literal notranslate"><span class="pre">Rload</span></code> in the Electric Generator block. The input could be a constant
value or it could be used to control the load of the generator to achieve a desired physical behaviour.
In this example, the value of <code class="docutils literal notranslate"><span class="pre">Rload</span></code> is used to control the shaft speed of the generator by using a
simple PI controller. The desired shaft speed in this case is 3000 rpm. The Electric Generator
Equivalent Circuit block has two outputs: the electromagnetic torque and the shaft speed. It is
necessary to use a bus selector to choose the desired output, which in this example is the shaft speed.</p></li>
</ul>
<p><strong>Input File, Simulation, and Post-processing</strong></p>
<p>The input file for this case is similar to the input file
described in <a class="reference internal" href="#pto-rm3-hydraulic"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>. The naming and numbering of the PTO blocks
change in this case, but the way the variables are defined is the same.</p>
</section>
</section>
</section>
</section>
<section id="controller-features">
<span id="user-advanced-features-control"></span><h2>Controller Features<a class="headerlink" href="#controller-features" title="Link to this heading"></a></h2>
<p>The power generation performance of a WEC is highly dependent on the control
algorithm used in the system. There are different control strategies that
have been studied for marine energy applications. These control algorithms
can be applied directly to the PTO components to achieve a desired output, or
they can be high-level controllers which are focused on the total PTO force
applied to the WEC. The examples presented in this section are based on high-
level controller applications. WEC-Sim’s controller features support the modeling
of both simple passive and reactive controllers as well as more complex methods
such as model predictive control.</p>
<p>The files for the controller tutorials described in this section can be found in
the <strong>Controls</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a> . The controller examples
are not comprehensive, but provide a reference for user to implement their
own controls.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Controller Application</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>Passive (P)</p></td>
<td><p>Sphere with proportional control</p></td>
</tr>
<tr class="row-odd"><td><p>Reactive (PI)</p></td>
<td><p>Sphere with proportional-integral control</p></td>
</tr>
<tr class="row-even"><td><p>Latching</p></td>
<td><p>Sphere with latching control</p></td>
</tr>
<tr class="row-odd"><td><p>Declutching</p></td>
<td><p>Sphere with declutching control</p></td>
</tr>
<tr class="row-even"><td><p>Model Predictive Control</p></td>
<td><p>Sphere with model predictive control</p></td>
</tr>
<tr class="row-odd"><td><p>Reactive with PTO</p></td>
<td><p>Sphere with reactive control and DD PTO</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<section id="examples-sphere-float-with-various-controllers">
<h3>Examples: Sphere Float with Various Controllers<a class="headerlink" href="#examples-sphere-float-with-various-controllers" title="Link to this heading"></a></h3>
<p>First, it is important to understand the concept of complex conjugate control.
Complex conjugate control, as applied to wave energy conversion,
can be used to understand optimal control. For a complex conjugate controller,
the impedance of the controller is designed to match the admittance of the
device (equal to the complex conjugate of device impedance). Hence, it is
also known as impedance matching and is a common practice within electrical
engineering. Complex conjugate control is not a completely realizable control
method due to its acausality, which means it requires exact knowledge of
future wave conditions. Still, a causal transfer function can be used to approximate
complex conjugate control across a limited frequency range <span id="id13">[<a class="reference internal" href="#id31" title="Giorgio Bacelli and Ryan G Coe. Comments on control of wave energy converters. IEEE Transactions on Control Systems Technology, 29(1):478–481, 2020.">C1</a>]</span>.
Thus, complex conjugate control presents a reference for the implementation of
optimal causal controls. The WEC impedance can be modeled by the following equation
<span id="id14">[<a class="reference internal" href="#id32" title="Giorgio Bacelli, Victor Nevarez, Ryan G Coe, and David G Wilson. Feedback resonating control for a wave energy converter. IEEE Transactions on Industry Applications, 56(2):1862–1868, 2019.">C2</a>]</span> and can be used to formulate the optimal control implementation:</p>
<div class="math notranslate nohighlight">
\[Z_i(\omega) = j\omega (m + A(\omega)) + B(\omega) + \frac{K_{hs}}{j\omega}\]</div>
<p>By characterizing the impedance of the WEC, a greater understanding of the
dynamics can be reached. The figure below is a bode plot of the impedance of
the RM3 float body. The natural frequency is defined by the point at which the
phase of impedance is zero. By also plotting the frequency of the incoming
wave, it is simple to see the difference between the natural frequency of
the device and the wave frequency. Complex conjugate control (and some other
control methods) seeks to adjust the natural frequency of the device to match
the wave frequency. Matching the natural frequency to the wave frequency leads
to resonance, which allows for theoretically optimal mechanical power.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/impedance.png"><img alt="../_images/impedance.png" src="../_images/impedance.png" style="width: 300pt;" />
</a>
</figure>
<p>It is important to note here that although impedance matching can lead to maximum mechanical
power, it does not always lead to maximum electrical power. Resonance due to
impedance matching often creates high peaks of torque and power, which are usually
far from the most efficient operating points of PTO systems used to extract power
and require those systems to be more robust and expensive.
Thus, the added factor of PTO dynamics and efficiency may lead to
complex conjugate control being suboptimal. Furthermore, any constraints or other
nonlinear dynamics may make complex conjugate control unachievable or suboptimal.
Theoretical optimal control using complex conjugates presented here should be
taken as a way to understand WEC controls rather than a method to achieve
optimal electrical power for a realistic system.</p>
</section>
<section id="passive-control-proportional">
<span id="control-passive"></span><h3>Passive Control (Proportional)<a class="headerlink" href="#passive-control-proportional" title="Link to this heading"></a></h3>
<p>Passive control is the simplest of WEC controllers and acts as a damping force.
Hence, the damping value (also referred to as a proportional gain) is
multiplied by the WEC velocity to determine the power take-off force:</p>
<div class="math notranslate nohighlight">
\[F_{PTO} = K_p \dot{X}\]</div>
<p>Although unable to reach optimal power for a regular wave due to its passive
nature, a passive controller can still be tuned to reach its maximum power.
According to complex conjugate control, a passive controller can be
optimized for regular wave conditions using the following formula <span id="id15">[<a class="reference internal" href="#id34" title="RPF Gomes, MFP Lopes, JCC Henriques, LMC Gato, and AFO Falcão. The dynamics and power extraction of bottom-hinged plate wave energy converters in regular and irregular waves. Ocean Engineering, 96:86–99, 2015.">C3</a>]</span>:</p>
<div class="math notranslate nohighlight">
\[K_{p,opt} = \sqrt{B(\omega)^2 + (\frac{K_{hs}}{\omega} - \omega (m + A(\omega)))^2}\]</div>
<p>The optimal proportional gain has been calculated for the float using the optimalGainCalc.m file
and implemented in WEC-Sim to achieve optimal power. The mcrBuildGains.m file sets
up a sweep of the proportional gains which can be used to show that the results
confirm the theoretical optimal gain in the figure below (negative power corresponding to
power extracted from the system). This MCR run can be
recreated by running the mcrBuildGains.m file then typing wecSimMCR in the command
window.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/pGainSweep.png"><img alt="../_images/pGainSweep.png" src="../_images/pGainSweep.png" style="width: 300pt;" />
</a>
</figure>
<p>This example only shows the optimal proportional gain in regular wave conditions.
For irregular wave spectrums and nonlinear responses (such as with constraints),
an optimization algorithm can be used to determine optimal control gains.</p>
</section>
<section id="reactive-control-proportional-integral">
<span id="control-reactive"></span><h3>Reactive Control (Proportional-Integral)<a class="headerlink" href="#reactive-control-proportional-integral" title="Link to this heading"></a></h3>
<p>Reactive control is also a very simple form of WEC control and combines the
damping force of a passive controller with a spring stiffness force. The standard PTO
block can also be used to implement PI control using the damping and stiffness
values but doesn’t allow for negative inputs which is often necessary for
optimal stiffness. This controller is also known as a proportional integral
controller with the proportional gain corresponding to the damping value and
the integral gain corresponding to a spring stiffness value:</p>
<div class="math notranslate nohighlight">
\[F_{PTO} = K_p \dot{X} + K_i X\]</div>
<p>The addition of the reactive component means the controller can achieve optimal
complex conjugate control by cancelling out the imaginary portion of the device
impedance. Thus, the proportional and integral control gains can be defined by the
following formulas <span id="id16">[<a class="reference internal" href="#id33" title="Ryan G Coe, Giorgio Bacelli, and Dominic Forbush. A practical approach to wave energy modeling and control. Renewable and Sustainable Energy Reviews, 142:110791, 2021.">C4</a>]</span>:</p>
<div class="math notranslate nohighlight">
\[K_{p,opt} = B(\omega)\]</div>
<div class="math notranslate nohighlight">
\[K_{i,opt} = (m + A(\omega)) \omega^2 - K_hs\]</div>
<p>The optimal proportional and integral gains have been calculated using the optimalGainCalc.m file
and implemented in WEC-Sim to achieve optimal power. The mcrBuildGains.m file again sets
up a sweep of the gains which can be used to show that the results
confirm the theoretical optimal gains in the figure below. This MCR run can be
recreated by running the mcrBuildGains.m file then typing wecSimMCR in the command
window.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/piGainSweep.png"><img alt="../_images/piGainSweep.png" src="../_images/piGainSweep.png" style="width: 300pt;" />
</a>
</figure>
<p>This example only shows the optimal gains in regular wave conditions.
For irregular wave spectrums and nonlinear responses (such as with constraints),
an optimization algorithm can be used to determine optimal control gains.</p>
</section>
<section id="latching-control">
<span id="control-latching"></span><h3>Latching Control<a class="headerlink" href="#latching-control" title="Link to this heading"></a></h3>
<p>Latching control combines a traditional passive controller with a latching mechanism which applies
a large braking force during a portion of the oscillation. By locking the device for
part of the oscillation, latching control attempts to adjust the phase of the motion to
match the phase of incoming waves. Latching control can slow the device motion to match
wave motion and is therefore most often used when the wave period is longer than the natural
period. Latching control is still considered passive as no energy input is required (assuming velocity
is zero while latched).</p>
<p>The braking/latching force is implemented as a very large damping force (<span class="math notranslate nohighlight">\(G\)</span>), which can be
adjusted based on the device’s properties <span id="id17">[<a class="reference internal" href="#id35" title="Aurélien Babarit and Alain H Clément. Optimal latching control of a wave energy device in regular and irregular waves. Applied Ocean Research, 28(2):77–91, 2006.">C5</a>]</span>:</p>
<div class="math notranslate nohighlight">
\[G = 80 (m + A(\omega))\]</div>
<p>Because latching achieves phase matching between the waves and device, the optimal
damping can be assumed the same as for reactive control. Lastly, the main control
variable, latching time, needs to be determined. For regular waves, it is
desired for the device to move for a time equal to its natural frequency, meaning
the optimal latching time is likely close to half the difference between the wave
period and the natural period <span id="id18">[<a class="reference internal" href="#id35" title="Aurélien Babarit and Alain H Clément. Optimal latching control of a wave energy device in regular and irregular waves. Applied Ocean Research, 28(2):77–91, 2006.">C5</a>]</span> (accounting for 2 latching periods per wave period).</p>
<div class="math notranslate nohighlight">
\[t_{latch} = \frac{1}{2} (T_{wave} - T_{nat})\]</div>
<p>The optimal latching time has been calculated using the optimalGainCalc.m file
and implemented in WEC-Sim. The mcrBuildTimes.m file sets
up a sweep of the latching times, the results for which are shown in the figure below.
This MCR run can be recreated by running the mcrBuildGains.m file then typing wecSimMCR
in the command window. Based on the results, the optimal latching time is slightly
lower than expected which may be due to imperfect latching or complex dynamics which
aren’t taken into account in the theoretical optimal calculation. Regardless, latching results in
much larger power when compared to traditional passive control.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/latchTimeSweep.png"><img alt="../_images/latchTimeSweep.png" src="../_images/latchTimeSweep.png" style="width: 300pt;" />
</a>
</figure>
<p>Further, the figure below shows the excitation force and velocity, which are close to
in phase when a latching time of 2.4 seconds is implemented.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/latching.png"><img alt="../_images/latching.png" src="../_images/latching.png" style="width: 300pt;" />
</a>
</figure>
<p>Although not shown with this example, latching can also be implemented in irregular waves
but often requires different methods including excitation prediction.</p>
</section>
<section id="declutching-control">
<span id="control-declutching"></span><h3>Declutching Control<a class="headerlink" href="#declutching-control" title="Link to this heading"></a></h3>
<p>Declutching control is essentially the opposite of latching. Instead of locking the device,
it is allowed to move freely (no PTO force) for a portion of the oscillation. Often,
declutching is used when the wave period is smaller than the natural period, allowing the
device motion to “catch up” to the wave motion. Declutching is also considered
a passive control method.</p>
<p>The optimal declutching time and damping values are slightly harder to estimate than for
latching. The device’s motion still depends on its impedance during the declutching period,
meaning the device does not really move “freely” during this time. Hence, in opposition to
optimal latching the declutching time was assumed to be near half the difference between
the natural period and the wave period, but is further examined through tests.</p>
<div class="math notranslate nohighlight">
\[t_{declutch} = \frac{1}{2} (T_{wave} - T_{nat})\]</div>
<p>This optimal declutching time has been calculated using the optimalGainCalc.m file
and implemented in WEC-Sim. Because energy is not harvested during the declutching
period, it is likely that a larger damping is required. Thus, the optimal passive
damping value was used for the following simulations, although a more
optimal damping value likely exists for delclutching.</p>
<p>Since declutching is most desired when the wave period is smaller than the natural period,
a wave period of 3.5 seconds was tested with a height of 1 m. For comparison to traditional
passive control, the optimal passive damping value was tested for these conditions, leading
to a power of 5.75 kW. The mcrBuildTimes.m file sets up a sweep of the declutching times,
the results for which are shown in the figure below. It is clear that delcuthing control
can offer an improvement over traditional passive control.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/declutchTimeSweep.png"><img alt="../_images/declutchTimeSweep.png" src="../_images/declutchTimeSweep.png" style="width: 300pt;" />
</a>
</figure>
<p>Further, the figure below shows the excitation force and velocity with a declutch time
of 0.8 seconds. The excitation and response are not quite in phase, but the device
can be seen “catching up” to the wave motion during the declutching time.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/declutching.png"><img alt="../_images/declutching.png" src="../_images/declutching.png" style="width: 300pt;" />
</a>
</figure>
<p>Although not shown with this example, declutching can also be implemented in irregular waves
but often requires different methods including excitation prediction.</p>
</section>
<section id="model-predictive-control-mpc">
<span id="control-mpc"></span><h3>Model Predictive Control (MPC)<a class="headerlink" href="#model-predictive-control-mpc" title="Link to this heading"></a></h3>
<p>Model predictive control is a WEC control method which uses a plant model to predict and
optimize the dynamics. MPC is a complex controller that can be applied in both regular
and irregular waves while also taking into account time-domain constraints such as position,
velocity, and PTO force. For the model predictive controller implemented here,
the plant model is a frequency dependent state-space model <span id="id19">[<a class="reference internal" href="#id36" title="Ratanak So, Mike Starrett, Kelley Ruehl, and Ted KA Brekken. Development of control-sim: control strategies for power take-off integrated wave energy converter. In 2017 IEEE Power &amp; Energy Society General Meeting, 1–5. IEEE, 2017.">C6</a>]</span>.
The state space model is then converted to a quadratic programming problem to be
solved by quadprog(), MATLAB’s quadratic programming function. Solving this system
leads to a set of PTO forces to optimize the future dynamics for maximum harvested
power, the first of which is applied at the current timestep. The relevant files for
the MPC example in the Controls folder of WEC-Sim Applications are detailed in the
table below (excluding wecSimInputFile.m and userDefinedFunctions.m which are not
unique to MPC). Note: This controller is similar to the NMPC example within the
WECCCOMP Application, but this example includes a method for calculating frequency
dependence and setting up the state space matrices based on boundary element method
data, allows for position, velocity, and force constraints, and is applied to a
single body heaving system.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><em>File</em></p></td>
<td><p><em>Description</em></p></td>
</tr>
<tr class="row-even"><td><p>coeff.mat</p></td>
<td><p>Coefficients for frequency dependence</p></td>
</tr>
<tr class="row-odd"><td><p>fexcPrediction.m</p></td>
<td><p>Predicts future excitation forces</p></td>
</tr>
<tr class="row-even"><td><p>sphereMPC.slx</p></td>
<td><p>Simulink model including model predictive controller</p></td>
</tr>
<tr class="row-odd"><td><p>mpcFcn.m</p></td>
<td><p>Creates and solves quadratic programming problem</p></td>
</tr>
<tr class="row-even"><td><p>plotFreqDep.m</p></td>
<td><p>Solves for and plots frequency dependence coeffs</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The Simulink diagram is shown in the figure below. The figure shows an overview of
the controller, which primarily consists of the plant model and the optimizer. The plant
model uses the excitation force, applied PTO force, and current states to calculate the
states at the next timestep. Then, the optimizer predicts the future excitation, which
is input into the mpcFcn.m file along with the states to solve for the optimal change in
PTO force (integrated to solve for instantaneous PTO force).</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpcSimulink.png"><img alt="../_images/mpcSimulink.png" src="../_images/mpcSimulink.png" style="width: 500pt;" />
</a>
</figure>
<p>The results of the model predictive controller simulation in irregular waves are shown
below with the dashed lines indicating the applied
constraints. MPC successfully restricts the system to within the constraints (except for
a few, isolated timesteps where the solver couldn’t converge) while also optimizing for maximum
average mechanical power (300 kW). The constraints can be changed to account for
specific WEC and PTO physical limitations, but will limit the average power.
There are also other parameters which can be defined or changed by the user in the
wecSimInputFile.m such as the MPC timestep, prediction horizon, r-scale, etc. to
customize and tune the controller as desired.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpcPos.png"><img alt="../_images/mpcPos.png" src="../_images/mpcPos.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpcVel.png"><img alt="../_images/mpcVel.png" src="../_images/mpcVel.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpcForce.png"><img alt="../_images/mpcForce.png" src="../_images/mpcForce.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpcForceChange.png"><img alt="../_images/mpcForceChange.png" src="../_images/mpcForceChange.png" style="width: 300pt;" />
</a>
</figure>
<p>The model predictive controller is particularly beneficial because of its ability to
predict future waves and maximize power accordingly as well as the ability to handle constraints. A
comparison to a reactive controller is shown in the table below. The reactive controller
can be tuned to stay within constraint bounds only when future wave conditions are known
and, in doing so, would sacrifice significant power. On the other hand, without knowledge
of future wave, the results from the untuned reactive controller are shown below using
optimal theoretical gains from the complex conjugate method at the peak wave period.
With no ability to recognize constraints, the reactive controller leads to much larger
amplitude and velocity and exhibits large peaks in PTO force and power, both of which
would likely lead to very expensive components and inefficient operation.
It is clear that the model predictive controller significantly outperforms the reactive
controller in terms of mechanical power harvested, constraint inclusions, and peak conditions.
Because of the increased complexity of model predictive control, limitations include longer
computation time and complex setup.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><em>Parameter</em></p></td>
<td><p><em>Constraint</em></p></td>
<td><p><em>MPC</em></p></td>
<td><p><em>Reactive</em></p></td>
</tr>
<tr class="row-even"><td><p>Max Heave Position (m)</p></td>
<td><p>4</p></td>
<td><p>4.02</p></td>
<td><p>8.06</p></td>
</tr>
<tr class="row-odd"><td><p>Max Heave Velocity (m/s)</p></td>
<td><p>3</p></td>
<td><p>2.95</p></td>
<td><p>5.63</p></td>
</tr>
<tr class="row-even"><td><p>Max PTO Force (kN)</p></td>
<td><p>2,000</p></td>
<td><p>2,180</p></td>
<td><p>4,630</p></td>
</tr>
<tr class="row-odd"><td><p>Max PTO Force Change (kN/s)</p></td>
<td><p>1,500</p></td>
<td><p>1,500</p></td>
<td><p>3,230</p></td>
</tr>
<tr class="row-even"><td><p>Peak Mechanical Power (kW)</p></td>
<td><p>N/A</p></td>
<td><p>4,870</p></td>
<td><p>13,700</p></td>
</tr>
<tr class="row-odd"><td><p>Avg Mechanical Power (kW)</p></td>
<td><p>N/A</p></td>
<td><p>300</p></td>
<td><p>241</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="reactive-control-with-direct-drive-power-take-off">
<span id="control-reactive-with-pto"></span><h3>Reactive Control with Direct Drive Power Take-Off<a class="headerlink" href="#reactive-control-with-direct-drive-power-take-off" title="Link to this heading"></a></h3>
<p>The previous controllers only considered the mechanical power output. Although maximization
of mechanical power allows for the maximum energy transfer from waves to body, it often does
not lead to maximum electrical power. The previous controller examples demonstrate the
controller types and energy transfer from waves to body, but the important consideration of
electrical power requires a PTO model. This example applies a reactive controller to the
sphere body with a simplified direct drive PTO model to maximize electrical power. Within
the Simulink subsystem for determining the PTO force, the controller prescribes the ideal or
desired force which is fed into the direct drive PTO. The current in the generator is then
used to control the applied force.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/piPTOSimulink.png"><img alt="../_images/piPTOSimulink.png" src="../_images/piPTOSimulink.png" style="width: 500pt;" />
</a>
</figure>
<p>The PTO parameters used for this example are defined in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> and correspond to
the Allied Motion Megaflux Frameless Brushless Torque Motors–MF0310 <span id="id20">[<a class="reference internal" href="#id37" title="Megaflux™ frameless direct drive torque motors. 2006. URL: https://www.alliedmotion.com/brushless-motors/brushless-direct-drive-torque-motors/megaflux-frameless-direct-drive-torque-motors/.">C7</a>]</span>. The
results in terms of capture width (ratio of absorbed power (W) to wave power (W/m)) and resultant power for the
applied gains from Section <a class="reference internal" href="#control-reactive"><span class="std std-ref">Reactive Control (Proportional-Integral)</span></a> are shown in the figures
below for a regular wave with a period of 9.6664 s and a height of 2.5 m. The “Controller (Ideal)”
power is the ideal power absorbed according to the applied controller gains.
The “Mechanical (Drivetrain)” power is the actual mechanical power absorbed by
the PTO system including the inertial, damping, and shaft torque power. Lastly, the
“Electrical (Generator)” power is the electrical power absorbed by the
generator including the product of induced current and voltage (based on shaft torque and velocity,
respectively) and the resultant generator losses (product of current squared and winding resistance).
Mechanical power maximization requires significant net input electrical power
(signified by red bar) which leads to an extremely negative capture width. Thus,
instead of harvesting electrical power, power would need to be taken from the grid or energy
storage component to achieve mechanical power maximization.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/reactiveWithPTOCCPower.png"><img alt="../_images/reactiveWithPTOCCPower.png" src="../_images/reactiveWithPTOCCPower.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/reactiveWithPTOCC.png"><img alt="../_images/reactiveWithPTOCC.png" src="../_images/reactiveWithPTOCC.png" style="width: 300pt;" />
</a>
</figure>
<p>On the other hand, by testing different controller gains in the same wave conditions
(regular wave: period = 9.6664 s, height = 2.5 m), the gains which optimize for
maximum electrical power can be found as shown below. Increasing the proportional gain
and decreasing the integral gain magnitude leads to a maximum power of about 84 kW and capture width of about
1.5 m. The resultant motion is almost ten times smaller than for the mechanical power
maximization which leads to a lower current and much lower generator power losses
(product of current squared and winding resistance).</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/reactiveWithPTOSweep.png"><img alt="../_images/reactiveWithPTOSweep.png" src="../_images/reactiveWithPTOSweep.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/reactiveWithPTOOptPower.png"><img alt="../_images/reactiveWithPTOOptPower.png" src="../_images/reactiveWithPTOOptPower.png" style="width: 300pt;" />
</a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/reactiveWithPTOOpt.png"><img alt="../_images/reactiveWithPTOOpt.png" src="../_images/reactiveWithPTOOpt.png" style="width: 300pt;" />
</a>
</figure>
</section>
</section>
<section id="cable-features">
<span id="user-advanced-features-cable"></span><h2>Cable Features<a class="headerlink" href="#cable-features" title="Link to this heading"></a></h2>
<p>Cables or tethers between two bodies apply a force only in tension (when taut or stretched), but not in compression,
can be modeled using the <code class="code docutils literal notranslate"><span class="pre">cableClass</span></code> implementation. A cable block must be added to the
model between the two PTOs or constraints that are to be connected by a cable. Users must initialize the cable
class in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> along with the base and follower connections in that order, by including the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cableClass</span><span class="p">(</span><span class="s1">&#39;cableName&#39;</span><span class="p">,</span><span class="s1">&#39;baseConnection&#39;</span><span class="p">,</span><span class="s1">&#39;followerConnection&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">baseConnection</span></code> is a PTO or constraint block that defines the cable connection on the base side, and <code class="docutils literal notranslate"><span class="pre">followerConnection</span></code>
is a PTO or constraint block that defineds the connection on the follower side.</p>
<p>It is necessary to define, at a minimum:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">cableStiffness</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">cableDamping</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">cable(i).stiffness</span></code> is the cable stiffness (N/m), and <code class="code docutils literal notranslate"><span class="pre">cable(i).damping</span></code> is the cable damping (N/(m*s)). Force from the cable stiffness or
damping is applied between the connection points if the current length of the cable exceeds the equilibrium length of the cable.
By default, the cable equilibrium length is defined to be the distance between the locations of the <code class="docutils literal notranslate"><span class="pre">baseConnection</span></code> and <code class="docutils literal notranslate"><span class="pre">followerConnection</span></code>, so that initially there is no tension on the cable.</p>
<p>If a distinct initial condition is desired, one can define either <code class="docutils literal notranslate"><span class="pre">cable(i).length</span></code> or <code class="docutils literal notranslate"><span class="pre">cable(i).preTension</span></code>, where <code class="code docutils literal notranslate"><span class="pre">cable(i).length</span></code> is the equilibrium (i.e., unstretched) length of the cable (m), and <code class="code docutils literal notranslate"><span class="pre">cable(i).preTension</span></code> is the pre-tension applied to the cable at simulation start (N). The unspecified parameter is then calculated from the location of the <code class="docutils literal notranslate"><span class="pre">baseConnection</span></code> and
<code class="docutils literal notranslate"><span class="pre">followerConnection</span></code>.</p>
<p>To include dynamics applied at the cable-to-body coupling (e.g., a stiffness and damping), a PTO block
can be used instead, and the parameters <code class="code docutils literal notranslate"><span class="pre">pto(i).damping</span></code> and <code class="code docutils literal notranslate"><span class="pre">pto(i).stiffness</span></code> can be used to describe these dynamics.</p>
<p>By default, the cable is presumed neutrally buoyant and it is not subjected to fluid drag. To include fluid drag, the user can additionally define these parameters in a style similar to the <code class="code docutils literal notranslate"><span class="pre">bodyClass</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">cd</span>
<span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">area</span>
<span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">quadDrag</span><span class="o">.</span><span class="n">drag</span>
<span class="n">cable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">linearDamping</span>
</pre></div>
</div>
<p>The cable mass and fluid drag is modeled with a low-order lumped-capacitance method with 2 nodes.
The mass and fluid drag forces are exerted at nodes defined by the 2 drag bodies.
By default, one is co-located with the <code class="docutils literal notranslate"><span class="pre">baseConnection</span></code> and the other with the <code class="docutils literal notranslate"><span class="pre">followerConnection</span></code>.
The position of these bodies can be manipulated by changing the locations of the base or follower connections points.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not appropriate to resolve the actual kinematics of cable motions, but it is sufficient to model the aggregate forces among the connected bodies.</p>
</div>
</section>
<section id="mooring-features">
<span id="user-advanced-features-mooring"></span><h2>Mooring Features<a class="headerlink" href="#mooring-features" title="Link to this heading"></a></h2>
<p>This section provides an overview of WEC-Sim’s mooring class features; for more
information about the mooring class code structure, refer to
<a class="reference internal" href="code_structure.html#user-code-structure-mooring-class"><span class="std std-ref">Mooring Class</span></a>.</p>
<p>Floating WEC systems are often connected to mooring lines to keep the device in
position. WEC-Sim allows the user to model the mooring dynamics in the
simulation by specifying the mooring matrix, a mooring lookup table, or coupling with MoorDyn. To
include mooring connections, the user can use the mooring block (i.e., Mooring
Matrix block, Mooring Lookup Table block, or MoorDyn Connection block)
given in the WEC-Sim library under Moorings lib
and connect it between the body and the Global reference frame. The Moordyn Connection
block can also be placed between two dynamic bodies or frames. Refer to the
<a class="reference internal" href="#rm3-moordyn"><span class="std std-ref">RM3 with MoorDyn</span></a>, and the <a class="reference internal" href="webinars.html#webinar8"><span class="std std-ref">Series 8 - Using MoorDyn with WEC-Sim</span></a> for more information.</p>
<p>MoorDyn is hosted on a separate <a class="reference external" href="https://github.com/WEC-Sim/moorDyn">MoorDyn repository</a>.
It must be download separately, and all files and folders should be placed in
the <code class="docutils literal notranslate"><span class="pre">$WECSIM/functions/moorDyn</span></code> directory.</p>
<section id="mooring-matrix">
<span id="id21"></span><h3>Mooring Matrix<a class="headerlink" href="#mooring-matrix" title="Link to this heading"></a></h3>
<p>When the mooring matrix block is used, the user first needs to initiate the
mooring class by setting <code class="code docutils literal notranslate"><span class="pre">mooring(i)</span> <span class="pre">=</span> <span class="pre">mooringClass('mooring</span> <span class="pre">name')</span></code> in
the WEC-Sim input file (<code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>). Typically, the mooring
connection location also needs to be specified, <code class="code docutils literal notranslate"><span class="pre">mooring(i).location</span> <span class="pre">=</span> <span class="pre">[1x3]</span></code>
(the default connection location is <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">0</span> <span class="pre">0]</span></code>). The user can also define the
mooring matrix properties in the WEC-Sim input file using:</p>
<ul class="simple">
<li><p>Mooring stiffness matrix - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.stiffness</span> <span class="pre">=</span> <span class="pre">[6x6]</span></code> in [N/m]</p></li>
<li><p>Mooring damping matrix - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.damping</span> <span class="pre">=</span> <span class="pre">[6x6]</span></code> in [Ns/m]</p></li>
<li><p>Mooring pretension - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.preTension</span> <span class="pre">=</span> <span class="pre">[1x6]</span></code> in [N]</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>“i” indicates the mooring number. More than one mooring can be specified in
the WEC-Sim model when the mooring matrix block is used.</p>
</div>
</section>
<section id="mooring-lookup-table">
<span id="mooring-lookup"></span><h3>Mooring Lookup Table<a class="headerlink" href="#mooring-lookup-table" title="Link to this heading"></a></h3>
<p>When the mooring lookup table block is used, the user first needs to initiate the
mooring class by setting <code class="code docutils literal notranslate"><span class="pre">mooring(i)</span> <span class="pre">=</span> <span class="pre">mooringClass('mooring</span> <span class="pre">name')</span></code> in
the WEC-Sim input file (<code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>). Typically, the mooring
connection location also needs to be specified, <code class="code docutils literal notranslate"><span class="pre">mooring(i).location</span> <span class="pre">=</span> <span class="pre">[1x3]</span></code>
(the default connection location is <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">0</span> <span class="pre">0]</span></code>). The user must also define the
lookup table file in the WEC-Sim input file with <code class="code docutils literal notranslate"><span class="pre">mooring(i).lookupTableFile</span> <span class="pre">=</span> <span class="pre">'FILENAME';</span></code></p>
<p>The lookup table dataset should contain one structure that contains fields for each index and each force table:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><em>Index Name</em></p></td>
<td><p><em>Description</em></p></td>
<td><p><em>Dimensions</em></p></td>
</tr>
<tr class="row-even"><td><p>X</p></td>
<td><p>Surge position [m]</p></td>
<td><p>1 x nX</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>Sway position [m]</p></td>
<td><p>1 x nY</p></td>
</tr>
<tr class="row-even"><td><p>Z</p></td>
<td><p>Heave position [m]</p></td>
<td><p>1 x nZ</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>Roll position [deg]</p></td>
<td><p>1 x nRX</p></td>
</tr>
<tr class="row-even"><td><p>RY</p></td>
<td><p>Pitch position [deg]</p></td>
<td><p>1 x nRY</p></td>
</tr>
<tr class="row-odd"><td><p>RZ</p></td>
<td><p>Yaw position [deg]</p></td>
<td><p>1 x nRZ</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><em>Force Name</em></p></td>
<td><p><em>Description</em></p></td>
<td><p><em>Dimensions</em></p></td>
</tr>
<tr class="row-even"><td><p>FX</p></td>
<td><p>Surge force [N]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
<tr class="row-odd"><td><p>FY</p></td>
<td><p>Sway force [N]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
<tr class="row-even"><td><p>FZ</p></td>
<td><p>Heave force [N]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
<tr class="row-odd"><td><p>MX</p></td>
<td><p>Roll force [Nm]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
<tr class="row-even"><td><p>MY</p></td>
<td><p>Pitch force [Nm]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
<tr class="row-odd"><td><p>MZ</p></td>
<td><p>Yaw force [Nm]</p></td>
<td><p>nX x nY x nZ x nRX x nRY x nRZ</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="moordyn">
<span id="mooring-moordyn"></span><h3>MoorDyn<a class="headerlink" href="#moordyn" title="Link to this heading"></a></h3>
<p>When a MoorDyn block is used, the user first needs to initiate the mooring class by
setting <code class="code docutils literal notranslate"><span class="pre">mooring</span> <span class="pre">=</span> <span class="pre">mooringClass('mooring</span> <span class="pre">name')</span></code> in the WEC-Sim input
file (<code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>), followed by setting <code class="code docutils literal notranslate"><span class="pre">mooring(i).moorDyn</span> <span class="pre">=</span> <span class="pre">1</span></code> to
initialize a MoorDyn connection. Each MoorDyn connection can consist of multiple
lines and each line may have multiple nodes. The number of MoorDyn lines and nodes in
each line should be defined as (<code class="docutils literal notranslate"><span class="pre">mooring(i).moorDynLines</span> <span class="pre">=</span> <span class="pre">&lt;Number</span> <span class="pre">of</span> <span class="pre">mooring</span> <span class="pre">lines&gt;</span></code>)
and (<code class="docutils literal notranslate"><span class="pre">mooring(i).moorDynNodes(iLine)</span> <span class="pre">=</span> <span class="pre">&lt;Number</span> <span class="pre">of</span> <span class="pre">mooring</span> <span class="pre">nodes</span> <span class="pre">in</span> <span class="pre">line&gt;</span></code> - only used
for ParaView visualization), respectively and should match the number of lines and nodes
specified in the MoorDyn input file. The order of the lines should also be the same
between the WEC-Sim and MoorDyn input files (i.e., for a model with two MoorDyn
connections, all lines corresponding to <code class="docutils literal notranslate"><span class="pre">mooring(1)</span></code> should be defined in the
MoorDyn input file before the lines for <code class="docutils literal notranslate"><span class="pre">mooring(2)</span></code>).</p>
<p>A mooring folder that includes a MoorDyn input file (<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is required
in the simulation folder. The body and corresponding mooring attachment points are
defined in the MoorDyn input file. The body location in the MoorDyn input file
should match that of the initial location of the body’s center of gravity (usually
derived from BEM results). MoorDyn handles the kinematic transform to
convert the mooring forces from the attachment points to the 6 degree of freedom
force acting on the current location of the body’s center of gravity. The initial
displacement of the mooring line in WEC-Sim (<code class="docutils literal notranslate"><span class="pre">mooring(i).initial.displacement</span></code>)
should match the location of the connected body in the MoorDyn input file or the
difference in location between two connected bodies. In the MoorDyn input file,
the location of points/nodes are specified relative to the body location if of
attachment type ‘body#’ and relative to the global frame for any other
attachement type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WEC-Sim/MoorDyn coupling now allows more than one mooring connnection (i.e.,
multiple MoorDyn Connection blocks) in the simulation, but there can only be
one call to MoorDyn (i.e., one MoorDyn Caller block).</p>
</div>
<section id="rm3-with-moordyn">
<span id="rm3-moordyn"></span><h4>RM3 with MoorDyn<a class="headerlink" href="#rm3-with-moordyn" title="Link to this heading"></a></h4>
<p>This section describes how to simulate a mooring connected WEC system in
WEC-Sim using MoorDyn. The RM3 two-body floating point absorber is connected to
a three-point catenary mooring system with an angle of 120 between the lines in
this example case. The RM3 with MoorDyn folder is located under the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim
Applications</a> repository.</p>
<ul class="simple">
<li><p><strong>WEC-Sim Simulink Model</strong>: Start out by following the instructions on how to
model the <a class="reference internal" href="tutorials.html#user-tutorials-rm3"><span class="std std-ref">Two-Body Point Absorber (RM3)</span></a>. To couple WEC-Sim with MoorDyn, the
MoorDyn Connection block is added in parallel to the constraint block and the
MoorDyn Caller block is added to the model (no connecting lines).</p></li>
</ul>
<figure class="align-center" id="wecsimmoordyn">
<a class="reference internal image-reference" href="../_images/WECSimMoorDyn.png"><img alt="../_images/WECSimMoorDyn.png" src="../_images/WECSimMoorDyn.png" style="width: 320pt;" />
</a>
</figure>
<ul class="simple">
<li><p><strong>WEC-Sim Input File</strong>: In the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> file, the user needs to
initiate the mooring class and MoorDyn and define the number of mooring lines.</p></li>
</ul>
<div class="highlight-matlab notranslate" id="wecsiminputmoordyn"><div class="highlight"><pre><span></span><span class="c">%% Simulation Data</span>
<span class="n">simu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulationClass</span><span class="p">();</span><span class="w">             </span>
<span class="n">simu</span><span class="p">.</span><span class="n">simMechanicsFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;RM3MoorDyn.slx&#39;</span><span class="p">;</span><span class="w">       </span><span class="c">% WEC-Sim Model File</span>
<span class="n">simu</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;accelerator&#39;</span><span class="p">;</span>
<span class="n">simu</span><span class="p">.</span><span class="n">explorer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;off&#39;</span><span class="p">;</span>
<span class="n">simu</span><span class="p">.</span><span class="n">rampTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span>
<span class="n">simu</span><span class="p">.</span><span class="n">endTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">400</span><span class="p">;</span><span class="w">                       </span>
<span class="n">simu</span><span class="p">.</span><span class="n">dt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span>
<span class="n">simu</span><span class="p">.</span><span class="n">cicDt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span>

<span class="c">%% Wave Information</span>
<span class="c">% User-Defined Time-Series</span>
<span class="n">waves</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">waveClass</span><span class="p">(</span><span class="s">&#39;elevationImport&#39;</span><span class="p">);</span><span class="w">           </span><span class="c">% Create the Wave Variable and Specify Type</span>
<span class="n">waves</span><span class="p">.</span><span class="n">elevationFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;etaData.mat&#39;</span><span class="p">;</span><span class="w">            </span><span class="c">% Name of User-Defined Time-Series File [:,2] = [time, eta]</span>
<span class="n">waves</span><span class="p">.</span><span class="n">waterDepth</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">70</span><span class="p">;</span>

<span class="c">%% Body Data</span>
<span class="c">% Float</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../_Common_Input_Files/RM3/hydroData/rm3.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">geometryFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;../../_Common_Input_Files/RM3/geometry/float.stl&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">mass</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">inertia</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">20907301</span><span class="w"> </span><span class="mf">21306090.66</span><span class="w"> </span><span class="mf">37085481.11</span><span class="p">];</span>

<span class="c">% Spar/Plate</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../_Common_Input_Files/RM3/hydroData/rm3.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">geometryFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;../../_Common_Input_Files/RM3/geometry/plate.stl&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">mass</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">inertia</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">94419614.57</span><span class="w"> </span><span class="mf">94407091.24</span><span class="w"> </span><span class="mf">28542224.82</span><span class="p">];</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">initial</span><span class="p">.</span><span class="n">displacement</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mf">0.21</span><span class="p">];</span><span class="w">     </span><span class="c">% Initial Displacement</span>

<span class="c">%% PTO and Constraint Parameters</span>
<span class="c">% Floating (3DOF) Joint</span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">constraintClass</span><span class="p">(</span><span class="s">&#39;Constraint1&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">    </span>

<span class="c">% Translational PTO</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ptoClass</span><span class="p">(</span><span class="s">&#39;PTO1&#39;</span><span class="p">);</span><span class="w">              	</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">stiffness</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="w">                             	</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">damping</span><span class="p">=</span><span class="mi">1200000</span><span class="p">;</span><span class="w">                       	</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">     </span>

<span class="c">%% Mooring</span>
<span class="c">% Moordyn</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mooringClass</span><span class="p">(</span><span class="s">&#39;mooring&#39;</span><span class="p">);</span><span class="w">           </span><span class="c">% Initialize mooringClass</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDyn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                         </span><span class="c">% Initialize MoorDyn                                                                    </span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynLines</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">                    </span><span class="c">% Specify number of lines</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">              </span><span class="c">% Specify number of nodes per line</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynNodes</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">               </span><span class="c">% Specify number of nodes per line</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">initial</span><span class="p">.</span><span class="n">displacement</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mf">21.29</span><span class="o">-</span><span class="mf">.21</span><span class="p">];</span><span class="w"> </span><span class="c">% Initial Displacement (body cg + body initial displacement)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>MoorDyn Input File</strong>: A mooring folder that includes a moorDyn input file
(<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is created. The moorDyn input file (<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is shown
in the figure below. More details on how to set up the MooDyn input file are
described in the <a class="reference external" href="https://moordyn.readthedocs.io/en/latest/">MoorDyn Documentation</a>.
One specific requirement when using WEC-Sim with MoorDyn is that the Body(s) in which
the mooring lines are attached to should be labeled as “Coupled” in the MoorDyn input
file, which allows for WEC-Sim to control the body dynamics.
Note: WEC-Sim now uses MoorDyn v2.</p></li>
</ul>
<figure class="align-center" id="moordyninput">
<a class="reference internal image-reference" href="../_images/moorDynInput.png"><img alt="../_images/moorDynInput.png" src="../_images/moorDynInput.png" style="width: 400pt;" />
</a>
</figure>
<ul class="simple">
<li><p><strong>Simulation and Post-processing</strong>: Simulation and post-processing are the
same process as described in Tutorial Section.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need to install the MinGW-w64 compiler to run this simulation.</p>
</div>
</section>
</section>
</section>
<section id="wec-sim-post-processing">
<h2>WEC-Sim Post-Processing<a class="headerlink" href="#wec-sim-post-processing" title="Link to this heading"></a></h2>
<p>WEC-Sim contains several built in methods inside the response class and wave
class to assist users in processing WEC-Sim output: <code class="docutils literal notranslate"><span class="pre">output.plotForces</span></code>,
<code class="docutils literal notranslate"><span class="pre">output.plotResponse</span></code>, <code class="docutils literal notranslate"><span class="pre">output.saveViz</span></code>, <code class="docutils literal notranslate"><span class="pre">waves.plotElevation</span></code>, and
<code class="docutils literal notranslate"><span class="pre">waves.plotSpectrum</span></code>. This section will demonstrate the use of these methods.
They are fully documented in the WEC-Sim <a class="reference internal" href="api.html#user-api"><span class="std std-ref">API</span></a>.</p>
<section id="plot-forces">
<h3>Plot Forces<a class="headerlink" href="#plot-forces" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">responseClass.plotForces()</span></code> method can be used to plot the time series of
each force component for a body. The first argument takes in a body number, the
second a degree of freedom of the force. For example, <code class="docutils literal notranslate"><span class="pre">output.plotForces(2,3)</span></code>
will plot the vertical forces that act on the 2nd body. The total force is split
into its <a class="reference internal" href="../theory/theory.html#theory-time-domain"><span class="std std-ref">components</span></a>:</p>
<ul class="simple">
<li><p>total force</p></li>
<li><p>excitation force</p></li>
<li><p>radiation damping force</p></li>
<li><p>added mass force</p></li>
<li><p>restoring force (combination of buoyancy, gravity and hydrostatic stiffness),</p></li>
<li><p>Morison element and viscous drag force</p></li>
<li><p>linear damping force</p></li>
</ul>
<figure class="align-center" id="id38" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/OSWEC_heaveForces.PNG"><img alt="../_images/OSWEC_heaveForces.PNG" src="../_images/OSWEC_heaveForces.PNG" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of output.plotForces() method for the OSWEC example.</span><a class="headerlink" href="#id38" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="plot-response">
<h3>Plot Response<a class="headerlink" href="#plot-response" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">responseClass.plotResponse()</span></code> method is very similar to <code class="docutils literal notranslate"><span class="pre">plotForces</span></code>
except that it will plot the time series of a body’s motion in a given degree
of freedom. For example, <code class="docutils literal notranslate"><span class="pre">output.plotResponse(1,5)</span></code> will plot the pitch motion
of the 1st body. The position, velocity and acceleration of that body is shown.</p>
<figure class="align-center" id="id39" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/OSWEC_pitchResponse.PNG"><img alt="../_images/OSWEC_pitchResponse.PNG" src="../_images/OSWEC_pitchResponse.PNG" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of output.plotResponse() method for the OSWEC example.</span><a class="headerlink" href="#id39" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="plot-elevation">
<h3>Plot Elevation<a class="headerlink" href="#plot-elevation" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">waveClass.plotElevation()</span></code> method can be used to plot the wave elevation time
series at the domain origin. The ramp time is also marked. The only required input
is <code class="docutils literal notranslate"><span class="pre">simu.rampTime</span></code>. Users must manually plot or overlay the wave elevation at a
wave gauge location.</p>
<figure class="align-center" id="id40" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/OSWEC_plotEta.PNG"><img alt="../_images/OSWEC_plotEta.PNG" src="../_images/OSWEC_plotEta.PNG" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of waves.plotElevation() method for the OSWEC example.</span><a class="headerlink" href="#id40" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="plot-spectrum">
<h3>Plot Spectrum<a class="headerlink" href="#plot-spectrum" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">waveClass.plotSpectrum()</span></code> method can be used to plot the frequency spectrum
of an irregular or spectrum import wave. No input parameters are required.</p>
<figure class="align-center" id="id41" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/OSWEC_plotSpectrum.PNG"><img alt="../_images/OSWEC_plotSpectrum.PNG" src="../_images/OSWEC_plotSpectrum.PNG" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of waves.plotSpectrum() method for the OSWEC example.</span><a class="headerlink" href="#id41" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="wec-sim-visualization">
<h2>WEC-Sim Visualization<a class="headerlink" href="#wec-sim-visualization" title="Link to this heading"></a></h2>
<p>WEC-Sim provides visualization in SimScape Mechanics Explorer by default. This section describes some additional options for WEC-Sim visualization</p>
<section id="wave-markers">
<span id="user-advanced-features-wave-markers"></span><h3>Wave Markers<a class="headerlink" href="#wave-markers" title="Link to this heading"></a></h3>
<p>This section describes how to visualize the wave elevations at various locations using
markers in SimScape Mechanics Explorer.
Users must define an array of [X,Y] coordinates, the marker style (sphere, cube, frames), the marker size in pixels, marker color in RGB format.
The <code class="docutils literal notranslate"><span class="pre">Global</span> <span class="pre">Reference</span> <span class="pre">Frame</span></code> block programmatically initiates and adds/deletes the visualization blocks based on the number of markers <em>(0 to N)</em> defined by the user.
Here are the steps to define wave markers representing a wave-spectra, <code class="docutils literal notranslate"><span class="pre">waves(1)</span></code>. Similar steps can be followed for subsequent <code class="docutils literal notranslate"><span class="pre">waves(#)</span></code> objects.</p>
<ul class="simple">
<li><p>Define an array of marker locations: <code class="docutils literal notranslate"><span class="pre">waves(1).marker.location</span> <span class="pre">=</span> <span class="pre">[X,Y]</span></code>, where the first column defines the X coordinates, and the second column defines the corresponding Y coordinates, Default = <code class="docutils literal notranslate"><span class="pre">[]</span></code></p></li>
<li><p>Define marker style : <code class="docutils literal notranslate"><span class="pre">waves(1).marker.style</span> <span class="pre">=</span> <span class="pre">1</span></code>, where 1: Sphere, 2: Cube, 3: Frame, Default = <code class="docutils literal notranslate"><span class="pre">1</span></code>: Sphere</p></li>
<li><p>Define marker size : <code class="docutils literal notranslate"><span class="pre">waves(1).marker.size</span> <span class="pre">=</span> <span class="pre">10</span></code>, to specify marker size in Pixels, Default = <code class="docutils literal notranslate"><span class="pre">10</span></code></p></li>
<li><p>Define marker color: <code class="docutils literal notranslate"><span class="pre">waves(1).marker.graphicColor</span> <span class="pre">=</span> <span class="pre">[1,0,0]</span></code>, to specifie marker color in RBG format.</p></li>
</ul>
<p>For more information about using ParaView for visualization, refer to the <strong>Wave_Markers</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is not compatible with user-defined waves <code class="docutils literal notranslate"><span class="pre">waves</span> <span class="pre">=</span> <span class="pre">waveClass('elevationImport')</span></code></p>
</div>
<figure class="align-center" id="id42" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/RM3_vizMarker.jpg"><img alt="../_images/RM3_vizMarker.jpg" src="../_images/RM3_vizMarker.jpg" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of visualization markers in SimScape Mechanics Explorer.</span><a class="headerlink" href="#id42" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="save-visualization">
<h3>Save Visualization<a class="headerlink" href="#save-visualization" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">responseClass.saveViz()</span></code> method can be used to create a complete
animation of the simulation. The animation shows the 3D response of all bodies
over time on top of a surface plot of the entire directional wave field. The
default wave domain is defined by <code class="docutils literal notranslate"><span class="pre">simu.domainSize</span></code>, <code class="docutils literal notranslate"><span class="pre">waves.waterDepth</span></code>, and
the maximum height that the STL mesh of any body reaches. Users may optionally
input the axis limits to restrict or widen the field of view, the time steps per
animation frame, and the output file format. Users can choose to save the animation
as either a <code class="docutils literal notranslate"><span class="pre">.gif</span></code> or <code class="docutils literal notranslate"><span class="pre">.avi</span></code> file. This function can take significant time to
run depending on simulation time and time step, however it may be faster and easier
than Paraview. Users are still recommended to use the provided Paraview macros for
more complex animations and analysis.</p>
<p>For example, in the OSWEC case the command
<code class="docutils literal notranslate"><span class="pre">output.saveViz(simu,body,waves,'timesPerFrame',5,'axisLimits',[-50</span> <span class="pre">50</span> <span class="pre">-50</span> <span class="pre">50</span> <span class="pre">-12</span> <span class="pre">20])</span></code>
results in the following figure:</p>
<figure class="align-center" id="id43" style="width: 250pt">
<a class="reference internal image-reference" href="../_images/OSWEC_plotWaves.PNG"><img alt="../_images/OSWEC_plotWaves.PNG" src="../_images/OSWEC_plotWaves.PNG" style="width: 250pt;" />
</a>
<figcaption>
<p><span class="caption-text">Demonstration of output.saveViz() method for the OSWEC example.</span><a class="headerlink" href="#id43" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="paraview-visualization">
<span id="user-advanced-features-paraview"></span><h2>Paraview Visualization<a class="headerlink" href="#paraview-visualization" title="Link to this heading"></a></h2>
<p>This section describes how to use ParaView for visualizing data from a WEC-Sim simulation.
Using ParaView visualization improves on the SimMechanics explorer by:</p>
<ul class="simple">
<li><p>Visualizing the wave field</p></li>
<li><p>Visualizing the cell-by-cell nonlinear hydrodynamic forces (when using nonlinear buoyancy and Froude-Krylov wave excitation)</p></li>
<li><p>Allowing data manipulation and additional visualization options</p></li>
</ul>
<p>However, the SimMechanics explorer shows the following information not included in the ParaView visualization:</p>
<ul class="simple">
<li><p>Location of center of gravity</p></li>
<li><p>Location of different frames (e.g. PTO and Constraint frames)</p></li>
</ul>
<p>Visualization with ParaView requires additional output files to be written to a <code class="docutils literal notranslate"><span class="pre">vtk</span></code> directory.
This makes the WEC-Sim simulation take more time and the case directory larger, so it should only be used when additional visualization is desired.
Users will also need to have some familiarity with using ParaView.
For more information about using ParaView for visualization, refer to the <a class="reference internal" href="webinars.html#webinar4"><span class="std std-ref">Series 4 - Body-to-Body Interactions</span></a>, and the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Paraview_Visualization">Paraview_Visualization</a> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<section id="install-paraview-and-wec-sim-macros">
<h3>Install ParaView and WEC-Sim Macros<a class="headerlink" href="#install-paraview-and-wec-sim-macros" title="Link to this heading"></a></h3>
<p>First, install <a class="reference external" href="http://www.paraview.org/">ParaView 5.11.1</a>.
Then, add the WEC-Sim specific macros:</p>
<ul class="simple">
<li><p>Open ParaView</p></li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">Macros</span> <span class="pre">=&gt;</span> <span class="pre">Add</span> <span class="pre">new</span> <span class="pre">macro</span></code></p></li>
<li><p>Navigate to the WEC-Sim <code class="docutils literal notranslate"><span class="pre">source/functions/paraview</span></code> directory</p></li>
<li><p>Select the first file and click <code class="docutils literal notranslate"><span class="pre">OK</span></code></p></li>
<li><p>Repeat this for all .py files in the <code class="docutils literal notranslate"><span class="pre">source/functions/paraview</span></code> directory</p></li>
</ul>
</section>
<section id="wec-sim-visualization-in-paraview">
<h3>WEC-Sim Visualization in ParaView<a class="headerlink" href="#wec-sim-visualization-in-paraview" title="Link to this heading"></a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">simu.paraview.option</span> <span class="pre">=</span> <span class="pre">1</span></code>, a <code class="docutils literal notranslate"><span class="pre">vtk</span></code> directory is created inside the WEC-Sim $CASE directory.
All files necessary for ParaView visualization are located there.
To view in ParaView:</p>
<ul class="simple">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">$CASE/vtk/&lt;filename&gt;.pvd</span></code> file in ParaView</p></li>
<li><p>Select the WEC-Sim model in the pipeline, and run the <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro</p></li>
<li><p>Move the camera to desired view</p></li>
<li><p>Click the green arrow (play) button</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro:</p>
<ul class="simple">
<li><p>Extracts each body, sets the color and opacity, and renames them</p></li>
<li><p>Extracts the waves, sets color and opacity, and renames</p></li>
<li><p>Creates the ground plane</p></li>
<li><p>Sets the camera to top view</p></li>
</ul>
<p>After opening the <code class="docutils literal notranslate"><span class="pre">.pvd</span></code> file and running the <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro you can do a number of things to visualize the simulation in different ways.
You can color waves and bodies by any of the available properties and apply any of the ParaView filters. The figures below show some of the visualization possibilities afforded by using ParaView with WEC-Sim.</p>
<figure class="align-center" id="id44" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/rm3_iso_side.png"><img alt="../_images/rm3_iso_side.png" src="../_images/rm3_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim/tree/main/examples/RM3">Reference Model 3</a></span><a class="headerlink" href="#id44" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id45" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/oswec_iso_side.png"><img alt="../_images/oswec_iso_side.png" src="../_images/oswec_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim/tree/main/examples/OSWEC">Bottom-fixed Oscillating Surge WEC (OSWEC)</a></span><a class="headerlink" href="#id45" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id46" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/sphere_freedecay_iso_side.png"><img alt="../_images/sphere_freedecay_iso_side.png" src="../_images/sphere_freedecay_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Free_Decay">Sphere</a></span><a class="headerlink" href="#id46" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id47" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/ellipsoid_iso_side.png"><img alt="../_images/ellipsoid_iso_side.png" src="../_images/ellipsoid_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Nonlinear_Hydro">Ellipsoid</a></span><a class="headerlink" href="#id47" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id48" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/gbm_iso_side.png"><img alt="../_images/gbm_iso_side.png" src="../_images/gbm_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Generalized_Body_Modes">Barge with Four Flexible Body Modes</a></span><a class="headerlink" href="#id48" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id49" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/wigley_iso_side.png"><img alt="../_images/wigley_iso_side.png" src="../_images/wigley_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text">Wigley Ship Hull</span><a class="headerlink" href="#id49" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id50" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/wecccomp_iso_side.png"><img alt="../_images/wecccomp_iso_side.png" src="../_images/wecccomp_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://github.com/WEC-Sim/WECCCOMP">Wave Energy Converter Control Competition (WECCCOMP) Wavestar Device</a></span><a class="headerlink" href="#id50" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id51" style="width: 400pt">
<a class="reference internal image-reference" href="../_images/oc6_iso_side.png"><img alt="../_images/oc6_iso_side.png" src="../_images/oc6_iso_side.png" style="width: 400pt;" />
</a>
<figcaption>
<p><span class="caption-text">OC6 Phase I DeepCwind Floating Semisubmersible</span><a class="headerlink" href="#id51" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Two examples using Paraview for visualization of WEC-Sim data are provided in the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Paraview_Visualization">Paraview_Visualization</a> directory of the WEC-Sim Applications repository.
The <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Paraview_Visualization/RM3_MoorDyn_Viz">RM3_MoorDyn_Viz</a> example uses ParaView for WEC-Sim data visualization of a WEC-Sim model coupled with <a class="reference external" href="http://wec-sim.github.io/WEC-Sim/advanced_features.html#moordyn">MoorDyn</a> to simulate a mooring system for the <a class="reference external" href="http://wec-sim.github.io/WEC-Sim/tutorials.html#two-body-point-absorber-rm3">RM3</a> geometry.
The <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Paraview_Visualization/OSWEC_NonLinear_Viz">OSWEC_NonLinear_Viz</a> example uses ParaView for WEC-Sim data visualization of a WEC-Sim model with <a class="reference external" href="http://wec-sim.github.io/WEC-Sim/advanced_features.html#nonlinear-buoyancy-and-froude-krylov-excitation">nonlinear Hydro</a> to simulate nonlinear wave excitation on the flap of the <a class="reference external" href="http://wec-sim.github.io/WEC-Sim/tutorials.html#oscillating-surge-wec-oswec.">OSWEC</a> geometry.</p>
<section id="moordyn-visualization-in-paraview">
<h4>MoorDyn Visualization in ParaView<a class="headerlink" href="#moordyn-visualization-in-paraview" title="Link to this heading"></a></h4>
<p>The video below shows three different views of the RM3 model with MoorDyn.
The left view uses the WEC-Sim macro.
The top right view uses the <code class="docutils literal notranslate"><span class="pre">slice</span></code> filter.
The bottom right view shows the free surface colored by wave elevation.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yL6LHdYTBIo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></section>
<section id="nonlinear-hydro-visualization-in-paraview">
<h4>Nonlinear Hydro Visualization in ParaView<a class="headerlink" href="#nonlinear-hydro-visualization-in-paraview" title="Link to this heading"></a></h4>
<p>When using nonlinear buoyancy and Froude-Krylov wave excitation the paraview files also contain cell data for the bodies.
The cell data are:</p>
<ul class="simple">
<li><p>Cell areas</p></li>
<li><p>Hydrostatic pressures</p></li>
<li><p>Linear Froude-Krylov pressures</p></li>
<li><p>Nonlinear Froude-Krylov pressures</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">pressureGlyphs</span></code> macro calculates cell normals, and cell centers. It then creates the following glyphs:</p>
<ul class="simple">
<li><p>Hydrostatic pressure</p></li>
<li><p>Linear Froude-Krylov pressure</p></li>
<li><p>Nonlinear Froude-Krylov pressure</p></li>
<li><p>Total pressure (hydrostatic plus nonlinear Froude-Krylov)</p></li>
<li><p>Froude-Krylov delta (nonlinear minus linear)</p></li>
</ul>
<p>To view WEC-Sim nonlinear hydro data in ParaView:</p>
<ul class="simple">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">$CASE/vtk/&lt;filename&gt;.pvd</span></code> file in ParaView</p></li>
<li><p>Select the WEC-Sim model in the pipeline, and run the <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro</p></li>
<li><p>Move the camera to desired view</p></li>
<li><p>Select the WEC-Sim model again in the pipeline, and run the <code class="docutils literal notranslate"><span class="pre">pressureGlyphs</span></code> macro</p></li>
<li><p>Select which features to visualize in the pipeline</p></li>
<li><p>Click the green arrow (play) button</p></li>
</ul>
<p>The video below shows three different views of the OSWEC model with non-linear hydrodynamics.
The top right shows glyphs of the nonlinear Froude-Krylov pressure acting on the float.
The bottom right shows the device colored by hydrostatic pressure.</p>
<blockquote>
<div><iframe width="560" height="315" src="https://www.youtube.com/embed/JfKxQ1AgQBk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div></blockquote>
</section>
</section>
<section id="loading-a-paraview-state-file">
<h3>Loading a ParaView State File<a class="headerlink" href="#loading-a-paraview-state-file" title="Link to this heading"></a></h3>
<p>If a previous <code class="docutils literal notranslate"><span class="pre">*.pvsm</span></code> ParaView state file was saved, the state can be applied to a <code class="docutils literal notranslate"><span class="pre">*.pvd</span></code> ParaView file. To load a state file:</p>
<ul class="simple">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">$CASE/vtk/&lt;filename&gt;.pvd</span></code> file in ParaView</p></li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">=&gt;</span> <span class="pre">Load</span> <span class="pre">State</span></code></p></li>
<li><p>Select the desired <code class="docutils literal notranslate"><span class="pre">$CASE/&lt;filename&gt;.pvsm</span></code> Paraview state file to apply</p></li>
<li><p>Select the “Search files under specified directory” option, specify the desired WECS-Sim <code class="docutils literal notranslate"><span class="pre">$CASE/vtk/</span></code> directory, and click <code class="docutils literal notranslate"><span class="pre">OK</span></code></p></li>
</ul>
<p>Paraview state files are provided for both <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications/tree/main/Paraview_Visualization">Paraview_Visualization</a> examples provided onthe WEC-Sim Applications repository, one for the RM3 using MoorDyn, and another for the OSWEC with nonlinear hydro.</p>
</section>
<section id="paraview-visualization-parameters">
<h3>ParaView Visualization Parameters<a class="headerlink" href="#paraview-visualization-parameters" title="Link to this heading"></a></h3>
<p>The following table lists the WEC-Sim simulation parameters that can be specified in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code> to control the ParaView visualization. Note, the <code class="docutils literal notranslate"><span class="pre">body.viz</span></code> properties are also used for the SimMechanics explorer visualization.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>WEC-Sim Visualization using ParaView</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>Variable</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">simu.paraview.option</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">0 to not output ParaView files [default]</div>
<div class="line">1 to output ParaView files</div>
</div>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.paraview.startTime</span></code></p></td>
<td><p>time (s) to start ParaView visualization</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.paraview.endTime</span></code></p></td>
<td><p>time (s) to end ParaView visualization</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.paraview.dt</span></code></p></td>
<td><p>time step between adjacent ParaView frames [default 1]</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.paraview.path</span></code></p></td>
<td><p>directory to create ParaView visualization files</p></td>
</tr>
<tr class="row-even"><td colspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">simu.nonlinearHydro</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">0 for no nonlinear hydro [default]</div>
<div class="line">1 for nonlinear hydro with mean free surface</div>
<div class="line">2 for nonlinear hydro with instantaneous free surface</div>
</div>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.domainSize</span></code></p></td>
<td><p>size of ground and water planes in meters [default 200]</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">simu.dtOut</span></code></p></td>
<td><p>simulation output sampling time step [default dt]</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">body(i).viz.color</span></code></p></td>
<td><p>[RGB] body color [default [1 1 0]]</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">body(i).viz.opacity</span></code></p></td>
<td><p>body opacity [default 1]</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">body(i).paraview</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">0 to exclude body from ParaView visualization</div>
<div class="line">1 to include body in ParaView visualization [default]</div>
</div>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">waves.viz.numPointsX</span></code></p></td>
<td><p>wave plane discretization: number of X points [default 50]</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p><code class="docutils literal notranslate"><span class="pre">waves.viz.numPointsY</span></code>   | wave plane discretization: number of Y points [default 50]</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="decay-tests">
<span id="user-advanced-features-decay"></span><span id="user-advanced-features-wsviz"></span><h2>Decay Tests<a class="headerlink" href="#decay-tests" title="Link to this heading"></a></h2>
<p>When performing simulations of decay tests, you must use one of the no-wave
cases and setup the initial (time = 0) location of each body, constraint, PTO,
and mooring block. The initial location of a body or mooring block is set by
specifying the centerGravity or location at the stability position (as with any WEC-Sim
simulation) and then specifying an initial displacement. To specify an initial
displacement, the body and mooring blocks have a <code class="code docutils literal notranslate"><span class="pre">.initial</span></code> property
with which you can specify a translation and angular rotation about an
arbitrary axis. For the constraint and PTO blocks, the <code class="code docutils literal notranslate"><span class="pre">.location</span></code> property
must be set to the location at time = 0.</p>
<p>There are methods available to help setup this initial displacement for all
bodies, constraints, PTOs, and moorings. To do this, you would use the:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">body(i).setInitDisp()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">constraint(i).setInitDisp()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">pto(i).setInitDisp()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mooring(i).setInitDisp()</span></code></p></li>
</ul>
<p>methods in the WEC-Sim input file. A description of the required input can be
found in the method’s header comments. The following properties must be
defined prior to using the object’s <code class="code docutils literal notranslate"><span class="pre">setInitDisp()</span></code> method:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">body(i).centerGravity</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">constraint(i).location</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">pto(i).location</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mooring.location</span></code></p></li>
</ul>
<p>For more information, refer to the <strong>Free Decay</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim
Applications</a> repository.</p>
</section>
<section id="other-features">
<h2>Other Features<a class="headerlink" href="#other-features" title="Link to this heading"></a></h2>
<p>The WEC-Sim Applications repository also includes examples of using WEC-Sim to
model a Desalination plant and a numerical model of the WaveStar device for
control implementation. The WaveStar device was used in the WECCCOMP wave
energy control competition.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<div class="docutils container" id="id30">
<div role="list" class="citation-list">
<div class="citation" id="id31" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">C1</a><span class="fn-bracket">]</span></span>
<p>Giorgio Bacelli and Ryan G Coe. Comments on control of wave energy converters. <em>IEEE Transactions on Control Systems Technology</em>, 29(1):478–481, 2020.</p>
</div>
<div class="citation" id="id32" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">C2</a><span class="fn-bracket">]</span></span>
<p>Giorgio Bacelli, Victor Nevarez, Ryan G Coe, and David G Wilson. Feedback resonating control for a wave energy converter. <em>IEEE Transactions on Industry Applications</em>, 56(2):1862–1868, 2019.</p>
</div>
<div class="citation" id="id34" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">C3</a><span class="fn-bracket">]</span></span>
<p>RPF Gomes, MFP Lopes, JCC Henriques, LMC Gato, and AFO Falcão. The dynamics and power extraction of bottom-hinged plate wave energy converters in regular and irregular waves. <em>Ocean Engineering</em>, 96:86–99, 2015.</p>
</div>
<div class="citation" id="id33" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id16">C4</a><span class="fn-bracket">]</span></span>
<p>Ryan G Coe, Giorgio Bacelli, and Dominic Forbush. A practical approach to wave energy modeling and control. <em>Renewable and Sustainable Energy Reviews</em>, 142:110791, 2021.</p>
</div>
<div class="citation" id="id35" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>C5<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id17">1</a>,<a role="doc-backlink" href="#id18">2</a>)</span>
<p>Aurélien Babarit and Alain H Clément. Optimal latching control of a wave energy device in regular and irregular waves. <em>Applied Ocean Research</em>, 28(2):77–91, 2006.</p>
</div>
<div class="citation" id="id36" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id19">C6</a><span class="fn-bracket">]</span></span>
<p>Ratanak So, Mike Starrett, Kelley Ruehl, and Ted KA Brekken. Development of control-sim: control strategies for power take-off integrated wave energy converter. In <em>2017 IEEE Power &amp; Energy Society General Meeting</em>, 1–5. IEEE, 2017.</p>
</div>
<div class="citation" id="id37" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id20">C7</a><span class="fn-bracket">]</span></span>
<p>Megaflux™ frameless direct drive torque motors. 2006. URL: <a class="reference external" href="https://www.alliedmotion.com/brushless-motors/brushless-direct-drive-torque-motors/megaflux-frameless-direct-drive-torque-motors/">https://www.alliedmotion.com/brushless-motors/brushless-direct-drive-torque-motors/megaflux-frameless-direct-drive-torque-motors/</a>.</p>
</div>
</div>
</div>
</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="code_structure.html" class="btn btn-neutral float-left" title="Code Structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="applications.html" class="btn btn-neutral float-right" title="WEC-Sim Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, National Renewable Energy Laboratory and National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../dev/user/advanced_features.html">dev</a></dd>
      <dd><a href="advanced_features.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>