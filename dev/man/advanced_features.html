

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Features &mdash; WEC-Sim  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Webinars" href="webinars.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> WEC-Sim
          

          
          </a>

          
            
            
              <div class="version">
                v4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Code Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bemio">BEMIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bemio-functions">BEMIO Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bemio-hydro-data-structure">BEMIO <em>hydro</em> Data Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-your-own-h5-file">Writing Your Own h5 File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-features">Simulation Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multiple-condition-runs-mcr">Multiple Condition Runs (MCR)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parallel-computing-toolbox-pct">Parallel Computing Toolbox (PCT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-space-representation">State-Space Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-step-features">Time-Step Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fixed-time-step-ode4">Fixed Time-Step (ode4)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variable-time-step-ode45">Variable Time-Step (ode45)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wave-features">Wave Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#irregular-wave-binning">Irregular Wave Binning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wave-directionality">Wave Directionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wave-directional-spreading">Wave Directional Spreading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#irregular-waves-with-seeded-phase">Irregular Waves with Seeded Phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wave-gauge-placement">Wave Gauge Placement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#body-features">Body Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#body-mass-and-geometry-features">Body Mass and Geometry Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nonlinear-buoyancy-and-froude-krylov-excitation">Nonlinear Buoyancy and Froude-Krylov Excitation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nonlinear-settings">Nonlinear Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stl-file-generation">STL File Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonlinear-buoyancy-and-froude-krylov-wave-excitation-tutorial-heaving-ellipsoid">Nonlinear Buoyancy and Froude-Krylov Wave Excitation Tutorial - Heaving Ellipsoid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#passive-yaw-implementation">Passive Yaw Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-hydrodynamic-bodies">Non-Hydrodynamic Bodies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#body-to-body-interactions">Body-To-Body Interactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generalized-body-modes">Generalized Body Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#viscous-damping-and-morison-elements">Viscous Damping and Morison Elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#viscous-damping">Viscous Damping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#morison-elements">Morison Elements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#drag-body-implementation">Drag Body Implementation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constraint-and-pto-features">Constraint and PTO Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modifying-constraints-and-ptos">Modifying Constraints and PTOs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#incorporating-joint-actuation-stroke-limits">Incorporating Joint/Actuation Stroke Limits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pto-sim">PTO-Sim</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tutorial-rm3-with-pto-sim">Tutorial: RM3 with PTO-Sim</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tutorial-oswec-with-pto-sim">Tutorial: OSWEC with PTO-Sim</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mooring-features">Mooring Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mooring-matrix">Mooring Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moordyn">MoorDyn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rm3-with-moordyn">RM3 with MoorDyn</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualization-paraview">Visualization/Paraview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-started-installation">Getting Started - Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-paraview-output">Setting Up Paraview Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#outputs-and-opening-in-paraview">Outputs and Opening in Paraview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-visualization-manipulation">Basic Visualization Manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-non-linear-buoyancy-and-froude-krylov-wave-excitation">Visualizing Non-Linear Buoyancy and Froude-Krylov Wave Excitation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#decay-tests">Decay Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-applications">Other Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">WEC-Sim API</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WEC-Sim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Advanced Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/man/advanced_features.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../master/man/advanced_features.html"><b>Warning:</b> This document is for the development version of WEC-Sim. The main version is master.</a></p>
<div class="section" id="advanced-features">
<span id="id1"></span><h1>Advanced Features<a class="headerlink" href="#advanced-features" title="Permalink to this headline">¶</a></h1>
<p>The advanced features documentation provides an overview of WEC-Sim features and applications that were not covered in the WEC-Sim <a class="reference internal" href="tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a>. The diagram below highlights some of WEC-Sim’s advanced features, details of which will be described in the following sections. Most advanced features have a corresponding example case within the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim_Applications repository</a> or the <code class="docutils literal notranslate"><span class="pre">WEC-Sim/Examples</span></code> directory in the WEC-Sim source code. For those topics of interest, it is recommended that users run and understand the output of an application while reading the documentation on the feature.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/codeFeatures.png"><img alt="../_images/codeFeatures.png" src="../_images/codeFeatures.png" style="width: 400pt;" /></a>
</div>
<div class="section" id="bemio">
<span id="id2"></span><h2>BEMIO<a class="headerlink" href="#bemio" title="Permalink to this headline">¶</a></h2>
<p>The Boundary Element Method Input/Output (BEMIO) functions are used to pre-process the BEM hydrodynamic data prior to running WEC-Sim. For more information about the WEC-Sim workflow, refer to <a class="reference internal" href="overview.html#running-wec-sim"><span class="std std-ref">Running WEC-Sim</span></a>. The following section can also be followed in conjunction with the cases in the WEC-Sim/Examples directory in the WEC-Sim source code. This includes several cases with WAMIT, NEMOH and AQWA. For more information, refer to <a class="reference internal" href="webinars.html#webinar1"><span class="std std-ref">Webinar 1 - BEMIO and MCR</span></a>. BEMIO functions perform the following tasks:</p>
<ul class="simple">
<li>Read BEM results from <strong>WAMIT</strong>, <strong>NEMOH</strong>, or <strong>AQWA</strong>.</li>
<li>Calculate the radiation and excitation impulse response functions (IRFs).</li>
<li>Calculate the state space realization for the radiation IRF.</li>
<li>Save the resulting data in Hierarchical Data Format 5 (HDF5).</li>
<li>Plot typical hydrodynamic data for user verification.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Previously the <a class="reference external" href="http://wec-sim.github.io/bemio/installing.html">python based BEMIO code</a> was used for this purpose. The python BEMIO functions have been converted to MATLAB and are included in the WEC-Sim source code. The python based BEMIO code will remain available but will no longer be  supported.</p>
</div>
<div class="section" id="bemio-functions">
<h3>BEMIO Functions<a class="headerlink" href="#bemio-functions" title="Permalink to this headline">¶</a></h3>
<p><strong>Read_WAMIT:</strong> Reads data from a WAMIT output file</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Read_WAMIT(hydro, filename, ex_coeff)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><em>filename</em> – <code class="docutils literal notranslate"><span class="pre">*.out</span></code> WAMIT output file</li>
<li><em>ex_coeff</em> - flag indicating the type of excitation force coefficients to read, ‘diffraction’ (default) or ‘haskind’</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Read_NEMOH:</strong> Reads data from a NEMOH working folder</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Read_NEMOH(hydro, filedir)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><dl class="first docutils">
<dt><em>filedir</em> – NEMOH working folder, must include:</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">Nemoh.cal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Mesh/Hydrostatics.dat</span></code> (or <code class="docutils literal notranslate"><span class="pre">Hydrostatiscs_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">Hydrostatics_1.dat</span></code>, etc. for multiple bodies)</li>
<li><code class="docutils literal notranslate"><span class="pre">Mesh/KH.dat</span></code> (or <code class="docutils literal notranslate"><span class="pre">KH_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">KH_1.dat</span></code>, etc. for multiple bodies)</li>
<li><code class="docutils literal notranslate"><span class="pre">Results/RadiationCoefficients.tec</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Results/ExcitationForce.tec</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Instructions on how to download and use the open source BEM code NEMOH are provided on the <a class="reference external" href="https://lheea.ec-nantes.fr/logiciels-et-brevets/nemoh-presentation-192863.kjsp">NEMOH website</a>.</li>
<li>The NEMOH Mesh.exe code creates the <code class="docutils literal notranslate"><span class="pre">Hydrostatics.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">KH.dat</span></code> files (among other files) for one input body at a time. For the Read_NEMOH function to work correctly in the case of a multiple body system, the user must manually rename <code class="docutils literal notranslate"><span class="pre">Hydrostatics.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">KH.dat</span></code> files to <code class="docutils literal notranslate"><span class="pre">Hydrostatics_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">Hydrostatics_1.dat</span></code>, …, and <code class="docutils literal notranslate"><span class="pre">KH_0.dat</span></code>, <code class="docutils literal notranslate"><span class="pre">KH_1.dat</span></code>,…, corresponding to the body order specified in the <code class="docutils literal notranslate"><span class="pre">Nemoh.cal</span></code> file.</li>
</ul>
</div>
<p><strong>Read_AQWA:</strong> Reads data from AQWA output files</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Read_AQWA(hydro, ah1_filename, lis_filename)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><em>ah1_filename</em> – <code class="docutils literal notranslate"><span class="pre">*.AH1</span></code> AQWA output file</li>
<li><em>lis_filename</em> – <code class="docutils literal notranslate"><span class="pre">*.LIS</span></code> AQWA output file</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Normalize:</strong> Normalizes NEMOH and AQWA hydrodynamics coefficients in the same manner that WAMIT outputs are normalized. Specifically, the linear hydrostatic restoring stiffness is normalized as, <span class="math notranslate nohighlight">\(C_{i,j}/\rho g\)</span>; the radiation added mass is normalized as, <span class="math notranslate nohighlight">\(A_{i,j}/\rho\)</span>; radiation wave damping is normalized as, <span class="math notranslate nohighlight">\(B_{i,j}/\rho \omega\)</span>; and the wave-exciting forces are normalized as, <span class="math notranslate nohighlight">\(F_{exc,i}/\rho g\)</span>. Typically, this function would not be called directly by the user; it is automatically implemented within the Read_NEMOH and Read_AQWA functions.</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Normalize(hydro)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Combine_BEM:</strong> Combines multiple BEM outputs into one hydrodynamic “system”. This function requires that all BEM outputs have the same water depth, wave frequencies, and wave headings. This function would be implemented following multiple Read functions and before the IRF, Write_H5, or Plot_BEMIO functions.</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Combine_BEM(hydro)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Radiation_IRF:</strong> Calculates the normalized radiation impulse response function. This is equivalent to the radiation IRF in the theory section normalized by <span class="math notranslate nohighlight">\(\rho\)</span>:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\overline{K}_{r,i,j}(t) = {\frac{2}{\pi}}\intop_0^{\infty}{\frac{B_{i,j}(\omega)}{\rho}}\cos({\omega}t)d\omega\)</span></p>
<dl class="docutils">
<dt><em>hydro = Radiation_IRF(hydro, t_end, n_t, n_w, w_min, w_max)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><em>t_end</em> – calculation range for the IRF, where the IRF is calculated from t = 0 to t_end, and the default is 100 s</li>
<li><em>n_t</em> – number of time steps in the IRF, the default is 1001</li>
<li><em>n_w</em> – number of frequency steps used in the IRF calculation (hydrodynamic coefficients are interpolated to correspond), the default is 1001</li>
<li><em>w_min</em> – minimum frequency to use in the IRF calculation, the default is the minimum frequency from the BEM data</li>
<li><em>w_max</em> – maximum frequency to use in the IRF calculation, the default is the maximum frequency from the BEM data.</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Radiation_IRF_SS:</strong> Calculates the state space (SS) realization of the radiation IRF. If this function is used, it must be implemented after the Radiation_IRF function.</p>
<blockquote>
<div><dl class="docutils">
<dt><em>hydro = Radiation_IRF_SS(hydro, Omax, R2t)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><em>Omax</em> – maximum order of the SS realization, the default is 10</li>
<li><em>R2t</em> – <span class="math notranslate nohighlight">\(R^2\)</span> threshold (coefficient of determination) for the SS realization, where <span class="math notranslate nohighlight">\(R^2\)</span> may range from 0 to 1, and the default is 0.95</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Excitation_IRF:</strong> Calculates the excitation impulse response function.</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\overline{K}_{e,i,\theta}(t) = {\frac{1}{2\pi}}\intop_{-\infty}^{\infty}{\frac{X_i(\omega,\theta)e^{i{\omega}t}}{{\rho}g}}d\omega\)</span></p>
<dl class="docutils">
<dt><em>hydro = Excitation_IRF(hydro, t_end, n_t, n_w, w_min, w_max)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
<li><em>t_end</em> – calculation range for the IRF, where the IRF is calculated from t = -t_end to t_end, and the default is 100 s</li>
<li><em>n_t</em> – number of time steps in the IRF, the default is 1001</li>
<li><em>n_w</em> – number of frequency steps used in the IRF calculation (hydrodynamic coefficients are interpolated to correspond), the default is 1001</li>
<li><em>w_min</em> – minimum frequency to use in the IRF calculation, the default is the minimum frequency from the BEM data</li>
<li><em>w_max</em> – maximum frequency to use in the IRF calculation, the default is the maximum frequency from the BEM data.</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p><strong>Write_H5:</strong> Writes the hydro data structure to a <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.</p>
<blockquote>
<div><dl class="docutils">
<dt>Write_H5(hydro)</dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
</ul>
</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Technically, this step should not be necessary - the MATLAB data structure <em>hydro</em> is written to a <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file by BEMIO and then read back into a new MATLAB data structure <em>hydroData</em> for each body by WEC-Sim. The reasons this step was retained were, first, to remain compatible with the python based BEMIO output and, second, for the simpler data visualization and verification capabilities offered by the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file viewer.</p>
</div>
<p><strong>Plot_BEMIO:</strong> Plots the radiation added mass, radiation wave damping, radiation IRF, excitation force magnitude, excitation force phase, and excitation IRF for each body in the heave, surge and pitch degrees of freedom.</p>
<blockquote>
<div><dl class="docutils">
<dt><em>Plot_BEMIO(hydro)</em></dt>
<dd><ul class="first last simple">
<li><em>hydro</em> – data structure</li>
</ul>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="bemio-hydro-data-structure">
<h3>BEMIO <em>hydro</em> Data Structure<a class="headerlink" href="#bemio-hydro-data-structure" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="15%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Variable</strong></td>
<td><strong>Format</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>A</td>
<td>[6*Nb,6*Nb,Nf]</td>
<td>radiation added mass</td>
</tr>
<tr class="row-odd"><td>Ainf</td>
<td>[6*Nb,6*Nb]</td>
<td>infinite frequency added mass</td>
</tr>
<tr class="row-even"><td>B</td>
<td>[6*Nb,6*Nb,Nf]</td>
<td>radiation wave damping</td>
</tr>
<tr class="row-odd"><td>theta</td>
<td>[1,Nh]</td>
<td>wave headings (deg)</td>
</tr>
<tr class="row-even"><td>body</td>
<td>{1,Nb}</td>
<td>body names</td>
</tr>
<tr class="row-odd"><td>cb</td>
<td>[3,Nb]</td>
<td>center of buoyancy</td>
</tr>
<tr class="row-even"><td>cg</td>
<td>[3,Nb]</td>
<td>center of gravity</td>
</tr>
<tr class="row-odd"><td>code</td>
<td>string</td>
<td>BEM code (WAMIT, AQWA, or NEMOH)</td>
</tr>
<tr class="row-even"><td>C</td>
<td>[6,6,Nb]</td>
<td>hydrostatic restoring stiffness</td>
</tr>
<tr class="row-odd"><td>dof</td>
<td>[6 + GBM, Nb]</td>
<td>Degrees of freedom (DOF) for each body. Default DOF for each body is 6 plus number of possible generalized body modes (GBM).</td>
</tr>
<tr class="row-even"><td>exc_im</td>
<td>[6*Nb,Nh,Nf]</td>
<td>imaginary component of excitation force or torque</td>
</tr>
<tr class="row-odd"><td>exc_K</td>
<td>[6*Nb,Nh,length(ex_t)]</td>
<td>excitation IRF</td>
</tr>
<tr class="row-even"><td>exc_ma</td>
<td>[6*Nb,Nh,Nf]</td>
<td>magnitude of excitation force or torque</td>
</tr>
<tr class="row-odd"><td>exc_ph</td>
<td>[6*Nb,Nh,Nf]</td>
<td>phase of excitation force or torque</td>
</tr>
<tr class="row-even"><td>exc_re</td>
<td>[6*Nb,Nh,Nf]</td>
<td>real component of excitation force or torque</td>
</tr>
<tr class="row-odd"><td>exc_t</td>
<td>[1,length(ex_t)]</td>
<td>time steps in the excitation IRF</td>
</tr>
<tr class="row-even"><td>exc_w</td>
<td>[1,length(ex_w)]</td>
<td>frequency step in the excitation IRF</td>
</tr>
<tr class="row-odd"><td>file</td>
<td>string</td>
<td>BEM output filename</td>
</tr>
<tr class="row-even"><td>fk_im</td>
<td>[6*Nb,Nh,Nf]</td>
<td>imaginary component of Froude-Krylov contribution to the excitation force or torque</td>
</tr>
<tr class="row-odd"><td>fk_ma</td>
<td>[6*Nb,Nh,Nf]</td>
<td>magnitude of Froude-Krylov excitation component</td>
</tr>
<tr class="row-even"><td>fk_ph</td>
<td>[6*Nb,Nh,Nf]</td>
<td>phase of Froude-Krylov excitation component</td>
</tr>
<tr class="row-odd"><td>fk_re</td>
<td>[6*Nb,Nh,Nf]</td>
<td>real component of Froude-Krylov contribution to the excitation force or torque</td>
</tr>
<tr class="row-even"><td>g</td>
<td>[1,1]</td>
<td>gravity</td>
</tr>
<tr class="row-odd"><td>h</td>
<td>[1,1]</td>
<td>water depth</td>
</tr>
<tr class="row-even"><td>Nb</td>
<td>[1,1]</td>
<td>number of bodies</td>
</tr>
<tr class="row-odd"><td>Nf</td>
<td>[1,1]</td>
<td>number of wave frequencies</td>
</tr>
<tr class="row-even"><td>Nh</td>
<td>[1,1]</td>
<td>number of wave headings</td>
</tr>
<tr class="row-odd"><td>ra_K</td>
<td>[6*Nb,6*Nb,length(ra_t)]</td>
<td>radiation IRF</td>
</tr>
<tr class="row-even"><td>ra_t</td>
<td>[1,length(ra_t)]</td>
<td>time steps in the radiation IRF</td>
</tr>
<tr class="row-odd"><td>ra_w</td>
<td>[1,length(ra_w)]</td>
<td>frequency steps in the radiation IRF</td>
</tr>
<tr class="row-even"><td>rho</td>
<td>[1,1]</td>
<td>density</td>
</tr>
<tr class="row-odd"><td>sc_im</td>
<td>[6*Nb,Nh,Nf]</td>
<td>imaginary component of scattering contribution to the excitation force or torque</td>
</tr>
<tr class="row-even"><td>sc_ma</td>
<td>[6*Nb,Nh,Nf]</td>
<td>magnitude of scattering excitation component</td>
</tr>
<tr class="row-odd"><td>sc_ph</td>
<td>[6*Nb,Nh,Nf]</td>
<td>phase of scattering excitation component</td>
</tr>
<tr class="row-even"><td>sc_re</td>
<td>[6*Nb,Nh,Nf]</td>
<td>real component of scattering contribution to the excitation force or torque</td>
</tr>
<tr class="row-odd"><td>ss_A</td>
<td>[6*Nb,6*Nb,ss_O,ss_O]</td>
<td>state space A matrix</td>
</tr>
<tr class="row-even"><td>ss_B</td>
<td>[6*Nb,6*Nb,ss_O,1]</td>
<td>state space B matrix</td>
</tr>
<tr class="row-odd"><td>ss_C</td>
<td>[6*Nb,6*Nb,1,ss_O]</td>
<td>state space C matrix</td>
</tr>
<tr class="row-even"><td>ss_conv</td>
<td>[6*Nb,6*Nb]</td>
<td>state space convergence flag</td>
</tr>
<tr class="row-odd"><td>ss_D</td>
<td>[6*Nb,6*Nb,1]</td>
<td>state space D matrix</td>
</tr>
<tr class="row-even"><td>ss_K</td>
<td>[6*Nb,6*Nb,length(ra_t)]</td>
<td>state space radiation IRF</td>
</tr>
<tr class="row-odd"><td>ss_O</td>
<td>[6*Nb,6*Nb]</td>
<td>state space order</td>
</tr>
<tr class="row-even"><td>ss_R2</td>
<td>[6*Nb,6*Nb]</td>
<td>state space R2 fit</td>
</tr>
<tr class="row-odd"><td>T</td>
<td>[1,Nf]</td>
<td>wave periods</td>
</tr>
<tr class="row-even"><td>Vo</td>
<td>[1,Nb]</td>
<td>displaced volume</td>
</tr>
<tr class="row-odd"><td>omega</td>
<td>[1,Nf]</td>
<td>wave frequencies</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="writing-your-own-h5-file">
<h3>Writing Your Own h5 File<a class="headerlink" href="#writing-your-own-h5-file" title="Permalink to this headline">¶</a></h3>
<p>The most common way of creating a <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file is using BEMIO to post-process the outputs of a BEM code.
This requires a single BEM solution that contains all hydrodynamic bodies and accounts for body-to-body interactions.
Some cases in which you might want to create your own h5 file are:</p>
<ul class="simple">
<li>Use experimentally determined coefficients or a mix of BEM and experimental coefficients.</li>
<li>Combine results from different BEM files and have the coefficient matrices be the correct size for the new total number of bodies.</li>
<li>Modify the BEM results for any other reason.</li>
</ul>
<p>MATLAB and Python have functions to read and write <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> files easily.
WEC-Sim includes three functions to help you create your own <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.
These are found under <code class="docutils literal notranslate"><span class="pre">$WECSIM/functions/writeH5/</span></code>.
The header comments of each function explain the inputs and outputs.
An example of how to use <code class="docutils literal notranslate"><span class="pre">write_hdf5</span></code>  is provided in the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.
The first step is to have all the required coefficients and properties in Matlab in the correct format.
Then the functions provided are used to create and populate the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file.</p>
</div>
</div>
<div class="section" id="simulation-features">
<h2>Simulation Features<a class="headerlink" href="#simulation-features" title="Permalink to this headline">¶</a></h2>
<p>This section provides an overview of WEC-Sim’s simulation class features; for more information about the simulation class code structure, refer to <a class="reference internal" href="code_structure.html#simulation-class"><span class="std std-ref">Simulation Class</span></a>.</p>
<div class="section" id="multiple-condition-runs-mcr">
<span id="mcr"></span><h3>Multiple Condition Runs (MCR)<a class="headerlink" href="#multiple-condition-runs-mcr" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim allows users to easily perform batch runs by typing <code class="docutils literal notranslate"><span class="pre">wecSimMCR</span></code> into the MATLAB Command Window. This command executes the Multiple Condition Run (MCR) option, which can be initiated three different ways:</p>
<blockquote>
<div><p><strong>Option 1.</strong> Specify a range of sea states and PTO damping coefficients in the WEC-Sim input file, example:
<code class="docutils literal notranslate"><span class="pre">waves.H</span> <span class="pre">=</span> <span class="pre">1:0.5:5;</span> <span class="pre">waves.T</span> <span class="pre">=</span> <span class="pre">5:1:15;</span></code>
<code class="docutils literal notranslate"><span class="pre">pto(1).k=1000:1000:10000;</span> <span class="pre">pto(1).c=1200000:1200000:3600000;</span></code></p>
<p><strong>Option 2.</strong>  Specify the excel filename that contains a set of wave statistic data in the WEC-Sim input file. This option is generally useful for power matrix generation, example:
<code class="docutils literal notranslate"><span class="pre">waves.statisticsDataLoad</span> <span class="pre">=</span> <span class="pre">&quot;&lt;Excel</span> <span class="pre">file</span> <span class="pre">name&gt;.xls&quot;</span></code></p>
<p><strong>Option 3.</strong>  Provide a MCR case <em>.mat</em> file, and specify the filename in the WEC-Sim input file, example:
<code class="docutils literal notranslate"><span class="pre">simu.mcrCaseFile</span> <span class="pre">=</span> <span class="pre">&quot;&lt;File</span> <span class="pre">name&gt;.mat&quot;</span></code></p>
</div></blockquote>
<p>For Multiple Condition Runs, the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> hydrodynamic data is only loaded once. To reload the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> data between runs,  set <code class="docutils literal notranslate"><span class="pre">simu.reloadH5Data</span> <span class="pre">=1</span></code> in the WEC-Sim input file.</p>
<p>The <strong>RM3_MCR</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository demonstrate the use of WEC-Sim MCR for each option above (arrays, .xls, .mat). The fourth case demonstrates how to vary the wave spectrum input file in each case run by WEC-Sim MCR.</p>
<p>The directory of an MCR case can contain a <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code> file that will function as the standard <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctions.m</span></code> file. Within the MCR application, the <code class="code docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code> script creates a power matrix from the PTO damping coefficient after all cases have been run.</p>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar1"><span class="std std-ref">Webinar 1 - BEMIO and MCR</span></a>,</p>
</div>
<div class="section" id="parallel-computing-toolbox-pct">
<h3>Parallel Computing Toolbox (PCT)<a class="headerlink" href="#parallel-computing-toolbox-pct" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim allows users to execute batch runs by typing <code class="docutils literal notranslate"><span class="pre">wecSimPCT</span></code> into the MATLAB Command Window. This command executes the MATLAB <a class="reference external" href="https://www.mathworks.com/products/parallel-computing.html">Parallel Computing Toolbox</a> (PCT), which allows parallel capability for <a class="reference internal" href="#mcr"><span class="std std-ref">Multiple Condition Runs (MCR)</span></a> but adds an additional MATLAB dependency to use this feature. Similar to MCR, this feature can be executed in three ways (Options 1~3).</p>
<p>For PCT runs, the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> hydrodynamic data must be reload, regardless the setting for <code class="docutils literal notranslate"><span class="pre">simu.reloadH5Data</span></code> in the WEC-Sim input file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">userDefinedFunctionsMCR.m</span></code> is not compatible with <code class="docutils literal notranslate"><span class="pre">wecSimPCT</span></code>. Please use <code class="docutils literal notranslate"><span class="pre">userDefinedFunctions.m</span></code> instead.</p>
</div>
</div>
<div class="section" id="state-space-representation">
<h3>State-Space Representation<a class="headerlink" href="#state-space-representation" title="Permalink to this headline">¶</a></h3>
<p>The convolution integral term in the equation of motion can be linearized using the state-space representation as described in the <a class="reference internal" href="theory.html#theory"><span class="std std-ref">Theory</span></a> section. To use a state-space representation, the <code class="docutils literal notranslate"><span class="pre">simu.ssCalc</span></code> simulationClass variable must be defined in the WEC-Sim input file, for example:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">simu.ssCalc</span> <span class="pre">=</span> <span class="pre">1</span></code></div></blockquote>
</div>
<div class="section" id="time-step-features">
<h3>Time-Step Features<a class="headerlink" href="#time-step-features" title="Permalink to this headline">¶</a></h3>
<p>The default WEC-Sim solver is ‘ode4’. Refer to the <strong>NonlinearHydro</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository for a comparisons between ‘ode4’ to <a class="reference external" href="https://www.mathworks.com/help/matlab/ref/ode45.html">‘ode45’</a>. The following variables may be changed in the simulationClass (where N is number of increment steps, default: N=1):</p>
<ul class="simple">
<li>Fixed time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code></li>
<li>Output time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dtOut=N*simu.dt</span></code></li>
<li>Nonlinear Buoyancy and Froude-Krylov Excitation time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dtNL=N*simu.dt</span></code></li>
<li>Convolution integral time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dtCITime=N*simu.dt</span></code></li>
<li>Morison force time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dtME</span> <span class="pre">=</span> <span class="pre">N*simu.dt</span></code></li>
</ul>
<div class="section" id="fixed-time-step-ode4">
<h4>Fixed Time-Step (ode4)<a class="headerlink" href="#fixed-time-step-ode4" title="Permalink to this headline">¶</a></h4>
<p>When running WEC-Sim with a fixed time-step, 100-200 time-steps per wave period is recommended to provide accurate hydrodynamic force calculations (ex: simu.dt = T/100, where T is wave period). However, a smaller time-step may be required (such as when coupling WEC-Sim with MoorDyn or PTO-Sim). To reduce the required WEC-Sim simulation time, a different time-step  may be specified for nonlinear buoyancy and Froude-Krylov excitation and for convolution integral calculations. For all simulations, the time-step should be chosen based on numerical stability and a convergence study should be performed.</p>
</div>
<div class="section" id="variable-time-step-ode45">
<h4>Variable Time-Step (ode45)<a class="headerlink" href="#variable-time-step-ode45" title="Permalink to this headline">¶</a></h4>
<p>To run WEC-Sim with a variable time-step, the following variables must be defined in the simulationClass:</p>
<ul class="simple">
<li>Numerical solver: <code class="code docutils literal notranslate"><span class="pre">simu.solver='ode45'</span></code></li>
<li>Max time-step: <code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code></li>
</ul>
<p>This option sets the maximum time step of the simulation (<code class="code docutils literal notranslate"><span class="pre">simu.dt</span></code>) and automatically adjusts the instantaneous time step to that required by MATLAB’s differential equation solver.</p>
</div>
</div>
</div>
<div class="section" id="wave-features">
<h2>Wave Features<a class="headerlink" href="#wave-features" title="Permalink to this headline">¶</a></h2>
<p>This section provides an overview of WEC-Sim’s wave class features. For more information about the wave class code structure, refer to <a class="reference internal" href="code_structure.html#wave-class"><span class="std std-ref">Wave Class</span></a>. The various wave features can be compared by running the cases within <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">WEC-Sim/Examples/RM3</span></code> and <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">WEC-Sim/Examples/OSWEC</span></code> directories.</p>
<div class="section" id="irregular-wave-binning">
<h3>Irregular Wave Binning<a class="headerlink" href="#irregular-wave-binning" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim’s default spectral binning method divides the wave spectrum into 499 bins with equal energy content, defined by 500 wave frequencies. As a result, the wave forces on the WEC using the equal energy method are only computed at each of the 500 wave frequencies. The equal energy formulation speeds up the irregular wave simulation time by reducing the number of frequencies the wave train is defined by, and thus the number of frequencies for which the wave forces are calculated. It prevents bins with very little energy from being created and unnecessarily adding to the computational cost. The equal energy method is specified by defining the following wave class variable in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.freqDisc</span> <span class="pre">=</span> <span class="pre">'EqualEnergy';</span></code></div></blockquote>
<p>By comparison, the traditional method divides the wave spectrum into a sufficiently large number of equally spaced bins to define the wave spectrum. WEC-Sim’s traditional formulation uses 999 bins, defined by 1000 wave frequencies of equal frequency distribution. To override WEC-Sim’s default equal energy method, and instead use the traditional binning method, the following wave class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.freqDisc</span> <span class="pre">=</span> <span class="pre">'Traditional';</span></code></div></blockquote>
<p>Users may override the default number of wave frequencies by defining <code class="docutils literal notranslate"><span class="pre">waves.numFreq</span></code>.  However, it is on the user to ensure that the wave spectrum is adequately defined by the number of wave frequencies, and that the wave forces are not impacted by this change.</p>
</div>
<div class="section" id="wave-directionality">
<h3>Wave Directionality<a class="headerlink" href="#wave-directionality" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim has the ability to model waves with various angles of incidence, <span class="math notranslate nohighlight">\(\theta\)</span>. To define wave directionality in WEC-Sim, the following wave class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.waveDir</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">wave</span> <span class="pre">direction(s)&gt;;</span> <span class="pre">%[deg]</span></code></div></blockquote>
<p>The incident wave direction has a default heading of 0 Degrees (Default = 0), and should be defined as a column vector for more than one wave direction. For more information about the wave formulation, refer to <a class="reference internal" href="theory.html#wave-spectra"><span class="std std-ref">Wave Spectra</span></a>.</p>
</div>
<div class="section" id="wave-directional-spreading">
<h3>Wave Directional Spreading<a class="headerlink" href="#wave-directional-spreading" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim has the ability to model waves with directional spreading, <span class="math notranslate nohighlight">\(D\left( \theta \right)\)</span>. To define wave directional spreading in WEC-Sim, the following wave class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.waveSpread</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">directional</span> <span class="pre">spreading&gt;;</span></code></div></blockquote>
<p>The wave directional spreading has a default value of 1 (Default = 1), and should be defined as a column vector of directional spreading for each one wave direction. For more information about the spectral formulation, refer to <a class="reference internal" href="theory.html#wave-spectra"><span class="std std-ref">Wave Spectra</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Users must define appropriate spreading parameters to ensure energy is conserved. Recommended directional spreading functions include Cosine-Squared and Cosine-2s.</p>
</div>
</div>
<div class="section" id="irregular-waves-with-seeded-phase">
<span id="seeded-phase"></span><h3>Irregular Waves with Seeded Phase<a class="headerlink" href="#irregular-waves-with-seeded-phase" title="Permalink to this headline">¶</a></h3>
<p>By default, the phase for all irregular wave cases are generated randomly. In order to reproduce the same time-series every time an irregular wave simulation is run, the following wave class variable may be defined in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.phaseSeed</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">seed&gt;;</span></code></div></blockquote>
<p>By setting <code class="docutils literal notranslate"><span class="pre">waves.phaseSeed</span></code>  equal to 1,2,3,…,etc, the random wave phase generated by WEC-Sim is seeded, thus producing the same random phase for each simulation.</p>
</div>
<div class="section" id="wave-gauge-placement">
<h3>Wave Gauge Placement<a class="headerlink" href="#wave-gauge-placement" title="Permalink to this headline">¶</a></h3>
<p>By default, the wave surface elevation is calculated at the origin. Users are allowed up to 3 other x-locations to calculate the wave surface elevation offset from the origin in the global x-direction by defining the wave class variable, <code class="docutils literal notranslate"><span class="pre">waves.wavegauge&lt;i&gt;loc</span></code>, in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.wavegauge&lt;i&gt;loc</span> <span class="pre">=</span> <span class="pre">&lt;user</span> <span class="pre">defined</span> <span class="pre">wave</span> <span class="pre">gauge</span> <span class="pre">i</span> <span class="pre">x-location&gt;;</span> <span class="pre">%(y-position</span> <span class="pre">assumed</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">0</span> <span class="pre">m)</span></code></div></blockquote>
<p>where i = 1, 2, or 3</p>
<p>The WEC-Sim numerical wave gauges output the undisturbed linear incident wave elevation at the wave gauge locations defined above. The numerical wave gauges do not handle the incident wave interaction with the radiated or diffracted waves that are generated because of the presence and motion of the WEC hydrodynamic bodies. This option provides the following wave elevation time series:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">waves.waveAmpTime&lt;i&gt;</span> <span class="pre">=</span> <span class="pre">incident</span> <span class="pre">wave</span> <span class="pre">elevation</span> <span class="pre">time</span> <span class="pre">series</span> <span class="pre">at</span> <span class="pre">wave</span> <span class="pre">gauge</span> <span class="pre">i</span></code></div></blockquote>
</div>
</div>
<div class="section" id="body-features">
<h2>Body Features<a class="headerlink" href="#body-features" title="Permalink to this headline">¶</a></h2>
<p>This section provides an overview of WEC-Sim’s body class features; for more information about the body class code structure, refer to <a class="reference internal" href="code_structure.html#body-class"><span class="std std-ref">Body Class</span></a>.</p>
<div class="section" id="body-mass-and-geometry-features">
<h3>Body Mass and Geometry Features<a class="headerlink" href="#body-mass-and-geometry-features" title="Permalink to this headline">¶</a></h3>
<p>The mass of each body must be specified in the  WEC-Sim input file. The following features are available:</p>
<ul class="simple">
<li><strong>Floating Body</strong> - the user may set <code class="code docutils literal notranslate"><span class="pre">body(i).mass</span> <span class="pre">=</span> <span class="pre">'equilibrium'</span></code> which will calculate the body mass based on displaced volume and water density. If <code class="code docutils literal notranslate"><span class="pre">simu.nlhydro</span> <span class="pre">=</span> <span class="pre">0</span></code>, then the mass is calculated using the displaced volume contained in the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file. If <code class="code docutils literal notranslate"><span class="pre">simu.nlhydro</span> <span class="pre">=</span> <span class="pre">1</span></code> or <code class="code docutils literal notranslate"><span class="pre">simu.nlhydro</span> <span class="pre">=</span> <span class="pre">2</span></code>, then the mass is calculated using the displaced volume of the provided STL geometry file.</li>
<li><strong>Fixed Body</strong> - if the mass is unknown (or not important to the dynamics), the user may specify <code class="code docutils literal notranslate"><span class="pre">body(i).mass</span> <span class="pre">=</span> <span class="pre">'fixed'</span></code> which will set the mass to 999 kg and moment of inertia to [999 999 999] kg-m^2.</li>
<li><strong>Import STL</strong> - to read in the geometry (<code class="docutils literal notranslate"><span class="pre">*.stl</span></code>) into Matlab use the <code class="code docutils literal notranslate"><span class="pre">body(i).bodyGeo</span></code> method in the bodyClass. This method will import the mesh details (vertices, faces, normals, areas, centroids) into the <code class="code docutils literal notranslate"><span class="pre">body(i).bodyGeometry</span></code> property. This method is also used for nonlinear buoyancy and Froude-Krylov excitation and ParaView visualization files. Users can then visualize the geometry using the <code class="code docutils literal notranslate"><span class="pre">body(i).plotStl</span></code> method.</li>
</ul>
</div>
<div class="section" id="nonlinear-buoyancy-and-froude-krylov-excitation">
<span id="nonlinear"></span><h3>Nonlinear Buoyancy and Froude-Krylov Excitation<a class="headerlink" href="#nonlinear-buoyancy-and-froude-krylov-excitation" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim has the option to include the nonlinear hydrostatic restoring and Froude-Krylov forces when solving the system dynamics of WECs, accounting for the weakly nonlinear effect on the body hydrodynamics. To use nonlinear buoyancy and Froude-Krylov excitation, the <strong>simu.nlHydro</strong> simulationClass variable must be defined in the WEC-Sim input file, for example:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">simu.nlHydro</span> <span class="pre">=</span> <span class="pre">2</span></code></div></blockquote>
<p>For more information, refer to the <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Webinar 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation, Non-Hydro and B2B</span></a>, and the <strong>NonlinearHydro</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<div class="section" id="nonlinear-settings">
<h4>Nonlinear Settings<a class="headerlink" href="#nonlinear-settings" title="Permalink to this headline">¶</a></h4>
<p><strong>simu.nlHydro</strong>  -
The nonlinear hydrodynamics option can be used with the parameter: <code class="code docutils literal notranslate"><span class="pre">simu.nlHydro</span></code> in your WEC-Sim input file. When any of the three nonlinear options (below) are used, WEC-Sim integrates the wave pressure over the surface of the body, resulting in more accurate buoyancy and Froude-Krylov force calculations.</p>
<blockquote>
<div><p><strong>Option 1.</strong> <code class="code docutils literal notranslate"><span class="pre">simu.nlHydro</span> <span class="pre">=</span> <span class="pre">1</span></code> This option integrates the pressure due to the mean wave elevation and the instantaneous body position.</p>
<p><strong>Option 2.</strong> <code class="code docutils literal notranslate"><span class="pre">simu.nlHydro</span> <span class="pre">=</span> <span class="pre">2</span></code> This option integrates the pressure due to the instantaneous wave elevation and the instantaneous body position. This option is recommended if nonlinear effects need to be considered.</p>
<p><strong>Option 3.</strong> <code class="code docutils literal notranslate"><span class="pre">simu.nlHydro</span> <span class="pre">=</span> <span class="pre">3</span></code> This option calculates the nonlinear Froude-Krylov force directly from a BEM result. This requires additional output files from the BEM code (.3fk and .3sc files for WAMIT, and DiffractionForce.tec and FKForce.tec files for NEMOH).</p>
</div></blockquote>
<p><strong>simu.dtNL</strong> -
An option available to reduce the nonlinear simulation time is to specify a nonlinear time step, <code class="code docutils literal notranslate"><span class="pre">simu.dtNL=N*simu.dt</span></code>, where N is number of increment steps. The nonlinear time step specifies the interval at which the nonlinear hydrodynamic forces are calculated. As the ratio of the nonlinear to system time step increases, the computation time is reduced, again, at the expense of the simulation accuracy.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">WEC-Sim’s nonlinear buoyancy and Froude-Krylov wave excitation option may be used for regular or irregular waves but not with user-defined irregular waves.</p>
</div>
</div>
<div class="section" id="stl-file-generation">
<h4>STL File Generation<a class="headerlink" href="#stl-file-generation" title="Permalink to this headline">¶</a></h4>
<p>When the nonlinear option is turned on, the geometry file (<code class="docutils literal notranslate"><span class="pre">*.stl</span></code>) (previously only used for visualization purposes in linear simulations) is used as the discretized body surface on which the nonlinear pressure forces are integrated. A good STL mesh resolution is required for the WEC body geometry file(s) when using the nonlinear buoyancy and Froude-Krylov wave excitation in WEC-Sim. The simulation accuracy will increase with increased surface resolution (i.e. the number of discretized surface panels specified in the <code class="docutils literal notranslate"><span class="pre">*.stl</span></code> file), but the computation time will also increase.</p>
<p>There are many ways to generate an STL file; however, it is important to verify the quality of the mesh before running WEC-Sim simulations with the nonlinear hydro flag turned on. An STL file can be exported from most CAD programs, but few allow adequate mesh refinement. A good program to perform STL mesh refinement is <a class="reference external" href="https://www.rhino3d.com/">Rhino</a>. Some helpful resources explaining how to generate and refine an STL mesh in Rhino can be found <a class="reference external" href="https://wiki.mcneel.com/rhino/meshfaqdetails">on Rhino’s website</a> and <a class="reference external" href="https://www.youtube.com/watch?v=CrlXAMPfHWI">on Youtube</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All STL files must be saved as ASCII (not binary)</p>
</div>
<p><strong>Refining STL File</strong> - The script <code class="docutils literal notranslate"><span class="pre">refine_stl</span></code> in the BEMIO directory performs a simple mesh refinement on an <code class="docutils literal notranslate"><span class="pre">*.stl</span></code> file by subdividing each panel with an area above the specified threshold into four smaller panels with new vertices at the mid-points of the original panel edges. This procedure is iterated for each panel until all panels have an area below the specified threshold, as in the example rectangle.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/rectangles.png"><img alt="../_images/rectangles.png" src="../_images/rectangles.png" style="width: 300pt;" /></a>
</div>
<p>In this way, the each new panel retains the aspect ratio of the original panel. Note that the linear discretization of curved edges is not refined via this algorithm. The header comments of the function explain the inputs and outputs. This function calls <code class="docutils literal notranslate"><span class="pre">import_stl_fast</span></code>, included with the WEC-Sim distribution, to import the <code class="docutils literal notranslate"><span class="pre">.*stl</span></code> file.</p>
</div>
<div class="section" id="nonlinear-buoyancy-and-froude-krylov-wave-excitation-tutorial-heaving-ellipsoid">
<h4>Nonlinear Buoyancy and Froude-Krylov Wave Excitation Tutorial - Heaving Ellipsoid<a class="headerlink" href="#nonlinear-buoyancy-and-froude-krylov-wave-excitation-tutorial-heaving-ellipsoid" title="Permalink to this headline">¶</a></h4>
<p>The body tested in the study is an ellipsoid with a cross- section characterized by semi-major and -minor axes of 5.0 m and 2.5 m in the wave propagation and normal directions, respectively . The ellipsoid is at its equilibrium position with its origin located at the mean water surface. The mass of the body is then set to 1.342×105 kg, and the center of gravity is located 2 m below the origin.</p>
<div class="figure align-center" id="nonlinearellipsoid">
<a class="reference internal image-reference" href="../_images/nonlinearEllipsoid.png"><img alt="../_images/nonlinearEllipsoid.png" src="../_images/nonlinearEllipsoid.png" style="width: 350pt;" /></a>
</div>
<p>STL file with the discretized body surface is shown below (<code class="docutils literal notranslate"><span class="pre">ellipsoid.stl</span></code>)</p>
<div class="figure align-center" id="nonlinearmesh">
<a class="reference internal image-reference" href="../_images/nonlinearMesh.png"><img alt="../_images/nonlinearMesh.png" src="../_images/nonlinearMesh.png" style="width: 250pt;" /></a>
</div>
<p>The single-body heave only WEC model is shown below (<code class="docutils literal notranslate"><span class="pre">nonLinearHydro.slx</span></code>)</p>
<div class="figure align-center" id="nonlinearwec">
<a class="reference internal image-reference" href="../_images/nonlinearWEC.png"><img alt="../_images/nonlinearWEC.png" src="../_images/nonlinearWEC.png" style="width: 450pt;" /></a>
</div>
<p>The WEC-Sim input file used to run the nonlinear hydro WEC-Sim simulation:</p>
<div class="highlight-matlab notranslate" id="nonlinearwecsiminputfile"><div class="highlight"><pre><span></span><span class="c">%% Simulation Data</span>
<span class="n">simu</span> <span class="p">=</span> <span class="n">simulationClass</span><span class="p">();</span>               
<span class="n">simu</span><span class="p">.</span><span class="n">simMechanicsFile</span> <span class="p">=</span> <span class="s">&#39;ellipsoid.slx&#39;</span><span class="p">;</span>   
<span class="n">simu</span><span class="p">.</span><span class="n">mode</span> <span class="p">=</span> <span class="s">&#39;normal&#39;</span><span class="p">;</span>                   <span class="c">% Specify Simulation Mode (&#39;normal&#39;,&#39;accelerator&#39;,&#39;rapid-accelerator&#39;)</span>
<span class="n">simu</span><span class="p">.</span><span class="n">explorer</span><span class="p">=</span><span class="s">&#39;off&#39;</span><span class="p">;</span>                     <span class="c">% Turn SimMechanics Explorer (on/off)</span>
<span class="n">simu</span><span class="p">.</span><span class="n">startTime</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>                     
<span class="n">simu</span><span class="p">.</span><span class="n">rampTime</span> <span class="p">=</span> <span class="mi">50</span><span class="p">;</span>                        
<span class="n">simu</span><span class="p">.</span><span class="n">endTime</span><span class="p">=</span><span class="mi">150</span><span class="p">;</span>                       
<span class="n">simu</span><span class="p">.</span><span class="n">dt</span> <span class="p">=</span> <span class="mf">0.05</span><span class="p">;</span>                         
<span class="n">simu</span><span class="p">.</span><span class="n">rho</span><span class="p">=</span><span class="mi">1025</span><span class="p">;</span>                                                                                                           
<span class="n">simu</span><span class="p">.</span><span class="n">nlHydro</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>                       <span class="c">% Non-linear hydro on/off</span>

<span class="c">%% Wave Information</span>
<span class="c">% Regular Waves </span>
<span class="n">waves</span> <span class="p">=</span> <span class="n">waveClass</span><span class="p">(</span><span class="s">&#39;regular&#39;</span><span class="p">);</span>                 
<span class="n">waves</span><span class="p">.</span><span class="n">H</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>                            
<span class="n">waves</span><span class="p">.</span><span class="n">T</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span>   

<span class="c">%% Body Data</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../../hydroData/ellipsoid.h5&#39;</span><span class="p">);</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">mass</span> <span class="p">=</span> <span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>           
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">momOfInertia</span> <span class="p">=</span> <span class="k">...</span><span class="c">              </span>
    <span class="p">[</span><span class="mf">1.375264e6</span> <span class="mf">1.375264e6</span> <span class="mf">1.341721e6</span><span class="p">];</span>      
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">geometryFile</span> <span class="p">=</span> <span class="s">&#39;../../geometry/elipsoid.stl&#39;</span> <span class="p">;</span>    
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">viscDrag</span><span class="p">.</span><span class="n">cd</span><span class="p">=[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">];</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">viscDrag</span><span class="p">.</span><span class="n">characteristicArea</span><span class="p">=[</span><span class="mi">25</span> <span class="mi">0</span> <span class="nb">pi</span><span class="o">*</span><span class="mi">5</span>^<span class="mi">2</span> <span class="mi">0</span> <span class="nb">pi</span><span class="o">*</span><span class="mi">5</span>^<span class="mi">5</span> <span class="mi">0</span><span class="p">];</span>

<span class="c">%% PTO and Constraint Parameters</span>
<span class="c">% Fixed Constraint</span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">constraintClass</span><span class="p">(</span><span class="s">&#39;Constraint1&#39;</span><span class="p">);</span> 
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">loc</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">12.5</span><span class="p">];</span>        

<span class="c">% Translational PTO</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">ptoClass</span><span class="p">(</span><span class="s">&#39;PTO1&#39;</span><span class="p">);</span>              
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">k</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>                             
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">c</span><span class="p">=</span><span class="mi">1200000</span><span class="p">;</span>                      
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">loc</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">12.5</span><span class="p">];</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">loc</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">12.5</span><span class="p">];</span>
</pre></div>
</div>
<p>Simulation and post-processing is the same process as described in <a class="reference internal" href="tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a> section.</p>
</div>
</div>
<div class="section" id="passive-yaw-implementation">
<h3>Passive Yaw Implementation<a class="headerlink" href="#passive-yaw-implementation" title="Permalink to this headline">¶</a></h3>
<p>For non-axisymmetric bodies with yaw orientation that changes substantially with time, WEC-Sim allows a correction to excitation forces for large yaw displacements. To enable this correction, add the following to your <code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code>:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">simu.yawNonLin</span> <span class="pre">=</span> <span class="pre">1</span></code></div></blockquote>
<p>Under the default implementation (<code class="code docutils literal notranslate"><span class="pre">simu.yawNonLin</span> <span class="pre">=</span> <span class="pre">0</span></code>), WEC-Sim uses the initial yaw orientation of the device relative to the incident waves to calculate the wave excitation coefficients that will be used for the duration of the simulation. When the correction is enabled, excitation coefficients are interpolated from BEM data based upon the instantaneous relative yaw position. For this to enhance simulation accuracy, BEM data must be available over the range of observed yaw positions at a sufficiently dense discretization to capture the significant variations of excitation coefficients with yaw position. For robust simulation, BEM data should be available from -180 to 170 degrees of yaw (or equivalent).</p>
<p>This can increase simulation time, especially for irregular waves, due to the large number of interpolations that must occur. To prevent interpolation at every time-step, <code class="docutils literal notranslate"><span class="pre">simu.yawThresh</span></code> (default 1 degree) can be specified in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code> to specify the minimum yaw displacement (in degrees) that must occur before another interpolation of excitation coefficients will be calculated. The minimum threshold for good simulation accuracy will be device specific: if it is too large, no interpolation will occur and the simulation will behave as <code class="code docutils literal notranslate"><span class="pre">simu.yawNonLin</span> <span class="pre">=</span> <span class="pre">0</span></code>, but overly small values may not significantly enhance simulation accuracy while increasing simulation time.</p>
<p>When <code class="code docutils literal notranslate"><span class="pre">simu.yawNonLin</span> <span class="pre">=</span> <span class="pre">1</span></code>, hydrostatic and radiation forces are determined from the local body-fixed coordinate system based upon the instantaneous relative yaw position of the body, as this may differ substantially from the global coordinate system for large relative yaw values.</p>
<p>A demonstration case of this feature is included in the <strong>PassiveYaw</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Caution must be exercised when simultaneously using passive yaw and body-to-body interactions. Passive yaw relies on interpolated BEM solutions to determine the cross-coupling coefficients used in body-to-body calculations. Because these BEM solutions are based upon the assumption of small displacements, they are unlikely to be accurate if a large relative yaw displacement occurs between the bodies.</p>
</div>
</div>
<div class="section" id="non-hydrodynamic-bodies">
<h3>Non-Hydrodynamic Bodies<a class="headerlink" href="#non-hydrodynamic-bodies" title="Permalink to this headline">¶</a></h3>
<p>For some simulations, it might be important to model bodies that do not have hydrodynamic forces acting on them. This could be bodies that are completely outside of the water but are still connected through a joint to the WEC bodies, or it could be bodies deeply submerged to the point where the hydrodynamics may be neglected. WEC-Sim allows for bodies which have no hydrodynamic forces acting on them and for which no BEM data is provided.</p>
<p>To do this, use a Body Block from the WEC-Sim  Library and initialize it in the WEC-Sim input file as any other body but leave the name of the <code class="docutils literal notranslate"><span class="pre">h5</span></code> file as an empty string. Specify <code class="code docutils literal notranslate"><span class="pre">body(i).nhBody</span> <span class="pre">=</span> <span class="pre">1;</span></code> and specify body name, mass, moments of inertia, center of gravity, center of buoyancy, geometry file, location, and displaced volume. You can also specify visualization options and initial displacement.</p>
<p>To use non-hydrodynamic bodies, the following body class variable must be defined in the WEC-Sim input file, for example:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">body(i).nhBody</span> <span class="pre">=</span> <span class="pre">1</span></code></div></blockquote>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Webinar 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation, Non-Hydro and B2B</span></a>, and the <strong>OSWEC_nhBody</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
</div>
<div class="section" id="body-to-body-interactions">
<h3>Body-To-Body Interactions<a class="headerlink" href="#body-to-body-interactions" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim allows for body-to-body interactions in the radiation force calculation, thus allowing the motion of one body to impart a force on all other bodies. The radiation matrices for each body (radiation wave damping and added mass) required by WEC-Sim and contained in the <code class="docutils literal notranslate"><span class="pre">*.h5</span></code> file. <strong>For body-to-body interactions with N total hydrodynamic bodies, the</strong> <code class="docutils literal notranslate"><span class="pre">*h5</span></code> <strong>data structure is [(6*N), 6]</strong>.</p>
<p>When body-to-body interactions are used, the augmented [(6*N), 6] matrices are multiplied by concatenated velocity and acceleration vectors of all hydrodynamic bodies. For example, the radiation damping force for body(2) in a 3-body system with body-to-body interactions would be calculated as the product of a [1,18] velocity vector and a [18,6] radiation damping coefficients matrix.</p>
<p>To use body-to-body interactions, the following simulation class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">simu.b2b</span> <span class="pre">=</span> <span class="pre">1</span></code></div></blockquote>
<p>For more information, refer to <a class="reference internal" href="webinars.html#webinar2"><span class="std std-ref">Webinar 2 - Nonlinear Buoyancy and Froude-Krylov Wave Excitation, Non-Hydro and B2B</span></a>, and the <strong>RM3_B2B</strong> example in the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, body-to-body interactions  are off (<code class="code docutils literal notranslate"><span class="pre">simu.b2b</span> <span class="pre">=</span> <span class="pre">0</span></code>), and only the <span class="math notranslate nohighlight">\([1+6(i-1):6i, 1+6(i-1):6i]\)</span> sub-matrices are used for each body (where <span class="math notranslate nohighlight">\(i\)</span> is the body number).</p>
</div>
</div>
<div class="section" id="generalized-body-modes">
<h3>Generalized Body Modes<a class="headerlink" href="#generalized-body-modes" title="Permalink to this headline">¶</a></h3>
<p>To use this, select a Flex Body Block from the WEC-Sim Library (under Body Elements) and initialize it in the WEC-Sim input file as any other body. Calculating dynamic response of WECs considering structural flexibilities using WEC-Sim should consist of multiple steps, including:</p>
<ul class="simple">
<li>Modal analysis of the studied WEC to identify a set of system natural frequencies and corresponding mode shapes</li>
<li>Construct discretized mass and impedance matrices using these structural modes</li>
<li>Include these additional flexible degrees of freedom in the BEM code to calculate hydrodynamic coefficients for the WEC device</li>
<li>Import the hydrodynamic coefficients to WEC-Sim and conduct dynamic analysis of the hybrid rigid and flexible body system</li>
</ul>
<p>The <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a> contains a working sample of a barge with four additional degrees of freedom to account for bending and shearing of the body. See this example for details on how to implement and use generalized body modes in WEC-Sim.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generalized body modes module has only been tested with WAMIT, where BEMIO may need to be modified for NEMOH.</p>
</div>
</div>
<div class="section" id="viscous-damping-and-morison-elements">
<h3>Viscous Damping and Morison Elements<a class="headerlink" href="#viscous-damping-and-morison-elements" title="Permalink to this headline">¶</a></h3>
<p>WEC-Sim allows for the definition of additional damping and added-mass terms; for more information about the numerical formulation of viscous damping and Morison Elements, refer to <a class="reference internal" href="theory.html#viscous-damping-and-morison-elements"><span class="std std-ref">Viscous Damping and Morison Elements</span></a>.</p>
<div class="section" id="viscous-damping">
<h4>Viscous Damping<a class="headerlink" href="#viscous-damping" title="Permalink to this headline">¶</a></h4>
<p>A viscous damping force in the form of a linear damping coefficient <span class="math notranslate nohighlight">\(C_{v}\)</span> can be applied to each body by defining the following body class parameter in the WEC-Sim input file (which has a default value of zero):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">linearDamping</span>
</pre></div>
</div>
<p>A quadratic drag force, proportional to the square of the body’s velocity, can be applied to each body by defining the quadratic drag coefficient <span class="math notranslate nohighlight">\(C_{d}\)</span>, and the characteristic area <span class="math notranslate nohighlight">\(A_{d}\)</span> for drag calculation. This is achieved by defining the following body class parameters in the WEC-Sim input file (each of which have a default value of zero):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">cd</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">characteristicArea</span>
</pre></div>
</div>
<p>Alternatively, one can define <span class="math notranslate nohighlight">\(C_{D}\)</span> directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">Drag</span>
</pre></div>
</div>
</div>
<div class="section" id="morison-elements">
<span id="morison"></span><h4>Morison Elements<a class="headerlink" href="#morison-elements" title="Permalink to this headline">¶</a></h4>
<p>To use Morison Elements, the following simulation class variable must be defined in the WEC-Sim input file:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">simu.morisonElement</span>&#160; <span class="pre">=</span> <span class="pre">1</span></code></p>
<p>or</p>
<p><code class="code docutils literal notranslate"><span class="pre">simu.morisonElement</span>&#160; <span class="pre">=</span> <span class="pre">2</span></code></p>
</div></blockquote>
<p>Implementation Option 1 allows for the Morison Element properties to be defined independently for the x-, y-, and z-axis while implementation option 2 uses a normal and tangential representation of the Morison Element properties. Note that the two options allow the user flexibility to implement hydrodynamic forcing that best suits their modeling needs; however, the two options have slightly different calculation methods and therefore the outputs will not necessarily provide the same forcing values. The user is directed to look at the Simulink Morison Element block within the WEC-Sim library to better determine which approach better suits their modeling requirements.</p>
<p>Morison Elements must be defined for each body using the <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement</span></code> property of the body class. This property requires definition of the following body class parameters in the WEC-Sim input file (each of which have a default value of zero(s)). For <code class="code docutils literal notranslate"><span class="pre">simu.morisonElement</span>&#160; <span class="pre">=</span> <span class="pre">1</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">dx</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dy</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">ax</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">ay</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">az</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">characteristicArea</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_</span><span class="p">{</span><span class="n">x</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">y</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">z</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span> <span class="o">=</span> <span class="p">[</span><span class="n">V_</span><span class="p">{</span><span class="n">me</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_</span><span class="p">{</span><span class="n">gx</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gy</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Please note that for option 1, the unit normal <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.z</span></code> must be initialized as a [1x3] vector although it will not be used in the hydrodynamic calculation. For <code class="code docutils literal notranslate"><span class="pre">simu.morisonElement</span>&#160; <span class="pre">=</span> <span class="pre">2</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">dn</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">dt</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_</span><span class="p">{</span><span class="n">an</span><span class="p">}</span> <span class="n">c_</span><span class="p">{</span><span class="n">at</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">characteristicArea</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_</span><span class="p">{</span><span class="n">n</span><span class="p">}</span> <span class="n">A_</span><span class="p">{</span><span class="n">t</span><span class="p">}</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span> <span class="o">=</span> <span class="p">[</span><span class="n">V_</span><span class="p">{</span><span class="n">me</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_</span><span class="p">{</span><span class="n">gx</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gy</span><span class="p">}</span> <span class="n">r_</span><span class="p">{</span><span class="n">gz</span><span class="p">}]</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_</span><span class="p">{</span><span class="n">x</span><span class="p">}</span> <span class="n">z_</span><span class="p">{</span><span class="n">y</span><span class="p">}</span> <span class="n">z_</span><span class="p">{</span><span class="n">z</span><span class="p">}]</span>
</pre></div>
</div>
<p>Please note that for option 2, the <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.cd</span></code>, <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.ca</span></code>, and <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.characteristicArea</span></code> variables need to be initialized as [1x3] vectors with the last index set to zero. While <code class="code docutils literal notranslate"><span class="pre">body(#).morisonElement.z</span></code> is a unit normal vector that defines the orientation of the Morison Element.</p>
<p>The Morison Element time-step may also be defined as <code class="code docutils literal notranslate"><span class="pre">simu.dtME</span> <span class="pre">=</span> <span class="pre">N*simu.dt</span></code>, where N is number of increment steps. For an example application of using Morison Elements in WEC-Sim, refer to the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository <strong>Free_Decay/1m-ME</strong> example.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Morison Elements cannot be used with <code class="code docutils literal notranslate"><span class="pre">etaImport</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="drag-body-implementation">
<h3>Drag Body Implementation<a class="headerlink" href="#drag-body-implementation" title="Permalink to this headline">¶</a></h3>
<p>A body may be subjected to viscous drag or Morison forces, but does not experience significant wave excitation or radiation. And example may be a deeply-submerged heave plate of large surface area tethered to a float. In these instances, the drag body implementation can be utilized by defining the following body class variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">nhBody</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Drag bodies have zero wave excitation or radiation forces, but viscous forces can be applied in the same manner as a hydrodynamic body via the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">Drag</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">cd</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">viscDrag</span><span class="o">.</span><span class="n">characteristicArea</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">linearDamping</span>
</pre></div>
</div>
<p>or if using Morison Elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">cd</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">ca</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">characteristicArea</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">VME</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">morisonElement</span><span class="o">.</span><span class="n">rgME</span>
</pre></div>
</div>
<p>which are described in more detail in the forthcoming section. At a minimum, it is necessary to define:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">mass</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">momOfInertia</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cg</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cb</span>
<span class="n">body</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">dispVol</span>
</pre></div>
</div>
<p>to resolve drag body dynamics. One can additionally describe initial body displacement in the manner of a hydrodynamic body.</p>
</div>
</div>
<div class="section" id="constraint-and-pto-features">
<span id="pto"></span><h2>Constraint and PTO Features<a class="headerlink" href="#constraint-and-pto-features" title="Permalink to this headline">¶</a></h2>
<p>This section provides an overview of  WEC-Sim’s constraint and PTO classes; for more information about the constraint and PTO classes’ code structure, refer to <a class="reference internal" href="code_structure.html#constraint-class"><span class="std std-ref">Constraint Class</span></a> and <a class="reference internal" href="code_structure.html#pto-class"><span class="std std-ref">PTO Class</span></a>.</p>
<div class="section" id="modifying-constraints-and-ptos">
<h3>Modifying Constraints and PTOs<a class="headerlink" href="#modifying-constraints-and-ptos" title="Permalink to this headline">¶</a></h3>
<p>The default linear and rotational constraints and PTOs allow for heave and pitch motions of the follower relative to the base.
To obtain a linear or rotational constraint in a different direction you must modify the constraint’s or PTO’s coordinate orientation.
The important thing to remember is that a linear constraint or PTO will always allow motion along the joint’s Z-axis, and a rotational constraint or PTO will allow rotation about the joint’s Y-axis.
To obtain translation along or rotation about a different direction relative to the global frame, you must modify the orientation of the joint’s coordinate frame.
This is done by setting the constraint’s or PTO’s <code class="code docutils literal notranslate"><span class="pre">orientation.z</span></code> and <code class="code docutils literal notranslate"><span class="pre">orientation.y</span></code> properties which specify the new direction of the Z- and Y- joint coordinates.
The Z- and Y- directions must be perpendicular to each other.</p>
<p>As an example, if you want to constrain body 2 to surge motion relative to body 1 using a linear constraint, you would need the constraint’s Z-axis to point in the direction of the global surge (X) direction.
This would be done by setting <code class="code docutils literal notranslate"><span class="pre">constraint(i).orientation.z=[1,0,0]</span></code> and the Y-direction to any perpendicular direction (can be left as the default y=[0 1 0]).
In this example, the Y-direction would only have an effect on the coordinate on which the constraint forces are reported but not on the dynamics of the system.
Similarly if you want to obtain a yaw constraint you would use a rotational constraint and align the constraint’s Y-axis with the global Z-axis.
This would be done by setting <code class="code docutils literal notranslate"><span class="pre">constraint(i).orientation.y=[0,0,1]</span></code> and the  z-direction to a perpendicular direction (say [0,-1,0]).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using the Actuation Force/Torque PTO or Actuation Motion PTO blocks, the loads and displacements are specified in the local (not global) coordinate system. This is true for both the sensed (measured) and actuated (commanded) loads and displacements.</p>
</div>
<p>Additionally, by combining constraints and PTOs in series you can obtain different motion constraints.
For example, a massless rigid rod between two bodies, hinged at each body, can be obtained by using a two rotational constraints in series, both rotating in pitch, but with different locations.
A roll-pitch constraint can also be obtained with two rotational constraints in series; one rotating in pitch, and the other in roll, and both at the same location.</p>
<div class="section" id="incorporating-joint-actuation-stroke-limits">
<h4>Incorporating Joint/Actuation Stroke Limits<a class="headerlink" href="#incorporating-joint-actuation-stroke-limits" title="Permalink to this headline">¶</a></h4>
<p>Beginning in MATLAB 2019a, hard-stops can be specified directly for PTOs and translational or rotational constraints by specifying joint-primitive dialog options in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>. Limits are modeled as an opposing spring damper force applied when a certain extents of motion are exceeded. Note that in this implementation, it is possible that the constraint/PTO will exceed these limits if an inadequate spring and/or damping coefficient is specified, acting instead as a soft motion constraint. More detail on this implementation can be found at &lt;<a class="reference external" href="https://www.mathworks.com/help/physmod/sm/ref/prismaticjoint.html#mw_316368a1-4b9e-4cfb-86e0-9abdd0c4d7a8">https://www.mathworks.com/help/physmod/sm/ref/prismaticjoint.html#mw_316368a1-4b9e-4cfb-86e0-9abdd0c4d7a8</a>&gt;. To specify joint or actuation stroke limits for a PTO, the following parameters must be specified in <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code></p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">code:</th><td class="field-body"><cite>pto(i).hardStops.upperLimitSpecify = ‘on’</cite></td>
</tr>
<tr class="field-even field"><th class="field-name">code:</th><td class="field-body"><cite>pto(i).hardStops.lowerLimitSpecify = ‘on’</cite></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>to enable upper and lower stroke limits, respectively. The specifics of the limit and the acting forces at the upper and lower limits are described in turn by</p>
<blockquote>
<div>pto(i).hardStops.upperLimitBound
pto(i).hardStops.upperLimitStiffness
pto(i).hardStops.upperLimitDamping
pto(i).hardStops.upperLimitTransitionRegionWidth
pto(i).hardStops.lowerLimitBound
pto(i).hardStops.lowerLimitStiffness
pto(i).hardStops.lowerLimitDamping
pto(i).hardStops.lowerLimitTransitionRegionWidth</div></blockquote>
<p>where pto(i) is replaced with constraint(i) on all of the above if the limits are to be applied to a constraint.</p>
<p>In MATLAB versions prior to 2019a, specifying any of the above parameters will have no effect on the simulation, and may generate warnings. It is instead recommended that hard-stops are implemented in a similar fashion using an Actuation Force/Torque PTO block in which the actuation force is specified in a custom MATLAB Function block.</p>
</div>
</div>
<div class="section" id="pto-sim">
<h3>PTO-Sim<a class="headerlink" href="#pto-sim" title="Permalink to this headline">¶</a></h3>
<p>PTO-Sim is the WEC-Sim module responsible for accurately modeling a WEC’s conversion of mechanical power to electrical power.
While the PTO blocks native to WEC-Sim are modeled as a simple linear spring-damper systems, PTO-Sim is capable of modeling many power conversion chains (PCC) such as mechanical drivetrain and hydraulic drivetrain.
PTO-Sim is made of native Simulink blocks coupled with WEC-Sim, using WEC-Sim’s user-defined PTO blocks, where the WEC-Sim response (relative displacement and velocity for linear motion and angular position and velocity for rotary motion) is the PTO-Sim input.
Similarly, the PTO force or torque is the WEC-Sim input.
For more information on how PTO-Sim works, refer to [So et al., 2015], and <a class="reference internal" href="webinars.html#webinar3"><span class="std std-ref">Webinar 3 - PTO and Control</span></a>.</p>
<p>The files for the PTO-Sim tutorials described in this section can be found in the <strong>PTO-Sim</strong> examples on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications repository</a> . Five PTO examples are contained in the PTO-Sim application and can be used as a starting point for users to develop their own. They cover two WEC types and mechanical, hydraulic, and electrial PTO’s:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>PTO-Sim Application</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>RM3_Hydraulic_PTO</td>
<td>RM3 with hydraulic PTO</td>
</tr>
<tr class="row-odd"><td>RM3_cHydraulic_PTO</td>
<td>RM3 with compressible hydraulic PTO</td>
</tr>
<tr class="row-even"><td>RM3_DD_PTO</td>
<td>RM3 with direct drive linear generator</td>
</tr>
<tr class="row-odd"><td>OSWEC_Hydraulic_PTO</td>
<td>OSWEC with hydraulic PTO (adjustable rod)</td>
</tr>
<tr class="row-even"><td>OSWEC_Hydraulic_Crank_PTO</td>
<td>OSWEC with hydraulic PTO (crank)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="tutorial-rm3-with-pto-sim">
<h4>Tutorial: RM3 with PTO-Sim<a class="headerlink" href="#tutorial-rm3-with-pto-sim" title="Permalink to this headline">¶</a></h4>
<p>This section describes how to use RM3 with PTO-Sim. Two tutorials will be given in this section: one for the RM3 with a hydraulic PTO (non-compressible) and another for the RM3 with a direct drive PTO.</p>
<div class="section" id="rm3-with-hydraulic-pto">
<h5>RM3 with Hydraulic PTO<a class="headerlink" href="#rm3-with-hydraulic-pto" title="Permalink to this headline">¶</a></h5>
<p>The hydraulic PTO example used in this section consists of a piston, a rectifying valve, a high pressure accumulator, a hydraulic motor coupled to a rotary generator, and a low pressure accumulator.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/HYDPHYMODEL.PNG"><img alt="../_images/HYDPHYMODEL.PNG" src="../_images/HYDPHYMODEL.PNG" style="width: 400pt;" /></a>
</div>
<p>There are two ways of modeling the hydraulic PTO: with a compressible fluid hydraulic, and with a non-compressible fluid hydraulic. The compressible fluid model uses the properties of fluid such as an effective bulk modulus and density while the non-compressible fluid does not.</p>
<p>In this section, a step by step tutorial on how to set up and run the RM3 simulation with PTO-Sim is provided. All the files used in WEC-Sim will remain the same. An additional file that is needed is the PTO-Sim input file (<code class="docutils literal notranslate"><span class="pre">ptoSimInputFile.m</span></code>). If the rotary generator lookup table is used, a datasheet that contains generator efficiency, torque, and angular velocity is needed and should be named as <code class="docutils literal notranslate"><span class="pre">table</span></code> in Workspace (<code class="docutils literal notranslate"><span class="pre">table.eff</span></code>, <code class="docutils literal notranslate"><span class="pre">table.Tpu</span></code>,and <code class="docutils literal notranslate"><span class="pre">table.omegapu</span></code>). More details, refer to <a class="reference internal" href="#step-8">Step 8</a>. In summary, the files need to run RM3 with PTO-Sim case are the following:</p>
<ul class="simple">
<li>WEC-Sim input file: <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> (make sure to set the PTO linear damping to zero)</li>
<li>Simulink model: <code class="docutils literal notranslate"><span class="pre">RM3.slx</span></code></li>
<li>Geometry file for each body: <code class="docutils literal notranslate"><span class="pre">float.stl</span></code> and <code class="docutils literal notranslate"><span class="pre">plate.stl</span></code></li>
<li>Hydrodynamic data file(s): <code class="docutils literal notranslate"><span class="pre">rm3.h5</span></code></li>
<li>Optional user defined post-processing file: <code class="docutils literal notranslate"><span class="pre">userDefinedFunction.m</span></code></li>
<li>PTO-Sim input file: <code class="docutils literal notranslate"><span class="pre">ptoSimInputFile.m</span></code></li>
<li>Datasheet for the rotary generator: <code class="docutils literal notranslate"><span class="pre">table</span></code> (<code class="docutils literal notranslate"><span class="pre">table.eff</span></code>, <code class="docutils literal notranslate"><span class="pre">table.Tpu</span></code>,and <code class="docutils literal notranslate"><span class="pre">table.omegapu</span></code>)</li>
<li>For the hydraulic PTOs: <code class="docutils literal notranslate"><span class="pre">variableMotorVolume.m</span></code></li>
</ul>
<p><strong>Simulink Model</strong>
The Simulink model can be built as follows:</p>
<ul class="simple">
<li>Step 1: Navigate to the RM3 tutorial <code class="docutils literal notranslate"><span class="pre">$WECSIM/tutorials/RM3</span></code>.</li>
<li>Step 2: Open <code class="docutils literal notranslate"><span class="pre">RM3.slx</span></code> file and replace Translational PTO (local Z) with Translational PTO UD Force (Local Z).</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/TRANSLATIONALPTOUD.PNG"><img alt="../_images/TRANSLATIONALPTOUD.PNG" src="../_images/TRANSLATIONALPTOUD.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 3: Use a subsystem and rename it to PTO-Sim where input is response and output is        force.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/RM3WITHPTOSIMBLOCK.PNG"><img alt="../_images/RM3WITHPTOSIMBLOCK.PNG" src="../_images/RM3WITHPTOSIMBLOCK.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 4: Go inside PTO-Sim block and add one bus selector and two selector blocks. Since PTO-Sim block is connected to the WEC-Sim translational joint block, you can select position and velocity and therefore “signal1” and “signal2” will change to “position” and “velocity”. Because the heave motion is driving the piston, selection index of each selector needs to be changed to 3.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/SELECTORS.PNG"><img alt="../_images/SELECTORS.PNG" src="../_images/SELECTORS.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 5: Go to Simulink Library Browser to access PTO-Sim Library.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/WEC-Sim_Lib_ptosim_hyd.PNG"><img alt="../_images/WEC-Sim_Lib_ptosim_hyd.PNG" src="../_images/WEC-Sim_Lib_ptosim_hyd.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 6: By looking at the physical hydraulic PTO model as shown above, user can simply drag and drop PTO-Sim library blocks. Piston, valves, accumulator blocks are located under the Hydraulic block. Rotary generator lookup table is under the Generator block.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/WEC-Sim_Lib_ptosim.PNG"><img alt="../_images/WEC-Sim_Lib_ptosim.PNG" src="../_images/WEC-Sim_Lib_ptosim.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 7: Since two accumulators are needed for the high pressure accumulator and low pressure accumulator, the user needs to double-click on each block and give a number to each accumulator. For example, <code class="docutils literal notranslate"><span class="pre">ptosim.accumulator(1)</span></code> is called high pressure accumulator and <code class="docutils literal notranslate"><span class="pre">ptosim.accumulator(2)</span></code> is called low pressure accumulator.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/MULTIPLEACCUMULATORS.PNG"><img alt="../_images/MULTIPLEACCUMULATORS.PNG" src="../_images/MULTIPLEACCUMULATORS.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple" id="step-8">
<li>Step 8: If a rotary generator lookup table is used, this block assumes the user will provide the datasheet. After the datasheet is loaded into <code class="docutils literal notranslate"><span class="pre">Workspace</span></code>, it needs to be named as <code class="docutils literal notranslate"><span class="pre">table</span></code> because the word <code class="docutils literal notranslate"><span class="pre">table</span></code> is used inside Simulink lookup table block. The datasheet in tutorials is taken from ABB datasheet part number M3BJ315SMC. The lookup table takes three inputs: efficiency (<code class="docutils literal notranslate"><span class="pre">table.eff</span></code>), angular velocity (<code class="docutils literal notranslate"><span class="pre">table.omegapu</span></code>), and generator torque (<code class="docutils literal notranslate"><span class="pre">table.Tpu</span></code>), respectively.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ROTARYHIGHLEVELBLOCK.PNG"><img alt="../_images/ROTARYHIGHLEVELBLOCK.PNG" src="../_images/ROTARYHIGHLEVELBLOCK.PNG" style="width: 400pt;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ROTARYBLOCK.PNG"><img alt="../_images/ROTARYBLOCK.PNG" src="../_images/ROTARYBLOCK.PNG" style="width: 400pt;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ROTARYGENLOOKUPTABLE.PNG"><img alt="../_images/ROTARYGENLOOKUPTABLE.PNG" src="../_images/ROTARYGENLOOKUPTABLE.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 9: After the high pressure and low pressure accumulators have been identified, and the rotary generator lookup table datasheet has been setup, all the blocks can be connected together.</li>
</ul>
<p>Position and velocity from selectors are used as inputs to the compressible fluid piston. This block also needs to know top and bottom volumetric flows which come from the rectifying check valve. The piston then outputs PTO force that will be used by WEC-Sim. Two other outputs are the piston pressures. The rectifying check valve takes both the pressures from the piston and accumulators. Both high and low pressure accumulators take the volumetric flows from the rectifying check valve and hydraulic motor. The hydraulic motor uses the knowledge of the pressures from both accumulator and generator torque from the rotary generator. The rotary generator needs angular velocity from the hydraulic motor. The figure below shows how to connect all the blocks together.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/HYDPTOSIM.PNG"><img alt="../_images/HYDPTOSIM.PNG" src="../_images/HYDPTOSIM.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Input File</strong>
In this section, PTO-Sim input file (<code class="docutils literal notranslate"><span class="pre">ptoSimInputFile.m</span></code>) is defined and categorized into sections such as piston, rectifying check valve, high pressure accumulator, hydraulic motor, low pressure accumulator, and rotary generator.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/PTOSIMINPUTFILE.PNG"><img alt="../_images/PTOSIMINPUTFILE.PNG" src="../_images/PTOSIMINPUTFILE.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Simulation and Post-processing</strong>
Simulation and post-processing are the same process as described in WEC-Sim Simulation example above.</p>
</div>
<div class="section" id="rm3-with-direct-drive-pto">
<h5>RM3 with Direct Drive PTO<a class="headerlink" href="#rm3-with-direct-drive-pto" title="Permalink to this headline">¶</a></h5>
<p>A mechanical PTO is used in this example and is modeled as a direct drive linear generator. The main components of this example consist of magnets and a coil where the magnet assembly is attached to the heaving float and the coil is located inside the spar. As the float moves up and down, the magnet assembly creates a change in the magnetic field surrounding the spar that contains the coil: therefore, current is induced in the coil and electricity is generated.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/MECHANICALPTO.PNG"><img alt="../_images/MECHANICALPTO.PNG" src="../_images/MECHANICALPTO.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Simulink Model</strong>
Step 1 through 3 are the same as in <a class="reference internal" href="#rm3-with-hydraulic-pto"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
<ul class="simple">
<li>Step 4: Go inside PTO-Sim block and add one bus selector and one selector blocks. Only velocity is needed for this example.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/SELECTORS2.PNG"><img alt="../_images/SELECTORS2.PNG" src="../_images/SELECTORS2.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 5: Go to PTO-Sim library.</li>
<li>Step 6: By looking at the physical mechanical PTO model as shown above, the user can simply drag and drop PTO-Sim library blocks. In this case, only the direct drive linear generator is needed, and it is located under the generator box.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/USEPTOSIMLIB2.PNG"><img alt="../_images/USEPTOSIMLIB2.PNG" src="../_images/USEPTOSIMLIB2.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 7: Simply connect velocity from the selector to the input of the direct drive linear generator. The output PTO force is fed back to WEC-Sim.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/DDLINEARGENPTOSIM.PNG"><img alt="../_images/DDLINEARGENPTOSIM.PNG" src="../_images/DDLINEARGENPTOSIM.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Input File, Simulation, and Post-processing</strong>
The same as <a class="reference internal" href="#rm3-with-hydraulic-pto"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
</div>
</div>
<div class="section" id="tutorial-oswec-with-pto-sim">
<h4>Tutorial: OSWEC with PTO-Sim<a class="headerlink" href="#tutorial-oswec-with-pto-sim" title="Permalink to this headline">¶</a></h4>
<p>This section describes how to use the OSWEC model with PTO-Sim. The same process as described in <a class="reference internal" href="#rm3-with-hydraulic-pto"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>; however, since the OSWEC is a rotary device, it takes torque as an input and a rotary to linear motion conversion block is needed. The tutorials can be found on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository (both for a crank and for a rod).</p>
<div class="section" id="oswec-with-hydraulic-pto">
<h5>OSWEC with Hydraulic PTO<a class="headerlink" href="#oswec-with-hydraulic-pto" title="Permalink to this headline">¶</a></h5>
<p>A hydraulic PTO or mechanical PTO can be used with OSWEC but for simplicity a hydraulic PTO will be used as an example.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/OSWECPHYMODEL.PNG"><img alt="../_images/OSWECPHYMODEL.PNG" src="../_images/OSWECPHYMODEL.PNG" style="width: 400pt;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/MoTIONMECHANISM.PNG"><img alt="../_images/MoTIONMECHANISM.PNG" src="../_images/MoTIONMECHANISM.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Modeling of OSWEC with Hydraulic PTO</strong>
The same as <a class="reference internal" href="#rm3-with-hydraulic-pto"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
<p><strong>Simulink Model</strong>
The Simulink model can be built as following:</p>
<ul class="simple">
<li>Step 1: Copy OSWEC tutorial folder to get started  <code class="docutils literal notranslate"><span class="pre">$WECSIM\tutorials\OSWEC</span></code>.</li>
<li>Step 2: Open <code class="docutils literal notranslate"><span class="pre">OSWEC.slx</span></code> file and replace Rotary PTO (Local RY) with Rotational PTO UD Torque (Local RY).</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/OSWECWITHPTOSIMBLOCK.PNG"><img alt="../_images/OSWECWITHPTOSIMBLOCK.PNG" src="../_images/OSWECWITHPTOSIMBLOCK.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 3: Use a subsystem and rename it to PTO-Sim where input is response and output is torque.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/OSWECWITHPTOSIMBLOCK1.PNG"><img alt="../_images/OSWECWITHPTOSIMBLOCK1.PNG" src="../_images/OSWECWITHPTOSIMBLOCK1.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 4: Go inside PTO-Sim block and drag and drop one bus selector and two selector blocks. Since pitch is driving the piston, selection index of each selector needs to be changed to 5. Next, go to PTO-Sim library and drag and drop all the blocks for the hydraulic PTO. The rotary to linear adjustable rod block can be found under rotary to linear conversion box.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/USEPTOSIMLIB3.PNG"><img alt="../_images/USEPTOSIMLIB3.PNG" src="../_images/USEPTOSIMLIB3.PNG" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li>Step 5: The rotary to linear adjustable rod block takes angular position and velocity from index selector blocks and PTO force from compressible fluid piston block. The outputs of the rotary to linear adjustable rod block are linear position, velocity, and torque. Linear position and velocity are used as inputs for compressible fluid piston and torque is fed back to WEC-Sim. The rest of the connections are the same as in RM3 with hydraulic PTO. The user is encouraged to go up one level to check the connections between PTO-Sim and WEC-Sim.</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/HYDPTOSIMOSWEC.PNG"><img alt="../_images/HYDPTOSIMOSWEC.PNG" src="../_images/HYDPTOSIMOSWEC.PNG" style="width: 400pt;" /></a>
</div>
<p><strong>Input File, Simulation, and Post-processing</strong>
The same as <a class="reference internal" href="#rm3-with-hydraulic-pto"><span class="std std-ref">RM3 with Hydraulic PTO</span></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="mooring-features">
<span id="mooring1"></span><h2>Mooring Features<a class="headerlink" href="#mooring-features" title="Permalink to this headline">¶</a></h2>
<p>This section provides an overview of WEC-Sim’s mooring class features; for more information about the mooring class code structure, refer to <a class="reference internal" href="code_structure.html#mooring-class"><span class="std std-ref">Mooring Class</span></a>.</p>
<p>Floating WEC systems are often connected to mooring lines to keep the device in position. WEC-Sim allows the user to model the mooring dynamics in the simulation by specifying the mooring matrix or coupling with MoorDyn. To include mooring connections, the user can use the mooring block (i.e., Mooring Matrix block or MoorDyn block) given in the WEC-Sim library under Moorings lib and connect it between the body and the Global reference frame.
Refer to the <a class="reference internal" href="#rm3-with-moordyn"><span class="std std-ref">RM3 with MoorDyn</span></a>, and the <a class="reference internal" href="webinars.html#webinar4"><span class="std std-ref">Webinar 4 - Mooring and Visualization</span></a> for more information.</p>
<p>MoorDyn is hosted on  a separate <a class="reference external" href="https://github.com/WEC-Sim/moorDyn">MoorDyn repository</a>. It must be download separately, and all files and folders should be placed in the <code class="docutils literal notranslate"><span class="pre">$WECSIM/functions/moorDyn</span></code> directory.</p>
<div class="section" id="mooring-matrix">
<h3>Mooring Matrix<a class="headerlink" href="#mooring-matrix" title="Permalink to this headline">¶</a></h3>
<p>When the mooring matrix block is used, the user first needs to initiate the mooring class by setting <code class="code docutils literal notranslate"><span class="pre">mooring(i)</span> <span class="pre">=</span> <span class="pre">mooringClass('mooring</span> <span class="pre">name')</span></code> in the WEC-Sim input file (<code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code>). Typically, the mooring connection location also needs to be specified, <code class="code docutils literal notranslate"><span class="pre">mooring(i).ref</span> <span class="pre">=</span> <span class="pre">[1x3]</span></code> (the default connection location is <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">0</span> <span class="pre">0]</span></code>). The user can also define the mooring matrix properties in the WEC-Sim input file using:</p>
<ul class="simple">
<li>Mooring stiffness matrix - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.k</span> <span class="pre">=</span> <span class="pre">[6x6]</span></code> in [N/m]</li>
<li>Mooring damping matrix - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.c</span> <span class="pre">=</span> <span class="pre">[6x6]</span></code> in [Ns/m]</li>
<li>Mooring pretension - <code class="code docutils literal notranslate"><span class="pre">mooring(i).matrix.preTension</span> <span class="pre">=</span> <span class="pre">[1x6]</span></code> in [N]</li>
</ul>
</div>
<div class="section" id="moordyn">
<h3>MoorDyn<a class="headerlink" href="#moordyn" title="Permalink to this headline">¶</a></h3>
<p>When the MoorDyn block is used, the user needs to initiate the mooring class by setting <code class="code docutils literal notranslate"><span class="pre">mooring</span> <span class="pre">=</span> <span class="pre">mooringClass('mooring</span> <span class="pre">name')</span></code> in the WEC-Sim input file (wecSimInputFile.m), followed by the number of mooring lines that are defined in MoorDyn (<code class="docutils literal notranslate"><span class="pre">mooring(1).moorDynLines</span> <span class="pre">=</span> <span class="pre">&lt;Number</span> <span class="pre">of</span> <span class="pre">mooring</span> <span class="pre">lines&gt;</span></code>)</p>
<p>A mooring folder that includes a moorDyn input file (<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is required in the simulation folder.</p>
<div class="section" id="rm3-with-moordyn">
<span id="rm3-moordyn"></span><h4>RM3 with MoorDyn<a class="headerlink" href="#rm3-with-moordyn" title="Permalink to this headline">¶</a></h4>
<p>This section describes how to simulate a mooring connected WEC system in WEC-Sim using MoorDyn. The RM3 two-body floating point absorber is connected to a three-point catenary mooring system with an angle of 120 between the lines in this example case. The RM3 with MoorDyn folder is located under the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<ul class="simple">
<li><strong>WEC-Sim Simulink Model</strong>: Start out by following the instructions on how to model the <a class="reference internal" href="tutorials.html#two-body-point-absorber-rm3"><span class="std std-ref">Two-Body Point Absorber (RM3)</span></a>. To couple WEC-Sim with MoorDyn, the MoorDyn Block is added in parallel to the constraint block</li>
</ul>
<div class="figure align-center" id="wecsimmoordyn">
<a class="reference internal image-reference" href="../_images/WECSimMoorDyn.png"><img alt="../_images/WECSimMoorDyn.png" src="../_images/WECSimMoorDyn.png" style="width: 320pt;" /></a>
</div>
<ul class="simple">
<li><strong>WEC-Sim Input File</strong>: In the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile.m</span></code> file, the user needs to initiate the mooring class and define the number of mooring lines.</li>
</ul>
<div class="highlight-matlab notranslate" id="wecsiminputmoordyn"><div class="highlight"><pre><span></span><span class="c">%% Simulation Data</span>
<span class="n">simu</span> <span class="p">=</span> <span class="n">simulationClass</span><span class="p">();</span>             
<span class="n">simu</span><span class="p">.</span><span class="n">simMechanicsFile</span> <span class="p">=</span> <span class="s">&#39;RM3MoorDyn.slx&#39;</span><span class="p">;</span>      <span class="c">% Location of Simulink Model File with MoorDyn</span>
<span class="n">simu</span><span class="p">.</span><span class="n">mode</span><span class="p">=</span><span class="s">&#39;accelerator&#39;</span><span class="p">;</span>                
<span class="n">simu</span><span class="p">.</span><span class="n">explorer</span> <span class="p">=</span> <span class="s">&#39;off&#39;</span><span class="p">;</span>
<span class="n">simu</span><span class="p">.</span><span class="n">rampTime</span> <span class="p">=</span> <span class="mi">40</span><span class="p">;</span>                        
<span class="n">simu</span><span class="p">.</span><span class="n">endTime</span><span class="p">=</span><span class="mi">400</span><span class="p">;</span>                       
<span class="n">simu</span><span class="p">.</span><span class="n">dt</span> <span class="p">=</span> <span class="mf">0.01</span><span class="p">;</span>                          
<span class="n">simu</span><span class="p">.</span><span class="n">dtCITime</span> <span class="p">=</span> <span class="mf">0.05</span><span class="p">;</span>

<span class="c">%% Wave Information</span>
<span class="c">% User-Defined Time-Series</span>
<span class="n">waves</span> <span class="p">=</span> <span class="n">waveClass</span><span class="p">(</span><span class="s">&#39;etaImport&#39;</span><span class="p">);</span>         <span class="c">% Create the Wave Variable and Specify Type</span>
<span class="n">waves</span><span class="p">.</span><span class="n">etaDataFile</span> <span class="p">=</span> <span class="s">&#39;etaData.mat&#39;</span><span class="p">;</span>      <span class="c">% Name of User-Defined Time-Series File [:,2] = [time, eta]</span>

<span class="c">%% Body Data</span>
<span class="c">% Float</span>
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../hydroData/rm3.h5&#39;</span><span class="p">);</span>      
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">geometryFile</span> <span class="p">=</span> <span class="s">&#39;../geometry/float.stl&#39;</span><span class="p">;</span>      
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">mass</span> <span class="p">=</span> <span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>                   
<span class="n">body</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">momOfInertia</span> <span class="p">=</span> <span class="p">[</span><span class="mi">20907301</span> <span class="mf">21306090.66</span> <span class="mf">37085481.11</span><span class="p">];</span> 

<span class="c">% Spar/Plate</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="n">bodyClass</span><span class="p">(</span><span class="s">&#39;../hydroData/rm3.h5&#39;</span><span class="p">);</span>     
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">geometryFile</span> <span class="p">=</span> <span class="s">&#39;../geometry/plate.stl&#39;</span><span class="p">;</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">mass</span> <span class="p">=</span> <span class="s">&#39;equilibrium&#39;</span><span class="p">;</span>                   
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">momOfInertia</span> <span class="p">=</span> <span class="p">[</span><span class="mf">94419614.57</span> <span class="mf">94407091.24</span> <span class="mf">28542224.82</span><span class="p">];</span>
<span class="n">body</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">initDisp</span><span class="p">.</span><span class="n">initLinDisp</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">0.21</span><span class="p">];</span>  <span class="c">% Initial Displacement</span>

<span class="c">%% PTO and Constraint Parameters</span>
<span class="c">% Floating (3DOF) Joint</span>
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">constraintClass</span><span class="p">(</span><span class="s">&#39;Constraint1&#39;</span><span class="p">);</span> 
<span class="n">constraint</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">loc</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">];</span>    

<span class="c">% Translational PTO</span>
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">ptoClass</span><span class="p">(</span><span class="s">&#39;PTO1&#39;</span><span class="p">);</span>              	
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">k</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>                             	
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">c</span><span class="p">=</span><span class="mi">1200000</span><span class="p">;</span>                       	
<span class="n">pto</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">loc</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">];</span>     

<span class="c">%% Mooring</span>
<span class="c">% Moordyn</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">mooringClass</span><span class="p">(</span><span class="s">&#39;mooring&#39;</span><span class="p">);</span>       <span class="c">% Initialize mooringClass</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynLines</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span>                <span class="c">% Specify number of lines</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="p">=</span> <span class="mi">16</span><span class="p">;</span>          <span class="c">% Specify number of nodes per line</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">moorDynNodes</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span>           <span class="c">% Specify number of nodes per line</span>
<span class="n">mooring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">initDisp</span><span class="p">.</span><span class="n">initLinDisp</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mf">0.21</span><span class="p">];</span>      <span class="c">% Initial Displacement</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>MoorDyn Input File</strong>: A mooring folder that includes a moorDyn input file (<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is created. The moorDyn input file (<code class="docutils literal notranslate"><span class="pre">lines.txt</span></code>) is shown in the figure below. More details on how to setup the MooDyn input file are described in the MoorDyn User Guide <a class="reference internal" href="theory.html#hall2015moordynguide" id="id14">[B1]</a>.</li>
</ul>
<div class="figure align-center" id="moordyninput">
<a class="reference internal image-reference" href="../_images/moorDynInput.png"><img alt="../_images/moorDynInput.png" src="../_images/moorDynInput.png" style="width: 400pt;" /></a>
</div>
<ul class="simple">
<li><strong>Simulation and Post-processing</strong>: Simulation and post-processing are the same process as described in Tutorial Section.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may need to install the MinGW-w64 compiler to run this simulation.</p>
</div>
</div>
</div>
</div>
<div class="section" id="visualization-paraview">
<h2>Visualization/Paraview<a class="headerlink" href="#visualization-paraview" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to setup, output, and use Paraview files for visualizing a WEC-Sim simulation.
For more information about using Paraview for visualization, refer to the <a class="reference internal" href="webinars.html#webinar4"><span class="std std-ref">Webinar 4 - Mooring and Visualization</span></a>, and the <strong>Viz</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
<p>Using Paraview visualization improves on SimMechanics’s explorer by:</p>
<ul class="simple">
<li>Visualization of the wave field</li>
<li>Visualization of the cell-by-cell non-linear hydrodynamic forces (when using nonlinear buoyancy and Froude-Krylov wave excitation)</li>
<li>Allow data manipulation and more visualization options</li>
</ul>
<p>On the other hand the SimMechanics explorer shows the following information not shown in Paraview visualizing:</p>
<ul class="simple">
<li>Location of the center of gravity</li>
<li>Location of the different frames including PTO and Constraint frames</li>
</ul>
<p>Visualization with paraview requires many files to be written, which makes the WEC-Sim simulation take significantly more time, and makes the directory significantly larger.
It should only be turned on when visualization is desired. The user also needs to have some familiarity with using Paraview.</p>
<div class="section" id="getting-started-installation">
<h3>Getting Started - Installation<a class="headerlink" href="#getting-started-installation" title="Permalink to this headline">¶</a></h3>
<p>You will need to install <a class="reference external" href="http://www.paraview.org/">Paraview</a> and install and setup Python.
Next you will need to add some WEC-Sim specific macros, as follows:</p>
<ul class="simple">
<li>Open Paraview</li>
<li>Click on <code class="docutils literal notranslate"><span class="pre">Macros</span> <span class="pre">=&gt;</span> <span class="pre">Add</span> <span class="pre">new</span> <span class="pre">macro</span></code></li>
<li>Navigate to the WEC-Sim <code class="docutils literal notranslate"><span class="pre">source/functions/paraview_macros</span></code> directory</li>
<li>Select the first file and click <code class="docutils literal notranslate"><span class="pre">OK</span></code></li>
<li>Repeat this for all files in the <code class="docutils literal notranslate"><span class="pre">paraview_macros</span> <span class="pre">directory.</span></code></li>
</ul>
</div>
<div class="section" id="setting-up-paraview-output">
<h3>Setting Up Paraview Output<a class="headerlink" href="#setting-up-paraview-output" title="Permalink to this headline">¶</a></h3>
<p>The following table shows the variables that can be specified in the <code class="docutils literal notranslate"><span class="pre">wecSimInputFile</span></code> to control the Paraview visualization. The <code class="docutils literal notranslate"><span class="pre">body.viz</span></code> properties are also used in the SimMechanics explorer visualization.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">WEC-Sim Visualization using Paraview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Variable</td>
<td>Description</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">simu.paraview</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">0 to not output Paraview files [default]</div>
<div class="line">1 to output Paraview files</div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">simu.StartTimeParaview</span></code></td>
<td>time (s) to start Paraview visualization</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">simu.EndTimeParaview</span></code></td>
<td>time (s) to end Paraview visualization</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">simu.dtParaview</span></code></td>
<td>time step between adjacent Paraview frames [default 1]</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">simu.pathParaviewVideo</span></code></td>
<td>directory to create Paraview visualization files</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">simu.nlHydro</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">0 for no non-linear hydro [default]</div>
<div class="line">1 for non-linear hydro with mean free surface</div>
<div class="line">2 for non-linear hydro with instantaneous free surface</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">simu.domainSize</span></code></td>
<td>size of ground and water planes in meters [default 200]</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">simu.dtOut</span></code></td>
<td>simulation output sampling time step [default dt]</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">body(i).viz.color</span></code></td>
<td>[RGB] body color [default [1 1 0]]</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">body(i).viz.opacity</span></code></td>
<td>body opacity [default 1]</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">body(i).bodyparaview</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">0 to exclude body from Paraview visualization</div>
<div class="line">1 to include body in Paraview visualization [default]</div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">waves.viz.numPointsX</span></code></td>
<td>wave plane discretization: number of X points [default 50]</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">waves.viz.numPointsY</span></code></td>
<td>wave plane discretization: number of Y points [default 50]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="outputs-and-opening-in-paraview">
<h3>Outputs and Opening in Paraview<a class="headerlink" href="#outputs-and-opening-in-paraview" title="Permalink to this headline">¶</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">simu.paraview</span></code> is set to 1, a user-specified directory containing <code class="docutils literal notranslate"><span class="pre">vtk</span></code> is created.
All files necessary for Paraview visualization are located there.
To view in Paraview:</p>
<ul class="simple">
<li>Open the <code class="docutils literal notranslate"><span class="pre">YOUR_PATH/vtk/filename.pvd</span></code> file in Paraview</li>
<li>Click <code class="docutils literal notranslate"><span class="pre">Apply</span></code></li>
<li>With the model selected in the pipeline, run the <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro</li>
<li>Move the camera to desired view</li>
<li>Click the green arrow (play) button</li>
</ul>
<p>The WEC-Sim macro:</p>
<ul class="simple">
<li>Extracts each body, sets the color and opacity, and renames them</li>
<li>Extracts the waves, sets color and opacity, and renames</li>
<li>Creates the ground plane</li>
<li>Sets the camera to <code class="docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">view</span></code></li>
</ul>
</div>
<div class="section" id="basic-visualization-manipulation">
<h3>Basic Visualization Manipulation<a class="headerlink" href="#basic-visualization-manipulation" title="Permalink to this headline">¶</a></h3>
<p>After opening the <code class="docutils literal notranslate"><span class="pre">.pvd</span></code> file and running the <code class="docutils literal notranslate"><span class="pre">WEC-Sim</span></code> macro you can do a number of things to visualize the simulation in different ways.
You can color waves and bodies by any of the available properties and apply any of the Paraview filters.</p>
<p>The video below shows three different views of the OSWEC model described in the tutorials.
On the bottom right view the wave elevation is used to color the free surface. The top right view uses the <code class="docutils literal notranslate"><span class="pre">slice</span></code> filter.</p>
<iframe width="420" height="315" src="https://www.youtube.com/embed/KcsLi38Xjv0" frameborder="0" allowfullscreen></iframe></div>
<div class="section" id="visualizing-non-linear-buoyancy-and-froude-krylov-wave-excitation">
<h3>Visualizing Non-Linear Buoyancy and Froude-Krylov Wave Excitation<a class="headerlink" href="#visualizing-non-linear-buoyancy-and-froude-krylov-wave-excitation" title="Permalink to this headline">¶</a></h3>
<p>When using non-linear buoyancy and Froude-Krylov Wave Excitation the paraview files also contain cell data for the bodies.
The cell data are:</p>
<ul class="simple">
<li>Cell areas</li>
<li>Hydrostatic pressures</li>
<li>Linear Froude-Krylov pressures</li>
<li>Non-linear Froude-Krylov pressures</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">pressureGlyphs</span></code> macro calculates cell normals, and cell centers. It then creates the following glyphs:</p>
<ul class="simple">
<li>Hydrostatic Pressure</li>
<li>Linear Froude-Krylov pressure</li>
<li>Non-linear Froude-Krylov pressure</li>
<li>Total pressure (hydrostatic plus non-linear Froude-Krylov)</li>
<li>Froude-Krylov delta (non-linear minus linear)</li>
</ul>
<p>The video below shows three different views of the RM3 model described in the tutorials.
The top right shows glyphs of the non-linear Froude-Krylov pressure acting on the float.
The bottom right shows the float colored by hydrostatic pressure.</p>
<blockquote>
<div><iframe width="420" height="315" src="https://www.youtube.com/embed/VIPXsS8h9pg" frameborder="0" allowfullscreen></iframe></div></blockquote>
</div>
</div>
<div class="section" id="decay-tests">
<h2>Decay Tests<a class="headerlink" href="#decay-tests" title="Permalink to this headline">¶</a></h2>
<p>When performing simulations of decay tests, you must use one of the no-wave cases and setup the initial (time = 0) location of each body, constraint, PTO, and mooring block.
The initial location of a body or mooring block is set by specifying the CG or location at the stability position (as with any WEC-Sim simulation) and then specifying an initial displacement.
To specify an initial displacement, the body and mooring blocks have a <code class="code docutils literal notranslate"><span class="pre">.initDisp</span></code> property with which you can specify a translation and angular rotation about an arbitrary axis.
For the constraint and PTO blocks, the <code class="code docutils literal notranslate"><span class="pre">.loc</span></code> property must be set to the location at time = 0.</p>
<p>There are methods available to help setup this initial displacement for all bodies, constraints, PTOs, and moorings.
To do this, you would use the:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">body(i).setInitDisp()</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">constraint(i).setInitDisp()</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">pto(i).setInitDisp()</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">mooring(i).setInitDisp()</span></code></li>
</ul>
<p>methods in the WEC-Sim input file.
A description of the required input can be found in the method’s header comments.
The following propoerties must be defined prior to using the object’s <code class="code docutils literal notranslate"><span class="pre">setInitDisp()</span></code> method:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">body(i).cg</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">constraint(i).loc</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">pto(i).loc</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">mooring.ref</span></code></li>
</ul>
<p>For more information, refer to the <strong>Free Decay</strong> example on the <a class="reference external" href="https://github.com/WEC-Sim/WEC-Sim_Applications">WEC-Sim Applications</a> repository.</p>
</div>
<div class="section" id="other-applications">
<h2>Other Applications<a class="headerlink" href="#other-applications" title="Permalink to this headline">¶</a></h2>
<p>The WEC-Sim Applications repository also includes examples of using WEC-Sim to model a Desalination plant and a numerical model of the WaveStar device for control implementation. The WaveStar device was used in the WECCCOMP wave energy control competition.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="webinars.html" class="btn btn-neutral float-right" title="Webinars" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, National Renewable Energy Laboratory and National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: dev
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="advanced_features.html">dev</a></dd>
            <dd><a href="../../master/man/advanced_features.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-88158104-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>